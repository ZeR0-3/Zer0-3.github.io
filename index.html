<!doctype html>
<!-- Generated by akashic-cli-export-html@1.9.6. -->
<!-- Options: {"strip":true,"hashFilename":true,"minify":true,"bundle":true,"magnify":true} -->
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>game</title>
<script>

	!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).engineFilesV2_4_0=t()}(function(){return function r(o,n,s){function a(e,t){if(!n[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=n[e]={exports:{}},o[e][0].call(i.exports,function(t){return a(o[e][1][t]||t)},i,i.exports,r,o,n,s)}return n[e].exports}for(var h="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,i){var r,o,e=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:n}catch(t){r=n}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return(r=setTimeout)(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var h,c=[],u=!1,l=-1;function d(){u&&h&&(u=!1,h.length?c=h.concat(c):l=-1,c.length&&p())}function p(){if(!u){for(var t=a(d),e=(u=!0,c.length);e;){for(h=c,c=[];++l<e;)h&&h[l].run();l=-1,e=c.length}h=null,u=!1,!function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return(o=clearTimeout)(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function _(){}e.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=_,e.addListener=_,e.once=_,e.off=_,e.removeListener=_,e.removeAllListeners=_,e.emit=_,e.prependListener=_,e.prependOnceListener=_,e.listeners=function(t){return[]},e.binding=function(t){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(t){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],2:[function(t,e,i){e.exports=t("./lib/main.node")},{"./lib/main.node":3}],3:[function(t,Ue,e){!function(){"use strict";var D,G,H,s,U,u,W,l,o,N,B,j,n,V,q,X,z,r,Y,K,h,J,$,Z,i,Q,tt,et,it,rt,ot,nt,st,at,ht,ct,a,ut,lt,c,dt,pt,ft,_t,gt,yt,mt,vt,d,Tt,At,xt,wt,St,Et,bt,p,Pt,kt,Rt,Lt,t,e=this&&this.__extends||(D=function(t,e){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function Mt(){}function Ot(t){this._value=t}(f=(f=t=t||{}).AssetLoadErrorType||(f.AssetLoadErrorType={}))[f.Unspecified=0]="Unspecified",f[f.RetryLimitExceeded=1]="RetryLimitExceeded",f[f.NetworkError=2]="NetworkError",f[f.ClientError=3]="ClientError",f[f.ServerError=4]="ServerError",G=t=t||{},(f=G.ExceptionFactory||(G.ExceptionFactory={})).createAssertionError=function(t,e){return(t=new Error(t)).name="AssertionError",t.cause=e,t},f.createTypeMismatchError=function(t,e,i,r){if(t="Type mismatch on "+t+", expected type is "+e,2<arguments.length)try{var o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i;t+=", actual type is "+(40<o.length?o.substr(0,40):o)}catch(t){}return t+=".",(o=new Error(t)).name="TypeMismatchError",o.cause=r,o.expected=e,o.actual=i,o},f.createAssetLoadError=function(t,e,i,r){return void 0===e&&(e=!0),void 0===i&&(i=G.AssetLoadErrorType.Unspecified),(t=new Error(t)).name="AssetLoadError",t.cause=r,t.retriable=e,t.type=i,t},H=t=t||{},Mt.prototype.createSurfaceAtlas=function(t,e){return new H.SurfaceAtlas(this.createSurface(t,e))},Mt.prototype.createTrimmedSurface=function(t,e){var e=e||{x:0,y:0,width:t.width,height:t.height},i=this.createSurface(e.width,e.height),r=i.renderer();return r.begin(),r.drawImage(t,e.x,e.y,e.width,e.height,0,0),r.end(),i},H.ResourceFactory=Mt,f=t=t||{},Ot.prototype._cachedValue=function(){return this._value},f.RequireCachedValue=Ot,(t||(t={})).RandomGenerator=function(t){this.seed=t,this[0]=this};var Ct=t=t||{},f=(Ft.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},Ft.prototype.destroyed=function(){return void 0===this.id},Ft.prototype.inUse=function(){return!1},Ft.prototype._assetPathFilter=function(t){return t},Ft);function Ft(t,e){this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e),this.onDestroyed=new Ct.Trigger}Ct.Asset=f,e(Dt,It=f),Dt.prototype.initialize=function(t){this.hint=t};var It,_=Dt;function Dt(t,e,i,r){t=It.call(this,t,e)||this;return t.width=i,t.height=r,t}Ct.ImageAsset=_,e(Ht,Gt=_),Ht.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},Ht.prototype.stop=function(){this.getPlayer().stop()},Ht.prototype.destroy=function(){this._system=void 0,Gt.prototype.destroy.call(this)};var Gt,_=Ht;function Ht(t,e,i,r,o,n,s){t=Gt.call(this,t,e,i,r)||this;return t.realWidth=0,t.realHeight=0,t._system=o,t._loop=n,t._useRealSize=s,t}Ct.VideoAsset=Ht,e(Wt,Ut=f),Wt.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t},Wt.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},Wt.prototype.inUse=function(){return 0<this._system.findPlayers(this).length},Wt.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,Ut.prototype.destroy.call(this)};var Ut,_=Wt;function Wt(t,e,i,r,o,n){t=Ut.call(this,t,e)||this;return t.duration=i,t.loop=o,t.hint=n,t._system=r,t.data=void 0,t}Ct.AudioAsset=Wt,e(Bt,Nt=f),Bt.prototype.destroy=function(){this.data=void 0,Nt.prototype.destroy.call(this)};var Nt,_=Bt;function Bt(t,e){t=Nt.call(this,t,e)||this;return t.data=void 0,t}Ct.TextAsset=Bt,e(Vt,jt=f),Vt.prototype.destroy=function(){this.script=void 0,jt.prototype.destroy.call(this)};var jt,_=Vt;function Vt(){return null!==jt&&jt.apply(this,arguments)||this}function g(t,e,i,r){this.game=t,this._audioSystemConfMap=function(t){t=t||{};var e,i={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(e in i)e in t||(t[e]=i[e]);return t}(i),this.configuration=this._normalize(e||{}),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=r||{},this._refCounts={},this._loadings={}}function qt(t,e){this._game=t,this._asset=e,this._module=new W.Module(t,e.path,e.path),this._g=this._module._g,this._started=!1}function y(t,e,i,r,o,n,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=n&&null!=s?this.updateWithAnchor(t,e,i,r,o,0,0,n,s):this.update(t,e,i,r,o,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}Ct.ScriptAsset=Vt,s=t=t||{},U=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1},g.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},g.prototype.destroyed=function(){return void 0===this.game},g.prototype.retryLoad=function(t){if(!this._loadings.hasOwnProperty(t.id))throw s.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var e=this._loadings[t.id];if(e.errorCount>g.MAX_ERROR_COUNT){if(this.configuration[t.id])throw s.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}else e.loading||(e.loading=!0,t._load(this))},g.prototype.globalAssetIds=function(){var t,e=[],i=this.configuration;for(t in i)i.hasOwnProperty(t)&&i[t].global&&e.push(t);return e},g.prototype.requestAsset=function(t,e){"string"==typeof t?i=t:(i=t.id,t=this._normalizeAssetBaseDeclaration(i,Object.create(t)));var i,r,o=!1;return this._assets.hasOwnProperty(i)?(++this._refCounts[i],e._onAssetLoad(this._assets[i])):this._loadings.hasOwnProperty(i)?((r=this._loadings[i]).handlers.push(e),++this._refCounts[i],o=!0):(t=this._createAssetFor(t),r=new U(t,e),this._loadings[i]=r,this._refCounts[i]=1,r.loading=o=!0,t._load(this)),o},g.prototype.unrefAsset=function(t){t="string"==typeof t?t:t.id;0<--this._refCounts[t]||this._releaseAsset(t)},g.prototype.requestAssets=function(t,e){for(var i=0,r=0,o=t.length;r<o;++r)this.requestAsset(t[r],e)&&++i;return i},g.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},g.prototype._normalize=function(t){var e,i={};if(!(t instanceof Object))throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(e in t)if(t.hasOwnProperty(e)){var r=this._normalizeAssetBaseDeclaration(e,Object.create(t[e]));if(!r.path)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+e);if(!r.virtualPath)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+e);r.global||(r.global=!1),i[e]=r}return i},g.prototype._normalizeAssetBaseDeclaration=function(t,e){if(!e.type)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+t);if("image"===e.type){if("number"!=typeof e.width)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+t);if("number"!=typeof e.height)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+t)}var i;if("audio"===e.type&&(void 0===e.duration&&(e.duration=0),i=this._audioSystemConfMap[e.systemId],void 0===e.loop&&(e.loop=!!i&&!!i.loop),void 0===e.hint&&(e.hint=i?i.hint:{})),"video"===e.type&&!e.useRealSize){if("number"!=typeof e.width)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+t);if("number"!=typeof e.height)throw s.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+t);e.useRealSize=!1}return e},g.prototype._createAssetFor=function(t){r="string"==typeof t?(i=this.configuration[e=t],this.configuration[e].path):(e=t.id,(i=t).uri);var e,i,r,o=this.game.resourceFactory;if(!i)throw s.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+e);switch(i.type){case"image":var n=o.createImageAsset(e,r,i.width,i.height);return n.initialize(i.hint),n;case"audio":n=i.systemId?this.game.audio[i.systemId]:this.game.audio[this.game.defaultAudioSystemId];return o.createAudioAsset(e,r,i.duration,n,i.loop,i.hint);case"text":return o.createTextAsset(e,r);case"script":return o.createScriptAsset(e,r);case"video":return o.createVideoAsset(e,r,i.width,i.height,new s.VideoSystem,i.loop,i.useRealSize);default:throw s.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+i.type+" for asset ID: "+e)}},g.prototype._releaseAsset=function(t){var e,i=this._assets[t]||this._loadings[t]&&this._loadings[t].asset;if(i)if(e=i.path,i.inUse())if(i instanceof s.AudioAsset)i._system.requestDestroy(i);else{if(!(i instanceof s.VideoAsset))throw s.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+i.id);i.destroy()}else i.destroy();delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]&&((i=this.configuration[t].virtualPath)&&this._liveAssetVirtualPathTable.hasOwnProperty(i)&&delete this._liveAssetVirtualPathTable[i],e&&this._liveAbsolutePathTable.hasOwnProperty(e)&&delete this._liveAbsolutePathTable[e])},g.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},g.prototype._onAssetError=function(t,e){if(!this.destroyed()&&!t.destroyed()){var i=this._loadings[t.id],r=i.handlers;i.loading=!1,++i.errorCount,(e=i.errorCount>g.MAX_ERROR_COUNT&&e.retriable?s.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,s.AssetLoadErrorType.RetryLimitExceeded,e):e).retriable||delete this._loadings[t.id];for(var o=0;o<r.length;++o)r[o]._onAssetError(t,e,this)}},g.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed()){var e=this._loadings[t.id];if(e.loading=!1,delete this._loadings[t.id],this._assets[t.id]=t,this.configuration[t.id]){var i=this.configuration[t.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(i)){if(this._liveAssetVirtualPathTable[i].path!==t.path)throw s.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[i]=t;this._liveAbsolutePathTable.hasOwnProperty(t.path)||(this._liveAbsolutePathTable[t.path]=i)}for(var r=e.handlers,o=0;o<r.length;++o)r[o]._onAssetLoad(t)}},g.MAX_ERROR_COUNT=3,s.AssetManager=g,(u=t=t||{})._require=function(t,e,i){var r=t._assetManager._liveAssetVirtualPathTable,o=t._assetManager._moduleMainScripts;if(-1===e.indexOf("/")&&t._assetManager._assets.hasOwnProperty(e)&&(a=t._assetManager._assets[e],c=t._assetManager._liveAbsolutePathTable[a.path]),/^\.\/|^\.\.\/|^\//.test(e)){if(i){if(!i._virtualDirname)throw u.ExceptionFactory.createAssertionError("g._require: require from DynamicAsset is not supported");c=u.PathUtil.resolvePath(i._virtualDirname,e)}else{if(!/^\.\//.test(e))throw u.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");c=e.substring(2)}if(t._scriptCaches.hasOwnProperty(c))return t._scriptCaches[c]._cachedValue();if(t._scriptCaches.hasOwnProperty(c+".js"))return t._scriptCaches[c+".js"]._cachedValue();a=(a=a||u.Util.findAssetByPathAsFile(c,r))||u.Util.findAssetByPathAsDirectory(c,r)}else if(o[e]&&(c=o[e],a=t._assetManager._liveAssetVirtualPathTable[c]),!a){var n=i?i.paths:[];n.push("node_modules");for(var s=0;s<n.length;++s){var a,h=n[s],c=u.PathUtil.resolvePath(h,e);if(a=u.Util.findAssetByPathAsFile(c,r))break;if(a=u.Util.findAssetByPathAsDirectory(c,r))break}}if(a){if(t._scriptCaches.hasOwnProperty(c))return t._scriptCaches[c]._cachedValue();if(a instanceof u.ScriptAsset)return o=new u.ScriptAssetContext(t,a),(t._scriptCaches[c]=o)._executeScript(i);if(a instanceof u.TextAsset&&a&&".json"===u.PathUtil.resolveExtname(e))return(t._scriptCaches[c]=new u.RequireCachedValue(JSON.parse(a.data)))._cachedValue()}throw u.ExceptionFactory.createAssertionError("g._require: can not find module: "+e)},u.Module=function(e,t,i){var r=this,o=u.PathUtil.resolveDirname(i),n=(n=e._assetManager._liveAbsolutePathTable[i])?u.PathUtil.resolveDirname(n):void 0,s=Object.create(u,{game:{value:e,enumerable:!0},filename:{value:i,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=t,this.filename=i,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=n?u.PathUtil.makeNodeModulePaths(n):[],this._dirname=o,this._virtualDirname=n,this._g=s,this.require=function(t){return"g"===t?s:u._require(e,t,r)}},W=t=t||{},qt.prototype._cachedValue=function(){if(this._started)return this._module.exports;throw W.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.")},qt.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t).children.push(this._module),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0),this._module.exports},W.ScriptAssetContext=qt,f=t=t||{},y.prototype.update=function(t,e,i,r,o,n,s){var o=o*Math.PI/180,a=Math.cos(o),o=Math.sin(o),h=a*i,i=o*i,o=o*r,a=a*r,r=t/2,t=e/2;this._matrix[0]=h,this._matrix[1]=i,this._matrix[2]=-o,this._matrix[3]=a,this._matrix[4]=-h*r+o*t+r+n,this._matrix[5]=-i*r-a*t+t+s},y.prototype.updateWithAnchor=function(t,e,i,r,o,n,s,a,h){var o=o*Math.PI/180,c=Math.cos(o),o=Math.sin(o),u=c*i,i=o*i,o=o*r,c=c*r,r=a*t,a=h*e;this._matrix[0]=u,this._matrix[1]=i,this._matrix[2]=-o,this._matrix[3]=c,this._matrix[4]=-u*r+o*a+n,this._matrix[5]=-i*r-c*a+s},y.prototype.updateByInverse=function(t,e,i,r,o,n,s){var o=o*Math.PI/180,a=Math.cos(o),o=Math.sin(o),h=a/i,c=o/r,o=o/i,i=a/r,a=t/2,r=e/2;this._matrix[0]=h,this._matrix[1]=-c,this._matrix[2]=o,this._matrix[3]=i,this._matrix[4]=-h*(a+n)-o*(r+s)+a,this._matrix[5]=c*(a+n)-i*(r+s)+r},y.prototype.updateByInverseWithAnchor=function(t,e,i,r,o,n,s,a,h){var o=o*Math.PI/180,c=Math.cos(o),o=Math.sin(o),u=c/i,l=o/r,o=o/i,i=c/r,c=a*t,r=h*e;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=o,this._matrix[3]=i,this._matrix[4]=-u*n-o*s+c,this._matrix[5]=l*n-i*s+r},y.prototype.multiply=function(t){var e=this._matrix,t=t._matrix,i=e[0],r=e[1],o=e[2],n=e[3];e[0]=i*t[0]+o*t[1],e[1]=r*t[0]+n*t[1],e[2]=i*t[2]+o*t[3],e[3]=r*t[2]+n*t[3],e[4]=i*t[4]+o*t[5]+e[4],e[5]=r*t[4]+n*t[5]+e[5]},y.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},y.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},y.prototype.clone=function(){return new y(this)},y.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},y.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},y.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},f.PlainMatrix=y,l=t=t||{},(o=l.Util||(l.Util={})).distance=function(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))},o.distanceBetweenOffsets=function(t,e){return o.distance(t.x,t.y,e.x,e.y)},o.distanceBetweenAreas=function(t,e){return o.distance(t.x+t.width/2,t.y+t.height/2,e.x+e.width/2,e.y+e.height/2)},o.createMatrix=function(t,e,i,r,o,n,s){return void 0===t?new l.PlainMatrix:new l.PlainMatrix(t,e,i,r,o,n,s)},o.createSpriteFromE=function(t,e,i){var r,o,n=e.x,s=e.y,a=0,h=0,c=(e.width,e.height,e.calculateBoundingRect(i));if(c)return r=c.right-c.left,o=c.bottom-c.top,c.left<e.x&&(a=e.x-c.left),c.top<e.y&&(h=e.y-c.top),e.moveTo(a,h),e._matrix&&(e._matrix._modified=!0),a=t.game.resourceFactory.createSurface(Math.ceil(r),Math.ceil(o)),(h=a.renderer()).begin(),e.render(h,i),h.end(),(i=new l.Sprite({scene:t,src:a,width:r,height:o})).moveTo(c.left,c.top),e.moveTo(n,s),e._matrix&&(e._matrix._modified=!0),i;throw l.ExceptionFactory.createAssertionError("Util#createSpriteFromE: camera must look e")},o.createSpriteFromScene=function(t,e,i){for(var r=t.game.resourceFactory.createSurface(Math.ceil(e.game.width),Math.ceil(e.game.height)),o=r.renderer(),n=(o.begin(),e.children),s=0;s<n.length;++s)n[s].render(o,i);return o.end(),new l.Sprite({scene:t,src:r,width:e.game.width,height:e.game.height})},o.asSurface=function(t){if(!t)return t;if(t instanceof l.Surface)return t;if(t instanceof l.ImageAsset)return t.asSurface();throw l.ExceptionFactory.createTypeMismatchError("Util#asSurface","ImageAsset|Surface",t)},o.findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},o.findAssetByPathAsDirectory=function(t,e){var i=t+"/package.json";if(e.hasOwnProperty(i)&&e[i]instanceof l.TextAsset){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){r=o.findAssetByPathAsFile(l.PathUtil.resolvePath(t,r.main),e);if(r)return r}}if(e.hasOwnProperty(i=t+"/index.js"))return e[i]},o.charCodeAt=function(t,e){var i=t.charCodeAt(e);return 55296<=i&&i<=56319?i<<16|t.charCodeAt(e+1):56320<=i&&i<=57343?null:i},o.setupAnimatingHandler=function(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())},o.migrateAnimatingHandler=function(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())},N=t=t||{},(B=N.Collision||(N.Collision={})).intersect=function(t,e,i,r,o,n,s,a){return t<=o+s&&o<=t+i&&e<=n+a&&n<=e+r},B.intersectAreas=function(t,e){return B.intersect(t.x,t.y,t.width,t.height,e.x,e.y,e.width,e.height)},B.within=function(t,e,i,r,o){return(o=void 0===o?1:o)>=N.Util.distance(t,e,i,r)},B.withinAreas=function(t,e,i){return(i=void 0===i?1:i)>=N.Util.distanceBetweenAreas(t,e)};var _=t=t||{},f=(m.prototype.add=function(t,e){"function"==typeof t?this._handlers.push({func:t,owner:e,once:!1,name:void 0}):"number"==typeof(e=t).index?this._handlers.splice(e.index,0,{func:e.func,owner:e.owner,once:!1,name:e.name}):this._handlers.push({func:e.func,owner:e.owner,once:!1,name:e.name}),this.length=this._handlers.length},m.prototype.addOnce=function(t,e){"function"==typeof t?this._handlers.push({func:t,owner:e,once:!0,name:void 0}):"number"==typeof(e=t).index?this._handlers.splice(e.index,0,{func:e.func,owner:e.owner,once:!0,name:e.name}):this._handlers.push({func:e.func,owner:e.owner,once:!0,name:e.name}),this.length=this._handlers.length},m.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},m.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];!r.func.call(r.owner,t)&&!r.once||-1!==(r=this._handlers.indexOf(r))&&this._handlers.splice(r,1)}this._handlers&&(this.length=this._handlers.length)}},m.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},m.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var o=this._handlers[r];if(i.func===o.func&&i.owner===o.owner&&i.name===o.name)return this._handlers.splice(r,1),void--this.length}},m.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},m.prototype.destroy=function(){this._handlers=null,this.length=null},m.prototype.destroyed=function(){return null===this._handlers},m.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},m);function m(){this._handlers=[],this.length=0}_.Trigger=f,e(v,Xt=f),v.prototype.add=function(t,e){Xt.prototype.add.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},v.prototype.addOnce=function(t,e){Xt.prototype.addOnce.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},v.prototype.remove=function(t,e){Xt.prototype.remove.call(this,t,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},v.prototype.removeAll=function(t){Xt.prototype.removeAll.call(this,t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},v.prototype.destroy=function(){Xt.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},v.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)};var Xt,f=v;function v(t,e,i){var r=Xt.call(this)||this;return r.chain=t,r.filter=e,r.filterOwner=i,r._isActivated=!1,r}function zt(t,e){this.interval=t,this._scaledInterval=Math.round(t*e),this.elapsed=new j.Trigger,this._scaledElapsed=0}function Yt(t,e,i,r,o){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=o,this._timer.elapsed.add(this._fire,this)}function T(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}function A(t){this.played=new q.Trigger,this.stopped=new q.Trigger,this.currentAudio=void 0,this.volume=t.volume,this._muted=t._muted,this._playbackRate=t._playbackRate,this._system=t}_.ChainTrigger=v,j=t=t||{},zt.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},zt.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},zt.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},zt.prototype.destroyed=function(){return void 0===this.elapsed},j.Timer=zt,n=t=t||{},Yt.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},Yt.prototype.destroyed=function(){return void 0===this._timer},Yt.prototype._fire=function(){this.destroyed()||(this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this))},V=Yt,n.TimerIdentifier=V,T.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},T.prototype.destroyed=function(){return void 0===this._timers},T.prototype.createTimer=function(t){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),t<0)throw n.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");t<1&&(t=1);for(var e=Math.min(1e3,t*this._fps),i=0;i<this._timers.length;++i)if(this._timers[i].interval===t&&this._timers[i]._scaledElapsed<e)return this._timers[i];var r=new n.Timer(t,this._fps);return this._timers.push(r),r},T.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(e<0)throw n.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(e,1),t.destroy(),!this._timers.length){if(!this._registered)throw n.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},T.prototype.setTimeout=function(t,e,i){e=this.createTimer(e),e=new V(e,t,i,this._onTimeoutFired,this);return this._identifiers.push(e),e},T.prototype.clearTimeout=function(t){this._clear(t)},T.prototype.setInterval=function(t,e,i){e=this.createTimer(e),e=new V(e,t,i);return this._identifiers.push(e),e},T.prototype.clearInterval=function(t){this._clear(t)},T.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},T.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw n.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(e,1);e=t._timer;t.destroy(),this.deleteTimer(e)},T.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw n.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(t.destroyed())throw n.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(e,1);e=t._timer;t.destroy(),this.deleteTimer(e)},n.TimerManager=T,q=t=t||{},A.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},A.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},A.prototype.canHandleStopped=function(){return!0},A.prototype.changeVolume=function(t){this.volume=t},A.prototype._changeMuted=function(t){this._muted=t},A.prototype._changePlaybackRate=function(t){this._playbackRate=t},A.prototype._supportsPlaybackRate=function(){return!1},A.prototype._onVolumeChanged=function(){},q.AudioPlayer=A;var Kt,Jt=t=t||{},f=(Object.defineProperty($t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||1<t||isNaN(t)||"number"!=typeof t)throw Jt.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!0,configurable:!0}),$t.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},$t.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},$t.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},$t.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw Jt.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);var e=this._playbackRate;this._playbackRate=t,this._playbackRate!==e&&this._onPlaybackRateChanged()},$t);function $t(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}function x(t,e){t=Kt.call(this,t,e)||this;return t._player=void 0,t._suppressingAudio=void 0,t}Jt.AudioSystem=f,e(x,Kt=f),Object.defineProperty(x.prototype,"player",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),x.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},x.prototype.createPlayer=function(){return this.player},x.prototype.stopAll=function(){this._player&&this._player.stop()},x.prototype._reset=function(){Kt.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},x.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},x.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},x.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},x.prototype._onUnsupportedPlaybackRateChanged=function(){var t;1===this._playbackRate&&this._suppressingAudio&&(t=this._suppressingAudio,this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1))},x.prototype._onPlayerPlayed=function(t){if(t.player!==this._player)throw Jt.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player");t.player._supportsPlaybackRate()||1!==this._playbackRate&&(t.player._changeMuted(!0),this._suppressingAudio=t.audio)},x.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},Jt.MusicAudioSystem=x,e(w,Zt=f),w.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},w.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},w.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},w.prototype._reset=function(){Zt.prototype._reset.call(this);for(var t=0;t<this.players.length;++t){var e=this.players[t];e.played.remove({owner:this,func:this._onPlayerPlayed}),e.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},w.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},w.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},w.prototype._onPlayerPlayed=function(t){t.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},w.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},w.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)};var Zt;function w(t,e){t=Zt.call(this,t,e)||this;return t.players=[],t}function Qt(t){this._loop=!!t,this.played=new X.Trigger,this.stopped=new X.Trigger,this.currentVideo=void 0,this.volume=1}function S(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity="opacity"in t?t.opacity:1,this.scaleX="scaleX"in t?t.scaleX:1,this.scaleY="scaleY"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0),this._matrix=void 0}function E(t){var e=Y.call(this,t)||this;if(e.children=void 0,e.parent=void 0,e._touchable=!1,e.state=0,e._hasTouchableChildren=!1,e._update=void 0,e._message=void 0,e._pointDown=void 0,e._pointMove=void 0,e._pointUp=void 0,e._targetCameras=void 0,e.tag=t.tag,e.shaderProgram=t.shaderProgram,e.local=t.scene.local!==r.LocalTickMode.NonLocal||!!t.local,t.children)for(var i=0;i<t.children.length;++i)e.append(t.children[i]);return t.parent&&t.parent.append(e),t.targetCameras&&(e.targetCameras=t.targetCameras),"touchable"in t&&(e.touchable=t.touchable),t.hidden&&e.hide(),e.id=t.id,t.scene.register(e),e}function b(t){t=K.call(this,t)||this;return t._shouldRenderChildren=!0,t._cache=void 0,t._renderer=void 0,t._renderedCamera=void 0,t}Jt.SoundAudioSystem=w,X=t=t||{},Qt.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},Qt.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},Qt.prototype.changeVolume=function(t){this.volume=t},X.VideoPlayer=Qt,(t||(t={})).VideoSystem=function(){},z=t=t||{},S.prototype.moveTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw z.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof t?(this.x=t,this.y=e):(this.x=t.x,this.y=t.y)},S.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},S.prototype.resizeTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw z.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height)},S.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},S.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},S.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},S.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=z.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},S.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},z.Object2D=S,r=t=t||{},Y=r.Object2D,e(E,Y),Object.defineProperty(E.prototype,"update",{get:function(){return this._update||(this._update=new r.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"message",{get:function(){return this._message||(this._message=new r.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"pointDown",{get:function(){return this._pointDown||(this._pointDown=new r.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"pointUp",{get:function(){return this._pointUp||(this._pointUp=new r.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"pointMove",{get:function(){return this._pointMove||(this._pointMove=new r.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"targetCameras",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&((this._touchable=t)?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),E.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&0<i.length)||e&&-1!==i.indexOf(e))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var r=(n=this.children).length,o=0;o<r;++o)n[o].render(t,e);t.translate(-this.x,-this.y)}else{if(t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children)for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);t.restore()}}},E.prototype.renderSelf=function(t,e){return!0},E.prototype.game=function(){return this.scene.game},E.prototype.append=function(t){this.insertBefore(t,void 0)},E.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},E.prototype.remove=function(t){if(void 0===t)this.parent.remove(this);else{var e=this.children?this.children.indexOf(t):-1;if(e<0)throw r.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),!t._touchable&&!t._hasTouchableChildren||this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation()),this.modified(!0)}},E.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;0<=t;--t)this.children[t].destroy();if(0!==this.children.length)throw r.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},E.prototype.destroyed=function(){return void 0===this.scene},E.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},E.prototype.shouldFindChildrenByPoint=function(t){return!0},E.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var o=this._targetCameras;if(!(o&&0<o.length)||r&&-1!==o.indexOf(r)){o=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var n=this.children.length-1;0<=n;--n){var s=this.children[n];if(i||s._touchable||s._hasTouchableChildren){s=s.findPointSourceByPoint(t,e,i,r);if(s)return s}}return i||this._touchable?0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0:void 0}}},E.prototype.visible=function(){return 1!=(1&this.state)},E.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},E.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},E.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},E.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var t={left:0,right:this.width,top:0,bottom:this.height},r=[{x:t.left,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.top},{x:t.right,y:t.bottom}],o=i.multiplyPoint(r[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},s=1;s<r.length;++s)o=i.multiplyPoint(r[s]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);if(void 0!==this.children)for(s=0;s<this.children.length;++s){var a=this.children[s]._calculateBoundingRect(i,e);a&&(n.left>a.left&&(n.left=a.left),n.right<a.right&&(n.right=a.right),n.top>a.top&&(n.top=a.top),n.bottom<a.bottom&&(n.bottom=a.bottom))}return n}},E.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof E&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},E.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof E&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},E.prototype._isTargetOperation=function(t){return!(1&this.state)&&(t instanceof r.PointEvent&&(this._touchable&&t.target===this))},E.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r.E=E,_=t=t||{},K=_.E,e(b,K),b.prototype.invalidate=function(){this.state&=-3,this.modified()},b.prototype.renderSelf=function(t,e){var i,r,o,n=b.PADDING;return this._renderedCamera!==e&&(this.state&=-3,this._renderedCamera=e),2&this.state||(this._cacheSize=this.calculateCacheSize(),o=Math.ceil(this._cacheSize.width)+2*n,i=Math.ceil(this._cacheSize.height)+2*n,(r=!this._cache||this._cache.width<o||this._cache.height<i)&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(o,i),this._renderer=this._cache.renderer()),(o=this._renderer).begin(),r||o.clear(),o.save(),o.translate(n,n),this.renderCache(o,e),o.restore(),this.state|=2,o.end()),this._cache&&0<this._cacheSize.width&&0<this._cacheSize.height&&(t.translate(-n,-n),this.renderSelfFromCache(t),t.translate(n,n)),this._shouldRenderChildren},b.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+b.PADDING,this._cacheSize.height+b.PADDING,0,0)},b.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,K.prototype.destroy.call(this)},b.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},b.PADDING=1,_.CacheableE=b;var f=t=t||{};(_=f.StorageRegion||(f.StorageRegion={}))[_.Slots=1]="Slots",_[_.Scores=2]="Scores",_[_.Counts=3]="Counts",_[_.Values=4]="Values",(_=f.StorageOrder||(f.StorageOrder={}))[_.Asc=0]="Asc",_[_.Desc=1]="Desc",(_=f.StorageCondition||(f.StorageCondition={}))[_.Equal=1]="Equal",_[_.GreaterThan=2]="GreaterThan",_[_.LessThan=3]="LessThan",(_=f.StorageCountsOperation||(f.StorageCountsOperation={}))[_.Incr=1]="Incr",_[_.Decr=2]="Decr",ee.prototype.get=function(t){if(void 0!==this._values){if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}}return[]},ee.prototype.getOne=function(t){t=this.get(t);if(t)return t[0]};var te=ee;function ee(t,e){this._keys=t,this._values=e}f.StorageValueStore=te,re.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},re.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},re.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)};var ie=re;function re(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new te(e),this._handler=void 0,this._valueStoreSerialization=i}function oe(t){this._game=t}function ne(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}function P(t){var e,i,r=t.game,o=t.assetIds;t.storageKeys?(this._storageLoader=r.storage._createLoader(t.storageKeys,t.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),e=void 0===t.local||!1===t.local?h.LocalTickMode.NonLocal:!0===t.local?h.LocalTickMode.FullLocal:t.local,i=void 0!==t.tickGenerationMode?t.tickGenerationMode:h.TickGenerationMode.ByClock,this.name=t.name,o=o||[],this.game=r,this.local=e,this.tickGenerationMode=i,this.loaded=new h.Trigger,this._ready=new h.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=$.Initial,this.update=new h.Trigger,this._timer=new h.TimerManager(this.update,this.game.fps),this.assetLoaded=new h.Trigger,this.assetLoadFailed=new h.Trigger,this.assetLoadCompleted=new h.Trigger,this.message=new h.Trigger,this.pointDownCapture=new h.Trigger,this.pointMoveCapture=new h.Trigger,this.pointUpCapture=new h.Trigger,this.operation=new h.Trigger,this.children=[],this.state=J.Standby,this.stateChanged=new h.Trigger,this._assetHolders=[],this._sceneAssetHolder=new Z({scene:this,assetManager:this.game._assetManager,assetIds:o,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}function k(t){var e=this;return t.local=!0,(e=Q.call(this,t)||this).targetReset=new i.Trigger,e.targetReady=new i.Trigger,e.targetAssetLoaded=new i.Trigger,e._explicitEnd=!!t.explicitEnd,e._targetScene=void 0,e}function se(t){t=et.call(this,t)||this;return t._canceller=new tt.Object2D,t}function ae(t){var e=rt.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}function R(t){var e=nt.call(this,t)||this;return e.surface=ot.Util.asSurface(t.src),"width"in t||(e.width=e.surface.width),"height"in t||(e.height=e.surface.height),e.srcWidth="srcWidth"in t?t.srcWidth:e.width,e.srcHeight="srcHeight"in t?t.srcHeight:e.height,e.srcX=t.srcX||0,e.srcY=t.srcY||0,e._stretchMatrix=void 0,e._beforeSurface=e.surface,ot.Util.setupAnimatingHandler(e,e.surface),e._invalidateSelf(),e}function L(t){var e=at.call(this,t)||this;return e._lastUsedIndex=0,e.frameNumber=t.frameNumber||0,e.frames="frames"in t?t.frames:[0],e.interval=t.interval,e._timer=void 0,e.loop=null==t.loop||t.loop,e.finished=new st.Trigger,e._modifiedSelf(),e}f.StorageLoader=ie,oe.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},oe.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},oe.prototype._createLoader=function(t,e){return new ie(this,t,e)},oe.prototype._registerWrite=function(t){this._write=t},oe.prototype._registerLoad=function(t){this._load=t},f.Storage=oe,h=t=t||{},ne.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},ne.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},ne.prototype.destroyed=function(){return!this._scene},ne.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},ne.prototype._onAssetError=function(t,e,i){var r;this.destroyed()||this._scene.destroyed()||(this._scene.assetLoadFailed.fire(r={asset:t,error:e,cancelRetry:!1}),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t))},ne.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[t.id]=t,this._scene.assetLoaded.fire(t),this._scene.assetLoadCompleted.fire(t),this._assets.push(t),--this.waitingAssetsCount,this.waitingAssetsCount<0)throw h.ExceptionFactory.createAssertionError("SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount");0<this.waitingAssetsCount||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},Z=ne,h.SceneAssetHolder=Z,(_=J=h.SceneState||(h.SceneState={}))[_.Destroyed=0]="Destroyed",_[_.Standby=1]="Standby",_[_.Active=2]="Active",_[_.Deactive=3]="Deactive",_[_.BeforeDestroyed=4]="BeforeDestroyed",(_=$=h.SceneLoadState||(h.SceneLoadState={}))[_.Initial=0]="Initial",_[_.Ready=1]="Ready",_[_.ReadyFired=2]="ReadyFired",_[_.LoadedFired=3]="LoadedFired",P.prototype.modified=function(t){this.game.modified=!0},P.prototype.destroy=function(){this.state=J.BeforeDestroyed,this.stateChanged.fire(this.state);var t,e=this.game.db;for(t in e)e.hasOwnProperty(t)&&e[t].scene===this&&e[t].destroy();for(t in e=this.game._localDb)e.hasOwnProperty(t)&&e[t].scene===this&&e[t].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var i=0;i<this._assetHolders.length;++i)this._assetHolders[i].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=J.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},P.prototype.destroyed=function(){return void 0===this.game},P.prototype.createTimer=function(t){return this._timer.createTimer(t)},P.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},P.prototype.setInterval=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},P.prototype.clearInterval=function(t){this._timer.clearInterval(t)},P.prototype.setTimeout=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},P.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},P.prototype.isCurrentScene=function(){return this.game.scene()===this},P.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw h.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},P.prototype.end=function(){if(!this.isCurrentScene())throw h.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},P.prototype.register=function(t){this.game.register(t),t.scene=this},P.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},P.prototype.append=function(t){this.insertBefore(t,void 0)},P.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},P.prototype.remove=function(t){t=this.children.indexOf(t);-1!==t&&(this.children[t].parent=void 0,this.children.splice(t,1),this.modified(!0))},P.prototype.findPointSourceByPoint=function(t,e,i){var r=this.local!==h.LocalTickMode.NonLocal,o=this.children,n=void 0;i&&i instanceof h.Camera2D&&(n=i.getMatrix());for(var s=o.length-1;0<=s;--s){var a=o[s].findPointSourceByPoint(t,n,e,i);if(a)return a.local=a.target.local||r,a}return{target:void 0,point:void 0,local:r}},P.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},P.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},P.prototype.requestAssets=function(t,e){if(this._loadingState<$.ReadyFired)throw h.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");t=new Z({scene:this,assetManager:this.game._assetManager,assetIds:t,handler:e});this._assetHolders.push(t),t.request()},P.prototype._activate=function(){this.state=J.Active,this.stateChanged.fire(this.state)},P.prototype._deactivate=function(){this.state=J.Deactive,this.stateChanged.fire(this.state)},P.prototype._needsLoading=function(){return 0<this._sceneAssetHolder.waitingAssetsCount||this._storageLoader&&!this._storageLoader._loaded},P.prototype._load=function(){var t;this._loaded||(this._loaded=!0,t=this._sceneAssetHolder.request(),this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady())},P.prototype._onSceneAssetsLoad=function(){!this._loaded||this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady()},P.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},P.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},P.prototype._notifySceneReady=function(){this._loadingState=$.Ready,this.game._fireSceneReady(this)},P.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=$.ReadyFired},P.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=$.LoadedFired},h.Scene=P,i=t=t||{},Q=i.Scene,e(k,Q),k.prototype.destroy=function(){this._clearTargetScene(),Q.prototype.destroy.call(this)},k.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,this._loadingState<i.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},k.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},k.prototype.end=function(){var t;if(!this._targetScene||this._targetScene._loadingState<i.SceneLoadState.Ready)throw t=this._targetScene?i.SceneLoadState[this._targetScene._loadingState]:"(no scene)",i.ExceptionFactory.createAssertionError("LoadingScene#end(): the target scene is in invalid state: "+t);this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},k.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},k.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<i.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},k.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},k.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},i.LoadingScene=k,tt=t=t||{},et=tt.E,e(se,et),se.prototype.renderSelf=function(t,e){if(this.children){e&&(r=this._canceller,(i=e).x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix));for(var i,r,o=this.children,n=0;n<o.length;++n)o[n].render(t,e);e&&t.restore()}return!1},it=se,rt=tt.LoadingScene,e(ae,rt),ae.prototype._onLoaded=function(){var t;return this.append(new it({scene:this,children:[new tt.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:"rgba(0, 0, 0, 0.8)",children:[new tt.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[t=new tt.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),t.update.handle(this,this._onUpdateGuage),this._gauge=t,!0},ae.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},ae.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},ae.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},tt.DefaultLoadingScene=ae,ot=t=t||{},nt=ot.E,e(R,nt),R.prototype._onUpdate=function(){this.modified()},R.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},R.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},R.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},R.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},R.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,nt.prototype.destroy.call(this)},R.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=ot.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(ot.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},ot.Sprite=R,st=t=t||{},at=st.Sprite,e(L,at),L.createBySprite=function(t,e,i){var r=new L({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return r.srcHeight=void 0===i?t.srcHeight:i,r.srcWidth=void 0===e?t.srcWidth:e,r},L.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},L.prototype.destroy=function(t){this.stop(),at.prototype.destroy.call(this,t)},L.prototype.stop=function(){this._timer&&this._free()},L.prototype.modified=function(t){this._modifiedSelf(t),at.prototype.modified.call(this,t)},L.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},L.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},L.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},L.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},st.FrameSprite=L;var f=t=t||{};function he(t,e,i,r,o,n){this.priority=n,this.local=o,this.player=r,this.pointerId=t,this.target=e,this.point=i}(_=M=f.EventType||(f.EventType={}))[_.Unknown=0]="Unknown",_[_.Join=1]="Join",_[_.Leave=2]="Leave",_[_.Timestamp=3]="Timestamp",_[_.Seed=4]="Seed",_[_.PointDown=5]="PointDown",_[_.PointMove=6]="PointMove",_[_.PointUp=7]="PointUp",_[_.Message=8]="Message",_[_.Operation=9]="Operation",f.PointEvent=he,e(ue,ce=he);var M,ce,_=ue;function ue(t,e,i,r,o,n){t=ce.call(this,t,e,i,r,o,n)||this;return t.type=M.PointDown,t}f.PointDownEvent=_,e(de,le=he);var le,_=de;function de(t,e,i,r,o,n,s,a){t=le.call(this,t,e,i,n,s,a)||this;return t.type=M.PointUp,t.prevDelta=r,t.startDelta=o,t}f.PointUpEvent=_,e(fe,pe=he);var pe,_=fe;function fe(t,e,i,r,o,n,s,a){t=pe.call(this,t,e,i,n,s,a)||this;return t.type=M.PointMove,t.prevDelta=r,t.startDelta=o,t}function _e(t,e,i,r,o){this.type=M.Operation,this.priority=o,this.local=r,this.player=i,this.code=t,this.data=e}function ge(t,e,i){this.type=M.Join,this.priority=i,this.player=t,this.storageValues=e}function ye(t,e){this.type=M.Leave,this.priority=e,this.player=t}function me(t,e,i){this.type=M.Timestamp,this.priority=i,this.player=e,this.timestamp=t}function ve(t,e){this.type=M.Seed,this.priority=e,this.generator=t}function Te(t){this.game=t,this.logging=new ht.Trigger}function O(t,e,i,r,o){t=this._normalizeConfiguration(t),this.fps=t.fps,this.width=t.width,this.height=t.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=i||"",this.resourceFactory=e,this.selfId=r||void 0,this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this._audioSystemManager=new a.AudioSystemManager(this),this.audio={music:new a.MusicAudioSystem("music",this),sound:new a.SoundAudioSystem("sound",this)},this.defaultAudioSystemId="sound",this.storage=new a.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new a.Trigger,this.leave=new a.Trigger,this.seed=new a.Trigger,this._eventTriggerMap={},this._eventTriggerMap[a.EventType.Join]=this.join,this._eventTriggerMap[a.EventType.Leave]=this.leave,this._eventTriggerMap[a.EventType.Seed]=this.seed,this._eventTriggerMap[a.EventType.Message]=void 0,this._eventTriggerMap[a.EventType.PointDown]=void 0,this._eventTriggerMap[a.EventType.PointMove]=void 0,this._eventTriggerMap[a.EventType.PointUp]=void 0,this._eventTriggerMap[a.EventType.Operation]=void 0,this.resized=new a.Trigger,this.skippingChanged=new a.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new a.Trigger,this._started=new a.Trigger,this.isLoaded=!1,this.snapshotRequest=new a.Trigger,this.external={},this.logger=new a.Logger(this),this._main=t.main,this._mainParameter=void 0,this._configuration=t,this._assetManager=new a.AssetManager(this,t.assets,t.audio,t.moduleMainScripts);i=t.operationPlugins||[];this._operationPluginManager=new a.OperationPluginManager(this,o,i),this._operationPluginOperated=new a.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new a.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new a.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}function Ae(t){var e=ut.call(this,t)||this;return e.game=t.game,e.local=!!t.local,e.name=t.name,e._modifiedCount=0,e.width=t.game.width,e.height=t.game.height,e.id=e.local?void 0:e.game._cameraIdx++,e}function xe(){}function we(t,e,i,r){if(void 0===r&&(r=!1),t%1!=0||e%1!=0)throw lt.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");this.width=t,this.height=e,i&&(this._drawable=i),this.isDynamic=r,this.isDynamic?(this.animatingStarted=new lt.Trigger,this.animatingStopped=new lt.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}function C(t){var e=dt.call(this,t)||this;return e.text=t.text,e.font=t.font,e.textAlign="textAlign"in t?t.textAlign:c.TextAlign.Left,e.glyphs=new Array(t.text.length),e.fontSize=t.fontSize,e.maxWidth=t.maxWidth,e.widthAutoAdjust=!("widthAutoAdjust"in t)||t.widthAutoAdjust,e.textColor=t.textColor,e._textWidth=0,e._game=void 0,e._overhangLeft=0,e._overhangRight=0,e._invalidateSelf(),e}function Se(t,e,i,r,o,n,s,a,h,c){void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=o,this.offsetX=n,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}function Ee(t){var e=ft.call(this,t)||this;if("string"!=typeof t.cssColor)throw pt.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",t.cssColor);return e.cssColor=t.cssColor,e}function F(t){var e=gt.call(this,t)||this;return e._oldWidth=t.width,e._oldHeight=t.height,e.backgroundImage=_t.Util.asSurface(t.backgroundImage),e.backgroundEffector=t.backgroundEffector,e._shouldRenderChildren=!1,e._padding=t.padding,e._initialize(),e._paddingChanged=!1,e._bgSurface=void 0,e._bgRenderer=void 0,e}function be(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}function Pe(t,e,i){this.operated=new yt.Trigger,this.plugins={},this._game=t,this._viewInfo=e,this._infos=i,this._initialized=!1}function ke(){}function Re(t){var e=At.call(this)||this;if(e.fontFamily=t.fontFamily,e.size=t.size,e.hint="hint"in t?t.hint:{},e.fontColor="fontColor"in t?t.fontColor:"black",e.fontWeight="fontWeight"in t?t.fontWeight:Tt.Normal,e.strokeWidth="strokeWidth"in t?t.strokeWidth:0,e.strokeColor="strokeColor"in t?t.strokeColor:"black",e.strokeOnly="strokeOnly"in t&&t.strokeOnly,e._resourceFactory=t.game.resourceFactory,e._glyphFactory=e._resourceFactory.createGlyphFactory(e.fontFamily,e.size,e.hint.baselineHeight,e.fontColor,e.strokeWidth,e.strokeColor,e.strokeOnly,e.fontWeight),e._glyphs={},e._destroyed=!1,e._isSurfaceAtlasSetOwner=!1,t.surfaceAtlasSet?e._atlasSet=t.surfaceAtlasSet:t.hint?(e._isSurfaceAtlasSetOwner=!0,e._atlasSet=new d.SurfaceAtlasSet({game:t.game,hint:e.hint})):e._atlasSet=t.game.surfaceAtlasSet,e.hint.presetChars)for(var i=0,r=e.hint.presetChars.length;i<r;i++){var o=d.Util.charCodeAt(e.hint.presetChars,i);o&&e.glyphForCharacter(o)}return e}function Le(t){var e=wt.call(this)||this;return e.surface=xt.Util.asSurface(t.src),e.map=t.map,e.defaultGlyphWidth=t.defaultGlyphWidth,e.defaultGlyphHeight=t.defaultGlyphHeight,e.missingGlyph=t.missingGlyph,e.size=t.defaultGlyphHeight,e}f.PointMoveEvent=_,f.MessageEvent=function(t,e,i,r){this.type=M.Message,this.priority=r,this.local=i,this.player=e,this.data=t},f.OperationEvent=_e,f.JoinEvent=ge,f.LeaveEvent=ye,f.TimestampEvent=me,f.SeedEvent=ve,ht=t=t||{},(_=ct=ht.LogLevel||(ht.LogLevel={}))[_.Error=0]="Error",_[_.Warn=1]="Warn",_[_.Info=2]="Info",_[_.Debug=3]="Debug",Te.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},Te.prototype.destroyed=function(){return!this.game},Te.prototype.error=function(t,e){this.logging.fire({game:this.game,level:ct.Error,message:t,cause:e})},Te.prototype.warn=function(t,e){this.logging.fire({game:this.game,level:ct.Warn,message:t,cause:e})},Te.prototype.info=function(t,e){this.logging.fire({game:this.game,level:ct.Info,message:t,cause:e})},Te.prototype.debug=function(t,e){this.logging.fire({game:this.game,level:ct.Debug,message:t,cause:e})},_=Te,ht.Logger=_,a=t=t||{},Object.defineProperty(O.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),O.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},O.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},O.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},O.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},O.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var o=0;o<r.length;++o){var n=this._eventTriggerMap[r[o].type];n&&n.fire(r[o])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},O.prototype.render=function(t){t=t||this.focusingCamera;for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},O.prototype.findPointSource=function(t,e){return e=e||this.focusingCamera,this.scene().findPointSourceByPoint(t,!1,e)},O.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(0<t.id)throw a.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.hasOwnProperty(String(t.id)))throw a.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb[t.id]=t}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw a.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.hasOwnProperty(String(t.id)))throw a.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db[t.id]=t}},O.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},O.prototype.leaveGame=function(){this._leaveGame()},O.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},O.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},O.prototype._fireSceneLoaded=function(t){t._loadingState<a.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:t})},O.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},O.prototype._normalizeConfiguration=function(t){if(!t)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if("assets"in t||(t.assets={}),"fps"in t||(t.fps=30),"number"!=typeof t.fps)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw a.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},O.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},O.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},O.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},O.prototype._reset=function(t){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.randGen&&(this.random=t.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this.isSkipping=!1,this.skippingChanged.add(this._handleSkippingChanged,this),this.joinedPlayerIds=[],this.join.add(this._handleJoinEvent,this),this.leave.add(this._handleLeaveEvent,this),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new a.SurfaceAtlasSet({game:this}),"none"===this._configuration.defaultLoadingScene?this._defaultLoadingScene=new a.LoadingScene({game:this}):this._defaultLoadingScene=new a.DefaultLoadingScene({game:this})},O.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},O.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},O.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw a.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},O.prototype._updateEventTriggers=function(t){this.modified=!0,t?(this._eventTriggerMap[a.EventType.Message]=t.message,this._eventTriggerMap[a.EventType.PointDown]=t.pointDownCapture,this._eventTriggerMap[a.EventType.PointMove]=t.pointMoveCapture,this._eventTriggerMap[a.EventType.PointUp]=t.pointUpCapture,this._eventTriggerMap[a.EventType.Operation]=t.operation,t._activate()):(this._eventTriggerMap[a.EventType.Message]=void 0,this._eventTriggerMap[a.EventType.PointDown]=void 0,this._eventTriggerMap[a.EventType.PointMove]=void 0,this._eventTriggerMap[a.EventType.PointUp]=void 0,this._eventTriggerMap[a.EventType.Operation]=void 0)},O.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},O.prototype._abortGame=function(){},O.prototype._flushSceneChangeRequests=function(){do{var t=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var e=0;e<t.length;++e){var i=t[e];switch(i.type){case 0:var r=this.scene();r&&r._deactivate(),this._doPushScene(i.scene);break;case 1:this._doPopScene(i.preserveCurrent,!1),this._doPushScene(i.scene);break;case 2:this._doPopScene(i.preserveCurrent,!0);break;case 3:i.scene.destroyed()||i.scene._fireReady();break;case 4:i.scene.destroyed()||i.scene._fireLoaded();break;case 5:i.assetHolder.destroyed()||i.assetHolder.callHandler();break;default:throw a.ExceptionFactory.createAssertionError("Game#_flushSceneChangeRequests: unknown scene change request.")}}}while(0<this._sceneChangeRequests.length)},O.prototype._handleSkippingChanged=function(t){this.isSkipping=t},O.prototype._handleJoinEvent=function(t){-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},O.prototype._handleLeaveEvent=function(e){this.joinedPlayerIds=this.joinedPlayerIds.filter(function(t){return t!==e.player.id})},O.prototype._doPopScene=function(t,e){var i=this.scenes.pop();if(i===this._initialScene)throw a.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");t||i.destroy(),e&&this._sceneChanged.fire(this.scene())},O.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,this._main){var t=a._require(this,this._main);if(!t||"function"!=typeof t)throw a.ExceptionFactory.createAssertionError("Game#_start: Entry point '"+this._main+"' not found.");t(this._mainParameter)}else if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw a.ExceptionFactory.createAssertionError("Game#_start: global asset 'snapshotLoader' not found.");a._require(this,"snapshotLoader")(this._mainParameter.snapshot)}else{if(!this.assets.mainScene)throw a.ExceptionFactory.createAssertionError("Game#_start: global asset 'mainScene' not found.");t=a._require(this,"mainScene")();this.pushScene(t)}this._flushSceneChangeRequests(),this._started.fire()},O.prototype._doPushScene=function(t,e){if(e=e||this.loadingScene||this._defaultLoadingScene,this.scenes.push(t),t._needsLoading()&&t._loadingState<a.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw a.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(e,this._defaultLoadingScene),e.reset(t)}else this._sceneChanged.fire(t),t._loaded||(t._load(),this._fireSceneLoaded(t));this.modified=!0},a.Game=O,f=t=t||{},ut=f.Object2D,e(Ae,ut),Ae.deserialize=function(t,e){t.param.game=e,e=new Ae(t.param);return e.id=t.id,e},Ae.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},Ae.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},Ae.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},Ae.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},f.Camera2D=Ae,_=t=t||{},xe.prototype.draw=function(t,e){t=t.scene();if(t){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var i=t.children,r=0;r<i.length;++r)i[r].render(this,e);e&&this.restore(),this.restore(),this.end()}},xe.prototype.begin=function(){},xe.prototype.end=function(){},_.Renderer=xe,lt=t=t||{},we.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},we.prototype.destroyed=function(){return!!this._destroyed},lt.Surface=we,c=t=t||{},dt=c.CacheableE,e(C,dt),C.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},C.prototype.invalidate=function(){this._invalidateSelf(),dt.prototype.invalidate.call(this)},C.prototype.renderSelfFromCache=function(t){var e;switch(this.textAlign){case c.TextAlign.Center:e=this.widthAutoAdjust?this._overhangLeft:0;break;case c.TextAlign.Right:e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width+c.CacheableE.PADDING,this._cacheSize.height+c.CacheableE.PADDING,e,0)},C.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=0<this.maxWidth&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,i=0;switch(this.textAlign){case c.TextAlign.Center:i=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case c.TextAlign.Right:i=this.width-(this._textWidth+this._overhangLeft)*e;break;default:i-=this._overhangLeft*e}t.translate(i,0),1!=e&&t.transform([e,0,0,1,0,0]),t.save();for(var r=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var n=this.glyphs[o],s=n.advanceWidth*r,a=n.code;n.isSurfaceValid||(n=this.font.glyphForCharacter(a))?(n.surface&&(t.save(),t.transform([r,0,0,r,0,0]),t.drawImage(n.surface,n.x,n.y,n.width,n.height,n.offsetX,n.offsetY),t.restore()),t.translate(s,0)):this._outputOfWarnLogWithNoGlyph(a,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation(c.CompositeOperation.SourceAtop),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},C.prototype.destroy=function(){dt.prototype.destroy.call(this)},C.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,this.fontSize){for(var t=this.text.length-1,e=this.text.length-1;0<=e;--e){var i=c.Util.charCodeAt(this.text,e);if(i)if((n=this.font.glyphForCharacter(i))&&0!==n.width&&0!==n.advanceWidth){t=e;break}}for(var r=0,o=0<this.font.size?this.fontSize/this.font.size:0,e=0;e<=t;++e){var n,s,a=c.Util.charCodeAt(this.text,e);a&&((n=this.font.glyphForCharacter(a))?n.width<0||n.height<0||n.x<0||n.y<0||(this.glyphs.push(n),(s=0)===e&&(this._overhangLeft=Math.min(n.offsetX,0),s=-this._overhangLeft),e===t&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),s+=this._overhangRight),this._textWidth+=(n.advanceWidth+s)*o,r<(s=n.offsetY+n.height)&&(r=s)):this._outputOfWarnLogWithNoGlyph(a,"_invalidateSelf()"))}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=r*o}else this.height=0},C.prototype._outputOfWarnLogWithNoGlyph=function(t,e){t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn("Label#"+e+": failed to get a glyph for '"+t+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},c.Label=C,f=t=t||{},Se.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},f.Glyph=Se,pt=t=t||{},ft=pt.E,e(Ee,ft),Ee.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},pt.FilledRect=Ee,_t=t=t||{},gt=_t.CacheableE,e(F,gt),Object.defineProperty(F.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),F.prototype.modified=function(t){t&&(this.state&=-3),gt.prototype.modified.call(this)},F.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},F.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},F.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,gt.prototype.destroy.call(this)},F.prototype._renderBackground=function(){var t;this.backgroundImage&&this.backgroundEffector?(t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height),this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)):this._bgSurface=void 0},F.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},F.prototype._initialize=function(){var t=void 0===this._padding?0:this._padding,t="number"==typeof t?{top:t,bottom:t,left:t,right:t}:this._padding,e=(this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom},this.scene.game.resourceFactory);this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=e.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},F.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var t={left:0,right:this.width,top:0,bottom:this.height},r=[{x:t.left,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.top},{x:t.right,y:t.bottom}],o=i.multiplyPoint(r[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},s=1;s<r.length;++s)o=i.multiplyPoint(r[s]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);return n}},_t.Pane=F,yt=t=t||{},be.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t)._code=this._code,this._handler.call(this._handlerOwner,e)},mt=be,Pe.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},Pe.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},Pe.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},Pe.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},Pe.prototype._loadOperationPlugins=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];if(e.script){var i=yt._require(this._game,e.script);if(i.isSupported()){var i=new i(this._game,this._viewInfo,e.option),r=e.code;if(this.plugins[r])throw new Error("Plugin#code conflicted for code: "+r);this.plugins[r]=i,e._plugin=i;e=new mt(r,this.operated,this.operated.fire);i.operationTrigger.handle(e,e.onOperation)}}}},yt.OperationPluginManager=Pe,vt=t=(t=t||{})||{},ke.prototype.measureText=function(t){for(var e,i=0,r=0,o=0,n=0;n<t.length;n++){var s=vt.Util.charCodeAt(t,n);s&&(!(s=this.glyphForCharacter(s))||s.x<0||s.y<0||s.width<0||s.height<0||(0===n&&(r=-s.offsetX),i+=(e=s).advanceWidth))}return{width:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o=e?i+e.offsetX+e.width-e.advanceWidth:o}},vt.Font=ke,d=t=t||{},(_=Tt=d.FontWeight||(d.FontWeight={}))[_.Normal=0]="Normal",_[_.Bold=1]="Bold",At=d.Font,e(Re,At),Re.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface&&!this._atlasSet.addGlyph(e))return null;this._glyphs[t]=e}return this._atlasSet.touchGlyph(e),e},Re.prototype.asBitmapFont=function(t){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;t&&(e=d.Util.charCodeAt(t,0),this.glyphForCharacter(e));var r={},t=(Object.keys(this._glyphs).forEach(function(t){var t=Number(t),e=i._glyphs[t],e={x:e.x,y:e.y,width:e.width,height:e.height,offsetX:e.offsetX,offsetY:e.offsetY,advanceWidth:e.advanceWidth};r[t]=e}),r[e]),e=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new d.BitmapFont({src:e,map:r,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:t})},Re.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},Re.prototype.destroyed=function(){return this._destroyed},_=Re,d.DynamicFont=_,xt=t=t||{},wt=xt.Font,e(Le,wt),Le.prototype.glyphForCharacter=function(t){var e,i,r,o,n,s,a=this.map[t]||this.missingGlyph;return a?(e=void 0===a.width?this.defaultGlyphWidth:a.width,i=void 0===a.height?this.defaultGlyphHeight:a.height,r=a.offsetX||0,o=a.offsetY||0,n=void 0===a.advanceWidth?e:a.advanceWidth,s=0===e||0===i?void 0:this.surface,new xt.Glyph(t,a.x,a.y,e,i,r,o,n,s,!0)):null},Le.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},Le.prototype.destroyed=function(){return!this.map},xt.BitmapFont=Le;var f=t=t||{},Me=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null},Oe=(f.SurfaceAtlasSlot=Me,Ce.prototype.reset=function(){var t=this._surface.renderer();t.begin(),t.clear(),t.end(),this._emptySurfaceAtlasSlotHead=new Me(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize.width=0,this._usedRectangleAreaSize.height=0},Ce.prototype._acquireSurfaceAtlasSlot=function(t,e){var i,r,o,n=function(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,t+=1,e+=1);return n?(r=(o=n.width-t)<=(r=n.height-e)?(i=new Me(n.x+t,n.y,o,e),new Me(n.x,n.y+e,n.width,r)):(i=new Me(n.x,n.y+e,t,r),new Me(n.x+t,n.y,o,n.height)),i.prev=n.prev,i.next=r,null===i.prev?this._emptySurfaceAtlasSlotHead=i:i.prev.next=i,r.prev=i,r.next=n.next,r.next&&(r.next.prev=r),o=new Me(n.x,n.y,t,e),this._updateUsedRectangleAreaSize(o),o):null},Ce.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,t=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),t>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=t)},Ce.prototype.addSurface=function(t){var e,i=this._acquireSurfaceAtlasSlot(t.width,t.height);return i?((e=this._surface.renderer()).begin(),e.drawImage(t.surface,t.x,t.y,t.width,t.height,i.x,i.y),e.end(),i):null},Ce.prototype.destroy=function(){this._surface.destroy()},Ce.prototype.destroyed=function(){return this._surface.destroyed()},Ce.prototype.duplicateSurface=function(t){var e=this._surface,t=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),i=t.renderer();return i.begin(),i.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),i.end(),t},Ce);function Ce(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new Me(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}function I(t){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=t.game.resourceFactory,this._currentAtlasIndex=0;var t=t.hint||{};this._maxAtlasNum=t.maxAtlasNum||I.INITIAL_MAX_SURFACEATLAS_NUM,t.initialAtlasWidth=t.initialAtlasWidth||512,t.initialAtlasHeight=t.initialAtlasHeight||512,t.maxAtlasWidth=t.maxAtlasWidth||512,t.maxAtlasHeight=t.maxAtlasHeight||512,this._atlasSize=(t=t,{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))})}function Fe(t){this._game=t,this._muted=!1,this._playbackRate=1}function Ie(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}function De(t){var e=kt.call(this,t)||this;return e.text=t.text,e.fontSize=t.fontSize,e.textAlign="textAlign"in t?t.textAlign:p.TextAlign.Left,e.textBaseline="textBaseline"in t?t.textBaseline:Pt.Alphabetic,e.maxWidth=t.maxWidth,e.textColor="textColor"in t?t.textColor:"black",e.fontFamily="fontFamily"in t?t.fontFamily:p.FontFamily.SansSerif,e.strokeWidth="strokeWidth"in t?t.strokeWidth:0,e.strokeColor="strokeColor"in t?t.strokeColor:"black",e.strokeOnly="strokeOnly"in t&&t.strokeOnly,e}function Ge(t){this.initState(t)}function He(t,e){var i=this;if(void 0===t)throw Rt.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(i=Lt.call(this,t)||this)._xorshift=e?Rt.Xorshift.deserialize(e):new Rt.Xorshift(t),i}f.SurfaceAtlas=Oe,I.prototype._deleteAtlas=function(t){for(var e=0;e<t;++e){var i=this._spliceLeastFrequentlyUsedAtlas();if(!i)return;i.destroy()}},I.prototype._findLeastFrequentlyUsedAtlasIndex=function(){for(var t=Number.MAX_VALUE,e=-1,i=0;i<this._surfaceAtlases.length;++i)this._surfaceAtlases[i]._accessScore<=t&&(t=this._surfaceAtlases[i]._accessScore,e=i);return e},I.prototype._spliceLeastFrequentlyUsedAtlas=function(){var t=this._findLeastFrequentlyUsedAtlasIndex();if(-1===t)return null;this._currentAtlasIndex>=t&&--this._currentAtlasIndex;for(var e=this._surfaceAtlases.splice(t,1)[0],i=this._atlasGlyphsTable.splice(t,1)[0],r=0;r<i.length;r++){var o=i[r];o.surface=void 0,o.isSurfaceValid=!1,o._atlas=null}return e},I.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],o=r.addSurface(t);if(o)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=o.x,t.y=o.y,t._atlas=r,this._atlasGlyphsTable[i].push(t),!0}return!1},I.prototype._reallocateAtlas=function(){var t=null;this._surfaceAtlases.length>=this._maxAtlasNum?(t=this._spliceLeastFrequentlyUsedAtlas()).reset():t=new Oe(this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height)),this._surfaceAtlases.push(t),this._atlasGlyphsTable.push([]),this._currentAtlasIndex=this._surfaceAtlases.length-1},I.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},I.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},I.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},I.prototype.changeMaxAtlasNum=function(t){this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum&&(t=this._surfaceAtlases.length-this._maxAtlasNum,this._deleteAtlas(t))},I.prototype.getAtlasSize=function(){return this._atlasSize},I.prototype.addGlyph=function(t){return!(t.width>this._atlasSize.width||t.height>this._atlasSize.height)&&(!!this._moveGlyphSurface(t)||(this._reallocateAtlas(),this._moveGlyphSurface(t)))},I.prototype.touchGlyph=function(t){t._atlas&&(t._atlas._accessScore+=1);for(var e=0;e<this._surfaceAtlases.length;e++)this._surfaceAtlases[e]._accessScore/=2},I.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},I.prototype.destroyed=function(){return void 0===this._surfaceAtlases},I.INITIAL_MAX_SURFACEATLAS_NUM=10,f.SurfaceAtlasSet=I,_=t=t||{},Fe.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t,e=this._game.audio;for(t in e)e.hasOwnProperty(t)&&e[t]._reset()},Fe.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e,i=this._game.audio;for(e in i)i.hasOwnProperty(e)&&i[e]._setMuted(t)}},Fe.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e,i=this._game.audio;for(e in i)i.hasOwnProperty(e)&&i[e]._setPlaybackRate(t)}},_.AudioSystemManager=Fe,(f=(f=t=t||{}).CompositeOperation||(f.CompositeOperation={}))[f.SourceOver=0]="SourceOver",f[f.SourceAtop=1]="SourceAtop",f[f.Lighter=2]="Lighter",f[f.Copy=3]="Copy",f[f.ExperimentalSourceIn=4]="ExperimentalSourceIn",f[f.ExperimentalSourceOut=5]="ExperimentalSourceOut",f[f.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",f[f.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",f[f.DestinationOut=8]="DestinationOut",f[f.DestinationOver=9]="DestinationOver",f[f.Xor=10]="Xor",(St=t=t||{}).GlyphFactory=function(t,e,i,r,o,n,s,a){void 0===i&&(i=e),void 0===r&&(r="black"),void 0===o&&(o=0),void 0===n&&(n="black"),void 0===s&&(s=!1),void 0===a&&(a=St.FontWeight.Normal),this.fontFamily=t,this.fontSize=e,this.fontWeight=a,this.baselineHeight=i,this.fontColor=r,this.strokeWidth=o,this.strokeColor=n,this.strokeOnly=s},(_=(_=t=t||{}).LocalTickMode||(_.LocalTickMode={}))[_.NonLocal=0]="NonLocal",_[_.FullLocal=1]="FullLocal",_[_.InterpolateLocal=2]="InterpolateLocal",f=t=t||{},Ie.prototype.render=function(t,e,i){for(var r=!0,o=(this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t),this._surface.renderer()),r=(o.begin(),r||o.clear(),this.borderWidth.left),n=t.width-this.borderWidth.right,s=this.borderWidth.top,a=t.height-this.borderWidth.bottom,h=this.borderWidth.left,e=e-this.borderWidth.right,c=this.borderWidth.top,i=i-this.borderWidth.bottom,u=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:n,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:n,y:a,width:this.borderWidth.right,height:this.borderWidth.bottom}],l=[{x:0,y:0},{x:e,y:0},{x:0,y:i},{x:e,y:i}],d=0,d=0;d<u.length;++d){var p=u[d];o.save(),o.translate(l[d].x,l[d].y),o.drawImage(t,p.x,p.y,p.width,p.height,0,0),o.restore()}var f=[{x:r,y:0,width:n-r,height:this.borderWidth.top},{x:0,y:s,width:this.borderWidth.left,height:a-s},{x:n,y:s,width:this.borderWidth.right,height:a-s},{x:r,y:a,width:n-r,height:this.borderWidth.bottom}],_=[{x:h,y:0,width:e-h,height:this.borderWidth.top},{x:0,y:c,width:this.borderWidth.left,height:i-c},{x:e,y:c,width:this.borderWidth.right,height:i-c},{x:h,y:i,width:e-h,height:this.borderWidth.bottom}];for(d=0;d<f.length;++d){var g=f[d],y=_[d];o.save(),o.translate(y.x,y.y),o.transform([y.width/g.width,0,0,y.height/g.height,0,0]),o.drawImage(t,g.x,g.y,g.width,g.height,0,0),o.restore()}n-=r,a-=s,e-=h,i-=c;return o.save(),o.translate(h,c),o.transform([e/n,0,0,i/a,0,0]),o.drawImage(t,r,s,n,a,0,0),o.restore(),o.end(),this._surface},f.NinePatchSurfaceEffector=Ie,Et=t=t||{},(bt=Et.PathUtil||(Et.PathUtil={})).resolvePath=function(t,e){function i(t){t=t.split("/");return""===t[t.length-1]&&t.pop(),t}if(""===e)return t;for(var r=i((t=bt.splitPath(t)).path).concat(i(e)),o=[],n=0;n<r.length;++n){var s=r[n];switch(s){case"..":var a=o.pop();if(void 0===a||""===a||"."===a)throw Et.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===o.length&&o.push(".");break;case"":o=[""];break;default:o.push(s)}}return t.host+o.join("/")},bt.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},bt.resolveExtname=function(t){for(var e=t.length-1;0<=e;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""},bt.makeNodeModulePaths=function(t){for(var e,i=bt.splitPath(t),r=i.host,o=(t="/"===(t=i.path)[t.length-1]?t.slice(0,t.length-1):t).split("/"),n=0<(i=o.indexOf("node_modules"))?i-1:0,s=[],a=o.length-1;n<=a;--a)"node_modules"!==o[a]&&((e=o.slice(0,a+1)).push("node_modules"),e=e.join("/"),s.push(r+e));return s},bt.addExtname=function(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)},bt.splitPath=function(t){var e="",i=t.indexOf("//");return 0<=i?t=0<=(i=t.indexOf("/",i+2))?(e=t.slice(0,i),t.slice(i)):(e=t,"/"):e="",{host:e,path:t}},(_=(_=t=t||{}).FontFamily||(_.FontFamily={}))[_.SansSerif=0]="SansSerif",_[_.Serif=1]="Serif",_[_.Monospace=2]="Monospace",p=t=t||{},(f=Pt=p.TextBaseline||(p.TextBaseline={}))[f.Top=0]="Top",f[f.Middle=1]="Middle",f[f.Alphabetic=2]="Alphabetic",f[f.Bottom=3]="Bottom",kt=p.E,e(De,kt),De.prototype.renderSelf=function(t,e){if(this.text){var i;switch(this.textAlign){case p.TextAlign.Right:i=this.width;break;case p.TextAlign.Center:i=this.width/2;break;default:i=0}t.drawSystemText(this.text,i,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},f=De,p.SystemLabel=f,(_=(_=t=t||{}).TextAlign||(_.TextAlign={}))[_.Left=0]="Left",_[_.Center=1]="Center",_[_.Right=2]="Right",(f=(f=t=t||{}).TickGenerationMode||(f.TickGenerationMode={}))[f.ByClock=0]="ByClock",f[f.Manual=1]="Manual",_=t=t||{},Ge.deserialize=function(t){var e=new Ge(0);return e._state0U=t._state0U,e._state0L=t._state0L,e._state1U=t._state1U,e._state1L=t._state1L,e},Ge.prototype.initState=function(t){var e=1812433253;this._state0U=t=e*(t^t>>30)+1,this._state0L=t=e*(t^t>>30)+2,this._state1U=t=e*(t^t>>30)+3,this._state1L=t=e*(t^t>>30)+4},Ge.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L,o=0,n=0,e=(o=(t^=o=t<<23|(-512&e)>>>9)^(this._state0U=i),o^=t>>>17,n=(n=(e^=n=e<<23)^(this._state0L=r))^(e>>>17|(131071&t)<<15)^(r>>>26|(67108863&i)<<6),this._state1U=o^=i>>>26,((this._state1L=n)>>>0)+(r>>>0));return[o+i+(e/2>>>31)>>>0,e>>>0]},Ge.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},Ge.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},Ge.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},_.Xorshift=Ge,Rt=t=t||{},Lt=Rt.RandomGenerator,e(He,Lt),He.deserialize=function(t){return new He(t._seed,t._xorshift)},He.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},He.prototype.generate=function(){return this._xorshift.random()},He.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},Rt.XorshiftRandomGenerator=He,(t||(t={})).ShaderProgram=function(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms},Ue.exports=t}.call(this)},{}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],5:[function(t,e,i){e.exports=t("./lib/index")},{"./lib/index":28}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Clock=void 0;var r=t("@akashic/akashic-engine");i.Clock=(o.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},o.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},o.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},o.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if(!((i+=t)<=this._skipFrameWaitTime)){for(var t,r=t=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,o={deltaTime:e,interrupt:!1};0<r&&this.running&&!o.interrupt;)--r,this.frameTrigger.fire(o),o.deltaTime=0;i-=(t-r)*this._waitTime,this.rawFrameTrigger.fire()}return this._totalDeltaTime=i,this._waitTime-i},o.prototype._updateWaitTimes=function(t,e){t*=e;this._waitTime=1e3/t,this._waitTimeDoubled=Math.max(2e3/t|0,1),this._waitTimeMax=Math.max(e*(1e3*this._maxFramePerOnce/t)|0,1),this._skipFrameWaitTime=this._waitTime*o.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*e},o.ANTICIPATE_RATE=.8,o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,o);function o(t){this.fps=t.fps,this.scaleFactor=t.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=t.platform,this._maxFramePerOnce=t.maxFramePerOnce,this._deltaTimeBrokenThreshold=t.deltaTimeBrokenThreshold||o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,t.frameHandler&&this.frameTrigger.add(t.frameHandler,t.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}},{"@akashic/akashic-engine":2}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventBuffer=void 0;t("@akashic/akashic-pdi");var r=t("@akashic/akashic-engine"),o=t("./PointEventResolver");function a(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new o.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}a.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError("EventBuffer.isEventLocal")}},a.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=3&t.defaultEventPriority)},a.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},a.prototype.onEvent=function(t){a.isEventLocal(t)?this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(t):(this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(t),this._isSender&&(null==t[1]&&(t[1]=this._defaultEventPriority),this._amflow.sendEvent(t)))},a.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},a.prototype.addEventDirect=function(t){if(a.isEventLocal(t))return!this._isLocalReceiver||this._isDiscarder?void 0:void this._localBuffer.push(t);this._isReceiver&&!this._isDiscarder&&(0===t[0]||1===t[0]?this._joinLeaveBuffer:this._buffer).push(t),this._isSender&&(null==t[1]&&(t[1]=this._defaultEventPriority),this._amflow.sendEvent(t))},a.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},a.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},a.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},a.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},a.prototype.removeFilter=function(t){if(this._filters)if(t)for(var e=this._filters.length-1;0<=e;--e)this._filters[e].func===t&&this._filters.splice(e,1);else this._filters=null},a.prototype.processEvents=function(t){var e=this._unfilteredLocalEvents,i=this._unfilteredEvents,r=(this._unfilteredLocalEvents=[],e);if(!t&&0<i.length&&(r=0<r.length?r.concat(i):i,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var n=this._filters[o];(0<r.length||n.handleEmpty)&&(r=this._filters[o].func(r)||[])}for(o=0;o<r.length;++o){var s=r[o];(a.isEventLocal(s)?this._localBuffer:0===s[0]||1===s[0]?this._joinLeaveBuffer:this._buffer).push(s)}},i.EventBuffer=a},{"./PointEventResolver":18,"@akashic/akashic-engine":2,"@akashic/akashic-pdi":4}],8:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventConverter=void 0;var _=t("@akashic/akashic-engine");function r(t){this._game=t.game,this._playerTable={}}r.prototype.toGameEvent=function(t){var e,i,r,o,n=t[0],s=t[1],a=t[2],h=this._playerTable[a]||{id:a};switch(n){case 0:h={id:a,name:t[3]},this._playerTable[a]=h;var c,u,l=void 0;return t[4]&&(c=[],u=[],t[4].map(function(t){c.push(t.readKey),u.push(t.values)}),l=new _.StorageValueStore(c,u)),new _.JoinEvent(h,l,s);case 1:return delete this._playerTable[h.id],new _.LeaveEvent(h,s);case 2:return l=t[3],new _.TimestampEvent(l,h,s);case 32:return d=t[4],new _.MessageEvent(t[3],h,d,s);case 33:return d=t[7],f=t[3],e=null==(p=t[6])?void 0:(0<=p?this._game.db:this._game._localDb)[p],i={x:t[4],y:t[5]},new _.PointDownEvent(f,e,i,h,d,s);case 34:return d=t[11],f=t[3],e=null==(p=t[10])?void 0:(0<=p?this._game.db:this._game._localDb)[p],i={x:t[4],y:t[5]},r={x:t[6],y:t[7]},o={x:t[8],y:t[9]},new _.PointMoveEvent(f,e,i,o,r,h,d,s);case 35:return d=t[11],f=t[3],e=null==(p=t[10])?void 0:(0<=p?this._game.db:this._game._localDb)[p],i={x:t[4],y:t[5]},r={x:t[6],y:t[7]},o={x:t[8],y:t[9]},new _.PointUpEvent(f,e,i,o,r,h,d,s);case 64:var d=t[5],l=t[3],p=t[4],f=this._game._decodeOperationPluginOperation(l,p);return new _.OperationEvent(l,f,h,d,s);default:throw _.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},r.prototype.toPlaylogEvent=function(t,e){var i=t.priority;switch(t.type){case _.EventType.Join:case _.EventType.Leave:throw _.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+_.EventType[t.type]);case _.EventType.Timestamp:return[2,i,(e?t:this._game).player.id,t.timestamp];case _.EventType.PointDown:var r=t.target?t.target.id:null;return[33,i,(e?t:this._game).player.id,t.pointerId,t.point.x,t.point.y,r,!!t.local];case _.EventType.PointMove:return r=t.target?t.target.id:null,[34,i,(e?t:this._game).player.id,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,r,!!t.local];case _.EventType.PointUp:return r=t.target?t.target.id:null,[35,i,(e?t:this._game).player.id,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,r,!!t.local];case _.EventType.Message:return[32,i,(e?t:this._game).player.id,t.data,!!t.local];case _.EventType.Operation:return[64,i,(e?t:this._game).player.id,t.code,t.data,!!t.local];default:throw _.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},r.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?3&t.priority:0,e,t._code,t.data,!!t.local]},i.EventConverter=r},{"@akashic/akashic-engine":2}],9:[function(t,e,i){arguments[4][4][0].apply(i,arguments)},{dup:4}],10:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.Active=0]="Active",o[o.Passive=1]="Passive",i.default=r},{}],11:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.Game=void 0,t("@akashic/akashic-engine")),t=(o=s.Game,n(a,o),a.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},a.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},a.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},a.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},a.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},a.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},a.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},a.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},a.prototype.getIsSkipAware=function(){return this._isSkipAware},a.prototype.setIsSkipAware=function(t){this._isSkipAware=t},a.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},a.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},a.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==s.TickGenerationMode.Manual)throw s.ExceptionFactory.createAssertionError("Game#raiseTick(): tickGenerationMode for the current scene is not Manual.");this.raiseTickTrigger.fire(t)},a.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},a.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},a.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},a.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},a.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},a.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,o.prototype._destroy.call(this)},a.prototype._restartWithSnapshot=function(t){var e,i=t.data;this._eventFilterFuncs.removeFilter(),null!=i.seed?(e=new s.XorshiftRandomGenerator(i.seed),this._reset({age:t.frame,randGen:e}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})):(e=new s.XorshiftRandomGenerator(0,i.randGenSer),this._reset({age:t.frame,randGen:e}),this._loadAndStart({snapshot:i.gameSnapshot}))},a.prototype._leaveGame=function(){},a.prototype._abortGame=function(){this.abortTrigger.fire()},a.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},a.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},a);function a(t){var e=o.call(this,t.configuration,t.resourceFactory,t.assetBase,t.player.id,t.operationPluginViewInfo)||this;return e.agePassedTrigger=new s.Trigger,e.targetTimeReachedTrigger=new s.Trigger,e.skippingChangedTrigger=new s.Trigger,e.abortTrigger=new s.Trigger,e.player=t.player,e.raiseEventTrigger=new s.Trigger,e.raiseTickTrigger=new s.Trigger,e.snapshotTrigger=new s.Trigger,e.isSnapshotSaver=!!t.isSnapshotSaver,e._getCurrentTimeFunc=null,e._eventFilterFuncs=null,e._notifyPassedAgeTable={},e._notifiesTargetTimeReached=!1,e._isSkipAware=!1,e._gameArgs=t.gameArgs,e._globalGameArgs=t.globalGameArgs,e.skippingChangedTrigger.add(e._onSkippingChanged,e),e}i.Game=t},{"@akashic/akashic-engine":2}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameDriver=void 0;var s=t("es6-promise"),l=t("@akashic/akashic-engine"),d=t("./ExecutionMode"),p=t("./Game"),f=t("./EventBuffer"),_=t("./GameLoop"),r=t("./PdiUtil"),o="GAME_DESTROYED";function n(t){this.errorTrigger=new l.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new l.Trigger,this.gameCreatedTrigger=new l.Trigger,this._platform=t.platform,this._loadConfigurationFunc=r.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}n.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},n.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){t?e(t):(r&&i._gameLoop.start(),e())})},n.prototype.startGame=function(){this._gameLoop?this._gameLoop.start():this.errorTrigger.fire(new Error("Not initialized"))},n.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},n.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},n.prototype.getPermission=function(){return this._permission},n.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},n.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},n.prototype.getHidden=function(){return this._hidden},n.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,o=this._platform,n=o.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==n.renderer()}),o.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(o.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},n.prototype.doInitialize=function(i){var r=this,t=new s.Promise(function(t,e){if(r._gameLoop&&r._gameLoop.running)return e(new Error("Game is running. Must be stopped."));r._gameLoop&&i.loopConfiguration&&r._gameLoop.setLoopConfiguration(i.loopConfiguration),null!=i.hidden&&(r._hidden=i.hidden,r._game&&r._game._setMuted(i.hidden)),t()}).then(function(){return r._assertLive(),r._doSetDriverConfiguration(i.driverConfiguration)});return i.configurationUrl?t.then(function(){return r._assertLive(),r._loadConfiguration(i.configurationUrl,i.assetBase,i.configurationBase)}).then(function(t){return r._assertLive(),r._createGame(t,r._player,i)}):t},n.prototype.destroy=function(){var i=this;return new s.Promise(function(t,e){i.stopGame(),i._game&&(i._game._destroy(),i._game=null),i.errorTrigger.destroy(),i.errorTrigger=null,i.configurationLoadedTrigger.destroy(),i.configurationLoadedTrigger=null,i.gameCreatedTrigger.destroy(),i.gameCreatedTrigger=null,i._platform.destroy?i._platform.destroy():i._platform.setRendererRequirement(void 0),i._platform=null,i._loadConfigurationFunc=null,i._player=null,i._rendererRequirement=null,i._playId=null,i._gameLoop=null,i._eventBuffer=null,i._openedAmflow=!1,i._playToken=null,i._permission=null,i._hidden=!1,i._destroyed=!0,t()})},n.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return s.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===d.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===d.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=s.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),(i=this._playToken!==t.playToken?i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)}):i).then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=3&e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},n.prototype._doCloseAmflow=function(){var r=this;return new s.Promise(function(e,i){if(!r._openedAmflow)return e();r._platform.amflow.close(function(t){r._openedAmflow=!1;t=r._getCallbackError(t);if(t)return i(t);e()})})},n.prototype._doOpenAmflow=function(r){var o=this;return void 0===r?s.Promise.resolve():this._doCloseAmflow().then(function(){return o._assertLive(),new s.Promise(function(e,i){if(null===r)return e();o._platform.amflow.open(r,function(t){t=o._getCallbackError(t);if(t)return i(t);o._openedAmflow=!0,o._playId=r,o._game&&o._updateGamePlayId(o._game),e()})})})},n.prototype._doAuthenticate=function(o){var n=this;return null==o?s.Promise.resolve():new s.Promise(function(i,r){n._platform.amflow.authenticate(o,function(t,e){t=n._getCallbackError(t);if(t)return r(t);n._playToken=o,n._permission=e,n._game&&(n._game.isSnapshotSaver=n._permission.writeTick),i()})})},n.prototype._loadConfiguration=function(t,e,o){var n=this;return new s.Promise(function(i,r){n._loadConfigurationFunc(t,e,o,function(t,e){t=n._getCallbackError(t);if(t)return r(t);n.configurationLoadedTrigger.fire(e),i(e)})})},n.prototype._putZerothStartPoint=function(r){var o=this;return new s.Promise(function(e,i){var t={frame:0,timestamp:r.startedAt,data:r};o._platform.amflow.putStartPoint(t,function(t){t=o._getCallbackError(t);if(t)return i(t);e()})})},n.prototype._getZerothStartPointData=function(){var o=this;return new s.Promise(function(i,r){o._platform.amflow.getStartPoint({frame:0},function(t,e){var t=o._getCallbackError(t);return t?r(t):"number"!=typeof(t=e.data).seed?r(new Error("GameDriver#_getRandomSeed: No seed found.")):void i(t)})})},n.prototype._createGame=function(a,h,c){var u=this,t=c.driverConfiguration.executionMode===d.default.Active&&this._permission.writeTick?this._putZerothStartPoint({seed:Date.now(),globalArgs:c.globalGameArgs,fps:a.fps,startedAt:Date.now()}):s.Promise.resolve();return(t=t.then(function(){return u._assertLive(),u._getZerothStartPointData()})).then(function(t){u._assertLive();var e=u._platform,i=c.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:d.default.Active},r=t.seed,o=c.gameArgs,n=t.globalArgs,t=t.startedAt,s={primarySurfaceWidth:a.width,primarySurfaceHeight:a.height,rendererCandidates:a.renderers},o=(e.setRendererRequirement(s),new p.Game({configuration:a,player:h,resourceFactory:e.getResourceFactory(),assetBase:c.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:e.getOperationPluginViewInfo?e.getOperationPluginViewInfo():null,gameArgs:o,globalGameArgs:n})),n=new f.EventBuffer({game:o,amflow:e.amflow}),e=(n.setMode(i.eventBufferMode),e.setPlatformEventHandler(n),o.setEventFilterFuncs({addFilter:n.addFilter.bind(n),removeFilter:n.removeFilter.bind(n)}),o.renderers.push(e.getPrimarySurface().renderer()),new _.GameLoop({game:o,amflow:e.amflow,platform:e,executionMode:i.executionMode,eventBuffer:n,configuration:c.loopConfiguration,startedAt:t,profiler:c.profiler}));e.rawTargetTimeReachedTrigger.add(o._onRawTargetTimeReached,o),o.setCurrentTimeFunc(e.getCurrentTime.bind(e)),o._reset({age:0,randGen:new l.XorshiftRandomGenerator(r)}),u._updateGamePlayId(o),u._hidden&&o._setMuted(!0),o.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){t=u._getCallbackError(t);t&&u.errorTrigger.fire(t)})}),u._game=o,u._eventBuffer=n,u._gameLoop=e,u._rendererRequirement=s,u.gameCreatedTrigger.fire(o),u._game._loadAndStart({args:c.gameArgs||void 0})})},n.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},n.prototype._assertLive=function(){if(this._destroyed)throw new Error(o)},n.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(o):null)},i.GameDriver=n},{"./EventBuffer":7,"./ExecutionMode":10,"./Game":11,"./GameLoop":13,"./PdiUtil":17,"@akashic/akashic-engine":2,"es6-promise":84}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameLoop=void 0;var _=t("@akashic/akashic-engine"),r=t("./constants"),g=t("./LoopMode"),o=t("./LoopRenderMode"),n=t("./ExecutionMode"),s=t("./Clock"),a=t("./ProfilerClock"),h=t("./EventConverter"),c=t("./TickController");function u(t){this.errorTrigger=new _.Trigger,this.rawTargetTimeReachedTrigger=new _.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration,i=(this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||r.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||r.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||r.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||r.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||r.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||r.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1,null!=e.loopRenderMode?e.loopRenderMode:o.default.AfterRawFrame);this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new a.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new s.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new c.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new h.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}u.prototype.start=function(){this.running=!0,this._clock.start()},u.prototype.stop=function(){this._clock.stop(),this.running=!1},u.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},u.prototype.getExecutionMode=function(){return this._executionMode},u.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},u.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},u.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},u.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},u.prototype.getCurrentTime=function(){return this._currentTime},u.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},u.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},u.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},u.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:_.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:_.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case _.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case _.LocalTickMode.NonLocal:case _.LocalTickMode.InterpolateLocal:i===_.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+e))}},u.prototype._onLocalFrame=function(){this._doLocalTick()},u.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var o=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,o&&this._handleSceneChange()},u.prototype._onFrame=function(t){var e,i,r;this._loopMode===g.default.Replay&&this._targetTimeFunc?(i=(e=this._targetTimeFunc())+this._realTargetTimeOffset,r=this._currentTime,this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)):this._onFrameNormal(t)},u.prototype._onFrameForTimedReplay=function(t,e){var i=!1,r=this._game,o=(t-this._currentTime)/this._frameTime;if((o>this._jumpTryThreshold||o<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),o<=0)this._skipping&&this._stopSkipping();else{this._skipping||(o>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var n=0;n<this._skipTicksAtOnce;++n){var s=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),s<t&&this._doLocalTick());break}var a=this._tickBuffer.readNextTickTime();if(null==a&&(a=s),t<s){if(!(a<=t))break;s=t}else if(s<a){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=a){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}s=a,this._omittedTickDuration+=a-this._currentTime}this._currentTime=s;var a=this._tickBuffer.consume(),s=-1,h=this._eventBuffer.readLocalEvents();if(h)for(var c=0,u=h.length;c<u;++c)r.events.push(this._eventConverter.toGameEvent(h[c]));if("number"==typeof a)s=a;else{var s=a[0],l=a[1];if(l)for(c=0,u=l.length;c<u;++c)r.events.push(this._eventConverter.toGameEvent(l[c]))}if(i=r.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime)),this._omittedTickDuration=0,r._notifyPassedAgeTable[s]&&r.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()}},u.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&this._doLocalTick();else{var r,o=this._tickBuffer.currentAge,n=this._loopMode===g.default.Realtime?(r=this._tickBuffer.knownLatestAge+1)-o:null===this._targetAge?(r=null,1):this._targetAge===o?(r=this._targetAge=null,1):(r=this._targetAge)-o;if((n>this._jumpTryThreshold||n<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<o&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=r,this._amflow.getStartPoint({frame:r},this._onGotStartPoint_bound)),n<=0)0===n&&(0===o&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===_.LocalTickMode.InterpolateLocal&&this._doLocalTick(),this._skipping&&this._stopSkipping();else{!this._skipping&&(n>this._skipThreshold||0===o)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var s=!this._skipping&&n<=this._delayIgnoreThreshold?1:Math.min(n,this._skipTicksAtOnce),a=0;a<s;++a){var h=this._currentTime+this._frameTime,c=this._tickBuffer.readNextTickTime();if(null!=c&&h<c){if(!(this._loopMode===g.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode!==_.LocalTickMode.InterpolateLocal)break;this._doLocalTick();continue}h=Math.ceil(c/this._frameTime)*this._frameTime,this._omittedTickDuration+=h-this._currentTime}this._currentTime=h;c=this._tickBuffer.consume(),h=-1;if(null==c){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var u=this._eventBuffer.readLocalEvents();if(u)for(var l=0,d=u.length;l<d;++l)i.events.push(this._eventConverter.toGameEvent(u[l]));if("number"==typeof c)h=c;else{var h=c[0],p=c[1];if(p)for(var f=0,d=p.length;f<d;++f)i.events.push(this._eventConverter.toGameEvent(p[f]))}if(e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime)),this._omittedTickDuration=0,i._notifyPassedAgeTable[h]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&r-this._tickBuffer.currentAge<1&&this._stopSkipping()}}},u.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==g.default.FrameByFrame&&this._stopWaitingNextTick()},u.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},u.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)this.errorTrigger.fire(t);else{if(this._targetTimeFunc&&this._loopMode!==g.default.Realtime){t=this._targetTimeFunc()+this._realTargetTimeOffset;if(t<e.timestamp)return;var i=this._currentTime;if(i<=t&&e.timestamp<i+this._jumpIgnoreThreshold*this._frameTime)return}else{t=this._loopMode===g.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===t||t<e.frame)return;i=this._tickBuffer.currentAge;if(i<=t&&e.frame<i+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()}},u.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},u.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===_.LocalTickMode.FullLocal)},u.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t){case o.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case o.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+t))}},u.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&0<t.scenes.length&&t.render()},u.prototype._onGameRaiseEvent=function(t){t=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(t)},u.prototype._onGameRaiseTick=function(t){if(this._executionMode===n.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},u.prototype._onGameOperationPluginOperated=function(t){t=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(t)},u.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},u.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},u.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},i.GameLoop=u},{"./Clock":6,"./EventConverter":8,"./ExecutionMode":10,"./LoopMode":15,"./LoopRenderMode":16,"./ProfilerClock":19,"./TickController":22,"./constants":27,"@akashic/akashic-engine":2}],14:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.JoinResolver=i.JoinLeaveRequest=void 0;var r=t("@akashic/akashic-engine"),o=(n.prototype._onGotStorageData=function(t,e){this.resolved=!0,t?this.joinResolver.errorTrigger.fire(t):this.pev[4]=e},n);function n(t,e,i,r){this.joinResolver=e,0===(this.pev=t)[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}function s(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}i.JoinLeaveRequest=o,s.prototype.request=function(t){this._requested.push(new o(t,this,this._amflow,this._keysForJoin))},s.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},s.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},i.JoinResolver=s},{"@akashic/akashic-engine":2}],15:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.Realtime=0]="Realtime",o[o.Replay=1]="Replay",o[o.FrameByFrame=2]="FrameByFrame",i.default=r},{}],16:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.AfterRawFrame=0]="AfterRawFrame",o[o.None=1]="None",i.default=r},{}],17:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PdiUtil=void 0;var a,h=t("es6-promise"),c=t("@akashic/akashic-engine");a=i.PdiUtil={makeLoadConfigurationFunc:function(t){function n(i,r,o,n){t.loadGameConfiguration(i,function(t,e){if(t)n(t,null);else{try{e=a._resolveConfigurationBasePath(e,null!=r?r:c.PathUtil.resolveDirname(i))}catch(t){return void n(t,null)}e.definitions?(t=e.definitions.map(function(t){return"string"==typeof t?s(null!=o?c.PathUtil.resolvePath(o,t):t,void 0,o):s(null!=o?c.PathUtil.resolvePath(o,t.url):t.url,t.basePath,o)}),h.Promise.all(t).then(function(t){return n(null,t.reduce(a._mergeGameConfiguration))}).catch(function(t){return n(t,null)})):n(null,e)}})}function s(t,e,o){return new h.Promise(function(i,r){n(t,e,o,function(t,e){t?r(t):i(e)})})}return n},_resolveConfigurationBasePath:function(t,e){function i(t,e){var i=c.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw c.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: invalid path: "+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&"path"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw c.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: asset ID already exists: "+t);r[t]={type:/\.json$/i.test(t)?"text":"script",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t},_mergeObject:function(t,e){for(var i=Object.keys(e),r=0,o=i.length;r<o;++r){var n=i[r],s=e[n];if(typeof s!=typeof t[n])t[n]=s;else switch(typeof s){case"string":case"number":case"boolean":t[n]=s;break;case"object":null==s?t[n]=s:Array.isArray(s)?t[n]=t[n].concat(s):a._mergeObject(t[n],s);break;default:throw new Error("PdiUtil._mergeObject(): unknown type")}}return t},_mergeGameConfiguration:function(t,e){return a._mergeObject(t,e)}}},{"@akashic/akashic-engine":2,"es6-promise":84}],18:[function(t,e,i){"use strict";function r(t){this._game=t.game,this._pointEventMap={}}Object.defineProperty(i,"__esModule",{value:!0}),i.PointEventResolver=void 0,r.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point||t.offset,o=i.target?i.target.id:null,e=(this._pointEventMap[t.identifier]={targetId:o,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}},[33,2,e.id,t.identifier,r.x,r.y,o]);return i.local&&e.push(i.local),e},r.prototype.pointMove=function(t){var e,i,r=this._game.player,o=this._pointEventMap[t.identifier];return o?(this._pointMoveAndUp(o,t.offset,e={x:0,y:0},i={x:0,y:0}),r=[34,2,r.id,t.identifier,o.point.x,o.point.y,i.x,i.y,e.x,e.y,o.targetId],o.local&&r.push(o.local),r):null},r.prototype.pointUp=function(t){var e,i,r=this._game.player,o=this._pointEventMap[t.identifier];return o?(this._pointMoveAndUp(o,t.offset,e={x:0,y:0},i={x:0,y:0}),delete this._pointEventMap[t.identifier],r=[35,2,r.id,t.identifier,o.point.x,o.point.y,i.x,i.y,e.x,e.y,o.targetId],o.local&&r.push(o.local),r):null},r.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},i.PointEventResolver=r},{}],19:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.ProfilerClock=void 0,t("./Clock")),t=(o=t.Clock,n(s,o),s.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)this._totalDeltaTime=i;else{this._profiler.timeEnd(1),this._profiler.time(1);var t=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,r=t,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,r-1);0<r&&this.running&&!o.interrupt;)--r,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;i-=(t-r)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush()}return this._waitTime-i},s);function s(t){var e=o.call(this,t)||this;return e._profiler=t.profiler,e}i.ProfilerClock=t},{"./Clock":6}],20:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.StorageResolver=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode");function n(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}n.prototype.setExecutionMode=function(t){var e,i;this._executionMode!==t&&(this._executionMode=t,e=this._tickBuffer,i=this._tickGenerator,(t===o.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e)).gotStorageTrigger.add(this._onGotStorageOnTick,this))},n.prototype._onGotStorageOnTick=function(t){var e,i,r=t.age,t=t.storageData,o=this._unresolvedLoaders[r];o?(delete this._unresolvedLoaders[r],e=r,i=t.map(function(t){return t.values}),o._onLoaded(i,e)):this._unresolvedStorages[r]=t},n.prototype._getStorage=function(t,e,i){null!=i?this._tickBuffer.requestTicks(r=i,1):this._executionMode===o.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var r,i=this._unresolvedStorages[r];i?(delete this._unresolvedStorages[r],t=r,i=i.map(function(t){return t.values}),e._onLoaded(i,t)):this._unresolvedLoaders[r]=e},n.prototype._putStorage=function(t,e,i){this._executionMode===o.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},n.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},n.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},i.StorageResolver=n},{"./ExecutionMode":10,"@akashic/akashic-engine":2}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickBuffer=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode");i.TickBuffer=(n.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},n.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},n.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},n.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},n.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},n.prototype.consume=function(){var t,e;return this.currentAge===this._nearestAbsentAge?null:(t=this.currentAge)===(e=this._tickRanges[0]).start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),0<e.ticks.length&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},n.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge!==this._nearestAbsentAge){var t=this.currentAge,e=this._tickRanges[0];if(t!==e.start)return this._dropUntil(this.currentAge),this.readNextTickTime();if(0!==e.ticks.length){e=e.ticks[0];if(e[0]===t){var i=e[1];if(i)for(var r,o=0;o<i.length;++o)if(2===i[o][0])return(r=i[o][3])<this._oldTimestampThreshold&&(r+=this._startedAt),this._nextTickTimeCache=r}}}return null},n.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===o.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},n.prototype.addTick=function(t){for(var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e,r=(this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]}),this._tickRanges.length-1);0<=r&&!(e>=(o=this._tickRanges[r]).start);--r);var o,n=this._tickRanges[r+1];r<0?this._tickRanges.unshift(this._createTickRangeFromTick(t)):e===(o=this._tickRanges[r]).end?(++o.end,t[1]&&o.ticks.push(t)):e>o.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t)),this._nearestAbsentAge===e&&(++this._nearestAbsentAge,n&&this._nearestAbsentAge===n.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},n.prototype.addTickList=function(t){for(var e=t[0],i=t[1]+1,r=t[2],t=e,o=i,n=(this.knownLatestAge<i-1&&(this.knownLatestAge=i-1),0),s=this._tickRanges.length,n=0;n<s;++n){var a=this._tickRanges[n];if(e<a.start)break}var h=n;for(0<n&&(l=this._tickRanges[--n].end,e<l&&(e=l));n<s;++n){a=this._tickRanges[n];if(i<=a.end)break}if(n<s&&((l=this._tickRanges[n].start)<i&&(i=l)),i<=e)return{start:e,end:e,ticks:[]};r=r||[],t===e&&o===i||(r=r.filter(function(t){t=t[0];return e<=t&&t<i}));for(var c=0;c<r.length;++c){var u=r[c];u[2]&&this.gotStorageTrigger.fire({age:u[0],storageData:u[2]})}var l={start:e,end:i,ticks:r},t=Math.max(0,n-h);return this._tickRanges.splice(h,t,l),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),l},n.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===o.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},n.prototype._onTicks=function(t,e){if(t)throw new Error;e&&(t=this.currentAge===this._nearestAbsentAge,e=this.addTickList(e),t&&e.start<=this.currentAge&&this.currentAge<e.end&&this.gotNextTickTrigger.fire(),e.ticks.length)||this.gotNoTickTrigger.fire()},n.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},n.prototype._dropUntil=function(t){for(var e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},n.prototype._createTickRangeFromTick=function(t){var e=t[0],e={start:e,end:e+1,ticks:[]};return t[1]&&e.ticks.push(t),e},n.DEFAULT_PREFETCH_THRESHOLD=1800,n.DEFAULT_SIZE_REQUEST_ONCE=9e3,n);function n(t){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=t.amflow,this._prefetchThreshold=t.prefetchThreshold||n.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=t.sizeRequestOnce||n.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=t.executionMode,this._startedAt=t.startedAt||0,this._oldTimestampThreshold=null!=t.startedAt?t.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}},{"./ExecutionMode":10,"@akashic/akashic-engine":2}],22:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickController=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),n=t("./TickBuffer"),s=t("./TickGenerator"),a=t("./StorageResolver");function h(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new n.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}h.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},h.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},h.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},h.prototype.setNextAge=function(t){this._generator.setNextAge(t)},h.prototype.forceGenerateTick=function(){this._generator.forceNext()},h.prototype.getBuffer=function(){return this._buffer},h.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},h.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},h.prototype._stopTriggerOnTick=function(){this.stopTick()},h.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===o.default.Active;this._generator.startStopGenerate(t)},h.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},i.TickController=h},{"./ExecutionMode":10,"./StorageResolver":20,"./TickBuffer":21,"./TickGenerator":23,"@akashic/akashic-engine":2}],23:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickGenerator=void 0;var r=t("@akashic/akashic-engine"),o=t("./JoinResolver");function n(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._eventBuffer=t.eventBuffer,this._joinResolver=new o.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}n.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved(),r=(r&&(i?i.push.apply(i,r):i=r),this._storageDataForNext);this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,r])}},n.prototype.forceNext=function(){var t;this._waitingStorage?this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage.")):(t=this._generatingTick,this._generatingTick=!0,this.next(),this._generatingTick=t)},n.prototype.startStopGenerate=function(t){this._generatingTick=t},n.prototype.startTick=function(){this._generatingTick=!0},n.prototype.stopTick=function(){this._generatingTick=!1},n.prototype.setNextAge=function(t){this._waitingStorage?this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage.")):this._nextAge=t},n.prototype.requestStorageTick=function(t){var e;return this._waitingStorage?(e=r.ExceptionFactory.createAssertionError("TickGenerator#requestStorageTick(): Unsupported: multiple storage request"),this.errorTrigger.fire(e),-1):(this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge)},n.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},n.prototype._onGotStorageData=function(t,e){this._waitingStorage=!1,t?this.errorTrigger.fire(t):(this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e}))},i.TickGenerator=n},{"./JoinResolver":14,"@akashic/akashic-engine":2}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i._cloneDeep=i.MemoryAmflowClient=void 0;i.MemoryAmflowClient=(r.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},r.prototype.open=function(t,e){var i=this;setTimeout(function(){t!==i._playId?e(new Error("MemoryAmflowClient#open: unknown playId")):e(null)},0)},r.prototype.close=function(t){setTimeout(function(){t(null)},0)},r.prototype.authenticate=function(t,e){setTimeout(function(){switch(t){case r.TOKEN_ACTIVE:e(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case r.TOKEN_PASSIVE:e(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:e(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},r.prototype.sendTick=function(e){if(e=o(e),this._tickList){if(this._tickList[0]<=e[0]&&e[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=e[0]}else this._tickList=[e[0],e[0],[]];(e[1]||e[2])&&(e[1]&&(e[1]=e[1].filter(function(t){return!(8&t[1])})),this._tickList[2].push(e)),this._tickHandlers.forEach(function(t){return t(e)})},r.prototype.onTick=function(t){this._tickHandlers.push(t)},r.prototype.offTick=function(e){this._tickHandlers=this._tickHandlers.filter(function(t){return t!==e})},r.prototype.sendEvent=function(e){e=o(e),0===this._eventHandlers.length?this._events.push(e):this._eventHandlers.forEach(function(t){return t(e)})},r.prototype.onEvent=function(t){var i=this;this._eventHandlers.push(t),0<this._events.length&&(this._events.forEach(function(e){i._eventHandlers.forEach(function(t){return t(e)})}),this._events=[])},r.prototype.offEvent=function(e){this._eventHandlers=this._eventHandlers.filter(function(t){return t!==e})},r.prototype.getTickList=function(t,e,i){if(this._tickList){if("number"!=typeof t||"number"!=typeof e||"function"!=typeof i){if("function"==typeof e)return void e(new Error("not implemented"));throw new Error("not implemented")}var r=Math.max(t,this._tickList[0]),o=Math.min(e,this._tickList[1]),t=this._tickList[2].filter(function(t){t=t[0];return r<=t&&t<=o}),n=[r,o,t];setTimeout(function(){return i(null,n)},0)}else setTimeout(function(){return i(null,null)},0)},r.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},r.prototype.getStartPoint=function(s,a){var h=this;setTimeout(function(){if(h._startPoints&&0!==h._startPoints.length){var t=0;if(null!=s.frame)for(var e=h._startPoints[0].frame,i=1;i<h._startPoints.length;++i){var r=h._startPoints[i].frame;r<=s.frame&&e<r&&(e=r,t=i)}else for(var o=h._startPoints[0].timestamp,i=1;i<h._startPoints.length;++i){var n=h._startPoints[i].timestamp;n<=s.timestamp&&o<n&&(o=n,t=i)}a(null,h._startPoints[t])}else a(new Error("no startpoint"))},0)},r.prototype.putStorageData=function(t,e,i,r){var o=this;setTimeout(function(){try{o._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},r.prototype.getStorageData=function(e,i){var r=this;setTimeout(function(){try{var t=r._getStorageDataSyncFunc(e);i(null,t)}catch(t){i(t)}},0)},r.prototype.dropAfter=function(e){var i,t;this._tickList&&(i=this._tickList[0],t=this._tickList[1],e<=i?(this._tickList=null,this._startPoints=[]):e<=t&&(this._tickList[1]=e-1,this._tickList[2]=this._tickList[2].filter(function(t){t=t[0];return i<=t&&t<=e-1}),this._startPoints=this._startPoints.filter(function(t){return t.frame<e})))},r.TOKEN_ACTIVE="mamfc-token:active",r.TOKEN_PASSIVE="mamfc-token:passive",r);function r(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}function o(i){return i&&"object"==typeof i?Array.isArray(i)?i.map(o):Object.keys(i).reduce(function(t,e){return t[e]=o(i[e]),t},{}):i}i._cloneDeep=o},{}],25:[function(t,e,i){"use strict";function r(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}Object.defineProperty(i,"__esModule",{value:!0}),i.ReplayAmflowProxy=void 0,r.prototype.dropAfter=function(e){var t,i,r;this._tickList&&(t=this._tickList[0],i=this._tickList[1],r=this._tickList[2],e<=t?(this._tickList=null,this._startPoints=[]):e<=i&&(this._tickList[1]=e-1,this._tickList[2]=this._sliceTicks(r,i,e-1),this._startPoints=this._startPoints.filter(function(t){return t.frame<e})))},r.prototype.open=function(t,e){this._amflow.open(t,e)},r.prototype.close=function(t){this._amflow.close(t)},r.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},r.prototype.sendTick=function(t){this._amflow.sendTick(t)},r.prototype.onTick=function(t){this._amflow.onTick(t)},r.prototype.offTick=function(t){this._amflow.offTick(t)},r.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},r.prototype.onEvent=function(t){this._amflow.onEvent(t)},r.prototype.offEvent=function(t){this._amflow.offEvent(t)},r.prototype.getTickList=function(t,e,o){var n=this;if("number"!=typeof t||"number"!=typeof e||"function"!=typeof o){if("function"==typeof e)return void e(new Error("not implemented"));throw new Error("not implemented")}var s,a,h,c,u,l=t,d=e;this._tickList?(s=this._tickList[0],a=this._tickList[1],h=this._tickList[2],u=s<=d&&d<=a,(c=s<=l&&l<=a)&&u?setTimeout(function(){o(null,[l,d,n._sliceTicks(h,l,d)])},0):this._amflow.getTickList(l,d,function(t,e){var i,r;t?o(t):e?c||u?c?(i=n._sliceTicks(h,l,d).concat(e[2]||[]),o(null,[l,e[1],i])):(i=(e[2]||[]).concat(n._sliceTicks(h,l,d)),o(null,[e[0],d,i])):d<s||a<l?o(null,e):(i=(i=e[2])?(t=n._sliceTicks(i,l,s-1),r=n._sliceTicks(i,a+1,d),t.concat(h,r)):h,o(null,[l,d,i])):o(null,c||u?c?[l,a,n._sliceTicks(h,l,d)]:[s,d,n._sliceTicks(h,l,d)]:d<s||a<l?e:[s,a,n._sliceTicks(h,l,d)])})):this._amflow.getTickList(l,d,o)},r.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},r.prototype.getStartPoint=function(t,i){var r=this,o=0;if(0<this._startPoints.length)if(null!=t.frame)for(var e=this._startPoints[0].frame,n=1;n<this._startPoints.length;++n){var s=this._startPoints[n].frame;s<=t.frame&&e<s&&(e=s,o=n)}else for(var a=this._startPoints[0].timestamp,n=1;n<this._startPoints.length;++n){var h=this._startPoints[n].timestamp;h<=t.timestamp&&a<h&&(a=h,o=n)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,e){t?i(t):c<e.frame?i(null,e):i(null,r._startPoints[o])}):setTimeout(function(){i(null,r._startPoints[o])},0)},r.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},r.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},r.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){t=t[0];return e<=t&&t<=i})},i.ReplayAmflowProxy=r},{}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleProfiler=void 0;var r=t("@akashic/akashic-engine");i.SimpleProfiler=(o.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},o.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},o.prototype.flush=function(){var t=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=t),this._beforeFlushTime+this._interval<t&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=t),this._values[1].length>this._limit)for(var e in this._values)this._values.hasOwnProperty(e)&&(this._values[e]=this._values[e].slice(-o.BACKUP_MARGIN))},o.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},o.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},o.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},o.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,o=0,n=0,s=Number.MAX_VALUE,a=this._values[t].length-1;0<=a&&!(0<o&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;n<h&&(n=h),h<s&&(s=h),r+=h,++o}return{ave:r/o,max:n,min:s}},o.prototype._getCurrentTime=function(){return+new Date},o.DEFAULT_INTERVAL=1e3,o.DEFAULT_LIMIT=1e3,o.BACKUP_MARGIN=100,o);function o(t){this._interval=null!=t.interval?t.interval:o.DEFAULT_INTERVAL,null!=t.limit?this._limit=t.limit>=o.DEFAULT_LIMIT?t.limit:o.DEFAULT_LIMIT:this._limit=o.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,t.getValueHandler&&this._calculateProfilerValueTrigger.add(t.getValueHandler,t.getValueHandlerOwner),this._reset()}},{"@akashic/akashic-engine":2}],27:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_POLLING_TICK_THRESHOLD=i.DEFAULT_JUMP_IGNORE_THRESHOLD=i.DEFAULT_JUMP_TRY_THRESHOLD=i.DEFAULT_SKIP_THRESHOLD=i.DEFAULT_SKIP_TICKS_AT_ONCE=i.DEFAULT_DELAY_IGNORE_THRESHOLD=void 0,i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],28:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)},o=(Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleProfiler=i.MemoryAmflowClient=i.ReplayAmflowProxy=i.Game=i.GameDriver=i.ExecutionMode=i.LoopRenderMode=i.LoopMode=i.EventIndex=void 0,o(t("./constants"),i),t("./EventIndex")),o=(i.EventIndex=o,t("./LoopMode")),o=(i.LoopMode=o.default,t("./LoopRenderMode")),o=(i.LoopRenderMode=o.default,t("./ExecutionMode")),n=(i.ExecutionMode=o.default,t("./GameDriver")),s=(Object.defineProperty(i,"GameDriver",{enumerable:!0,get:function(){return n.GameDriver}}),t("./Game")),a=(Object.defineProperty(i,"Game",{enumerable:!0,get:function(){return s.Game}}),t("./auxiliary/ReplayAmflowProxy")),h=(Object.defineProperty(i,"ReplayAmflowProxy",{enumerable:!0,get:function(){return a.ReplayAmflowProxy}}),t("./auxiliary/MemoryAmflowClient")),c=(Object.defineProperty(i,"MemoryAmflowClient",{enumerable:!0,get:function(){return h.MemoryAmflowClient}}),t("./auxiliary/SimpleProfiler"));Object.defineProperty(i,"SimpleProfiler",{enumerable:!0,get:function(){return c.SimpleProfiler}})},{"./EventIndex":9,"./ExecutionMode":10,"./Game":11,"./GameDriver":12,"./LoopMode":15,"./LoopRenderMode":16,"./auxiliary/MemoryAmflowClient":24,"./auxiliary/ReplayAmflowProxy":25,"./auxiliary/SimpleProfiler":26,"./constants":27}],29:[function(t,e,i){e.exports=t("./lib/full/index")},{"./lib/full/index":64}],30:[function(t,e,i){"use strict";function r(){this.audioAssets=[],this._masterVolume=1}Object.defineProperty(i,"__esModule",{value:!0}),i.AudioManager=void 0,r.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},r.prototype.removeAudioAsset=function(t){t=this.audioAssets.indexOf(t);-1===t&&this.audioAssets.splice(t,1)},r.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},r.prototype.getMasterVolume=function(){return this._masterVolume},i.AudioManager=r},{}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ContainerController=void 0;var r=t("@akashic/akashic-engine"),o=t("./InputHandlerLayer");function n(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}n.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},n.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},n.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},n.prototype.getRenderer=function(){if(this.surface)return this.surface.renderer();throw new Error("this container has no surface")},n.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},n.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},n.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,t=t.primarySurfaceHeight,i=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:t}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new o.InputHandlerLayer({width:e,height:t,disablePreventDefault:i}),this.surface=this.resourceFactory.createPrimarySurface(e,t),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},n.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},i.ContainerController=n},{"./InputHandlerLayer":32,"@akashic/akashic-engine":2}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandlerLayer=void 0;var r=t("@akashic/akashic-engine"),o=t("./handler/TouchHandler");function n(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}n.prototype.enablePointerEvent=function(){var e=this;this._inputHandler=new o.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(t){e.pointEventTrigger.fire(t)}),this._inputHandler.start()},n.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},n.prototype.setOffset=function(t){t="position:relative; left:"+t.x+"px; top:"+t.y+"px";this._inputHandler.inputView.setAttribute("style",t)},n.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},n.prototype._createInputView=function(t,e){var i=document.createElement("div");return i.setAttribute("tabindex","1"),i.className="input-handler",i.setAttribute("style","display:inline-block; outline:none;"),i.style.width=t+"px",i.style.height=e+"px",i},i.InputHandlerLayer=n},{"./handler/TouchHandler":63,"@akashic/akashic-engine":2}],33:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Platform=void 0;var r=t("./RafLooper"),o=t("./ResourceFactory"),n=t("./ContainerController"),s=t("./plugin/AudioPluginManager"),a=t("./AudioManager"),h=t("./plugin/AudioPluginRegistry"),c=t("./asset/XHRTextAsset");function u(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new o.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new n.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}u.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},u.prototype.loadGameConfiguration=function(t,i){var e=new c.XHRTextAsset("(game.json)",t);e._load({_onAssetLoad:function(t){i(null,JSON.parse(e.data))},_onAssetError:function(t,e){i(e,null)}})},u.prototype.getResourceFactory=function(){return this._resourceFactory},u.prototype.setRendererRequirement=function(t){t?(this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)):this.containerController&&this.containerController.unloadView()},u.prototype.getPrimarySurface=function(){return this.containerController.surface},u.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},u.prototype.createLooper=function(t){return new r.RafLooper(t)},u.prototype.sendToExternal=function(t,e){},u.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},u.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},u.prototype.notifyViewMoved=function(){},u.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},u.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},u.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},i.Platform=u},{"./AudioManager":30,"./ContainerController":31,"./RafLooper":34,"./ResourceFactory":35,"./asset/XHRTextAsset":40,"./plugin/AudioPluginManager":65,"./plugin/AudioPluginRegistry":66}],34:[function(t,e,i){"use strict";function r(t){this._fun=t,this._timerId=void 0,this._prev=0}Object.defineProperty(i,"__esModule",{value:!0}),i.RafLooper=void 0,r.prototype.start=function(){var e=this,i=function(t){null!=e._timerId&&(e._timerId=requestAnimationFrame(i),e._fun(t-e._prev),e._prev=t)};this._timerId=requestAnimationFrame(function(t){e._timerId=requestAnimationFrame(i),e._fun(0),e._prev=t})},r.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},i.RafLooper=r},{}],35:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.ResourceFactory=void 0,t("@akashic/akashic-engine")),a=t("./asset/HTMLImageAsset"),h=t("./asset/HTMLVideoAsset"),c=t("./asset/XHRTextAsset"),u=t("./asset/XHRScriptAsset"),l=t("./canvas/GlyphFactory"),d=t("./canvas/shims/SurfaceFactory"),t=(o=s.ResourceFactory,n(p,o),p.prototype.createAudioAsset=function(t,e,i,r,o,n){t=this._audioPluginManager.getActivePlugin().createAsset(t,e,i,r,o,n);return t.onDestroyed&&(this._audioManager.registerAudioAsset(t),t.onDestroyed.add(this._onAudioAssetDestroyed,this)),t},p.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},p.prototype.createImageAsset=function(t,e,i,r){return new a.HTMLImageAsset(t,e,i,r)},p.prototype.createVideoAsset=function(t,e,i,r,o,n,s){return new h.HTMLVideoAsset(t,e,i,r,o,n,s)},p.prototype.createTextAsset=function(t,e){return new c.XHRTextAsset(t,e)},p.prototype.createScriptAsset=function(t,e){return new u.XHRScriptAsset(t,e)},p.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},p.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},p.prototype.createGlyphFactory=function(t,e,i,r,o,n,s,a){return new l.GlyphFactory(t,e,i,r,o,n,s,a)},p.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},p);function p(t){var e=o.call(this)||this;return e._audioPluginManager=t.audioPluginManager,e._audioManager=t.audioManager,e._platform=t.platform,e._surfaceFactory=new d.SurfaceFactory,e}i.ResourceFactory=t},{"./asset/HTMLImageAsset":36,"./asset/HTMLVideoAsset":37,"./asset/XHRScriptAsset":39,"./asset/XHRTextAsset":40,"./canvas/GlyphFactory":43,"./canvas/shims/SurfaceFactory":49,"@akashic/akashic-engine":2}],36:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLImageAsset=i.ImageAssetSurface=void 0,t("@akashic/akashic-engine")),a=(o=s.Surface,n(h,o),h.prototype.renderer=function(){throw s.ExceptionFactory.createAssertionError("ImageAssetSurface cannot be rendered.")},h.prototype.isPlaying=function(){return!1},h);function h(t,e,i){return o.call(this,t,e,i)||this}i.ImageAssetSurface=a;c=s.ImageAsset,n(u,c),u.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,c.prototype.destroy.call(this)},u.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,s.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},u.prototype.asSurface=function(){if(this.data)return this._surface||(this._surface=new a(this.width,this.height,this.data)),this._surface;throw s.ExceptionFactory.createAssertionError("ImageAssetImpl#asSurface: not yet loaded.")};var c,t=u;function u(t,e,i,r){t=c.call(this,t,e,i,r)||this;return t.data=void 0,t._surface=void 0,t}i.HTMLImageAsset=t},{"@akashic/akashic-engine":2}],37:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLVideoAsset=void 0,t("@akashic/akashic-engine")),a=t("./HTMLVideoPlayer"),h=(o=s.Surface,n(c,o),c.prototype.renderer=function(){throw s.ExceptionFactory.createAssertionError("VideoAssetSurface cannot be rendered.")},c.prototype.isPlaying=function(){return!1},c);function c(t,e,i){return o.call(this,t,e,i,!0)||this}u=s.VideoAsset,n(l,u),l.prototype.inUse=function(){return!1},l.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},l.prototype.getPlayer=function(){return this._player},l.prototype.asSurface=function(){return this._surface};var u,t=l;function l(t,e,i,r,o,n,s){t=u.call(this,t,e,i,r,o,n,s)||this;return t._player=new a.HTMLVideoPlayer,t._surface=new h(i,r,null),t}i.HTMLVideoAsset=t},{"./HTMLVideoPlayer":38,"@akashic/akashic-engine":2}],38:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLVideoPlayer=void 0,t("@akashic/akashic-engine")),t=(o=t.VideoPlayer,n(s,o),s.prototype.play=function(t){},s.prototype.stop=function(){},s.prototype.changeVolume=function(t){},s);function s(t){t=o.call(this,t)||this;return t.isDummy=!0,t}i.HTMLVideoPlayer=t},{"@akashic/akashic-engine":2}],39:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.XHRScriptAsset=void 0,t("@akashic/akashic-engine")),a=t("../utils/XHRLoader"),t=(o=s.ScriptAsset,n(h,o),h.prototype._load=function(i){var r=this;(new a.XHRLoader).get(this.path,function(t,e){t?i._onAssetError(r,t):(r.script=e+"\n",i._onAssetLoad(r))})},h.prototype.execute=function(t){return this._wrap()(t),t.module.exports},h.prototype._wrap=function(){return new Function("g",h.PRE_SCRIPT+this.script+h.POST_SCRIPT)},h.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",h.POST_SCRIPT="\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",h);function h(t,e){t=o.call(this,t,e)||this;return t.script=void 0,t}i.XHRScriptAsset=t},{"../utils/XHRLoader":83,"@akashic/akashic-engine":2}],40:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.XHRTextAsset=void 0,t("@akashic/akashic-engine")),a=t("../utils/XHRLoader"),t=(o=s.TextAsset,n(h,o),h.prototype._load=function(i){var r=this;(new a.XHRLoader).get(this.path,function(t,e){t?i._onAssetError(r,t):(r.data=e,i._onAssetLoad(r))})},h);function h(t,e){t=o.call(this,t,e)||this;return t.data=void 0,t}i.XHRTextAsset=t},{"../utils/XHRLoader":83,"@akashic/akashic-engine":2}],41:[function(t,e,i){"use strict";function r(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}Object.defineProperty(i,"__esModule",{value:!0}),i.AffineTransformer=void 0,r.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},r.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},r.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],o=t[2]*e[0]+t[3]*e[2],n=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],t=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=o,e[3]=n,e[4]=s,e[5]=t,this},r.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},r.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},i.AffineTransformer=r},{}],42:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasSurface=void 0,t("@akashic/akashic-engine")),t=(o=t.Surface,n(s,o),s.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,o.prototype.destroy.call(this)},s.prototype.getHTMLElement=function(){return this.canvas},s.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},s);function s(t,e){var i=this,r=document.createElement("canvas"),i=o.call(this,t,e,r)||this;return r.width=t,r.height=e,i.canvas=r,i._renderer=void 0,i}i.CanvasSurface=t},{"@akashic/akashic-engine":2}],43:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),g=(Object.defineProperty(i,"__esModule",{value:!0}),i.GlyphFactory=void 0,t("@akashic/akashic-engine")),y=t("./context2d/Context2DSurface");function n(t,e,i,r,o,n,s,a,h,c,u,l){var d=e<m._environmentMinimumFontSize?e/m._environmentMinimumFontSize:1,p=Math.ceil((e+2*o)*d),f=Math.ceil((e+2*n)*d),p=new y.Context2DSurface(p,f),f=p.canvas,_=f.getContext("2d"),t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),l=l===g.FontWeight.Bold?"bold ":"",l=(_.save(),_.font=l+e+"px "+i,_.textAlign="left",_.textBaseline="alphabetic",_.lineJoin="bevel",1!=d&&_.scale(d,d),0<h&&(_.lineWidth=h,_.strokeStyle=c,_.strokeText(t,o,n+r)),u||(_.fillStyle=a,_.fillText(t,o,n+r)),_.measureText(t).width);return _.restore(),{surface:p,advanceWidth:l,imageData:s?_.getImageData(0,0,f.width,f.height):void 0}}function h(t){switch(t){case g.FontFamily.Monospace:return"monospace";case g.FontFamily.Serif:return"serif";default:return"sans-serif"}}var s=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function c(t){return-1!==s.indexOf(t)?t:'"'+t+'"'}u=g.GlyphFactory,o(l,u),l.prototype.create=function(t){var e,i,r=this._glyphAreas[t];return r||((r=function(t){for(var e=t.width,i=t.height,r=0,o=0,n=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0)0!==t.data[n+3]&&(h<e&&(e=h),r<h&&(r=h),s<i&&(i=s),o<s&&(o=s)),n+=4;return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:o-i+1}}((e=n(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)).imageData)).advanceWidth=e.advanceWidth,this._glyphAreas[t]=r),0===(i=r).width||0===i.height?(e&&e.surface.destroy(),new g.Glyph(t,0,0,0,0,0,0,r.advanceWidth,void 0,!0)):(e=e||n(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),new g.Glyph(t,r.x,r.y,r.width,r.height,r.x-this._marginW,r.y-this._marginH,r.advanceWidth,e.surface,!0))},l.prototype.measureMinimumFontSize=function(){for(var t,e=1,i=document.createElement("canvas").getContext("2d"),r=(i.textAlign="left",i.textBaseline="alphabetic",i.lineJoin="bevel",i.font=e+"px sans-serif",i.measureText("M").width);t=r,i.font=(e+=1)+"px sans-serif",t===(r=i.measureText("M").width)||50<e;);return e};var u,m=l;function l(t,e,i,r,o,n,s,a){e=u.call(this,t,e,i,r,o,n,s,a)||this,e._glyphAreas={},e._cssFontFamily="number"==typeof(i=t)?h(i):"string"==typeof i?c(i):i.map(function(t){return("string"==typeof t?c:h)(t)}).join(","),r=h(g.FontFamily.SansSerif);return-1===e._cssFontFamily.indexOf(r)&&(e._cssFontFamily+=","+r),e._marginW=Math.ceil(.3*e.fontSize+e.strokeWidth/2),e._marginH=Math.ceil(.3*e.fontSize+e.strokeWidth/2),void 0===l._environmentMinimumFontSize&&(l._environmentMinimumFontSize=e.measureMinimumFontSize()),e}i.GlyphFactory=m},{"./context2d/Context2DSurface":48,"@akashic/akashic-engine":2}],44:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RenderingHelper=void 0,(i=i.RenderingHelper||(i.RenderingHelper={})).toPowerOfTwo=function(t){if(0==(t&t-1))return t;for(var e=1;e<t;)e*=2;return e},i.clamp=function(t){return Math.min(Math.max(t,0),1)},i.usedWebGL=function(t){var e=!1;return e=t&&0<t.length?"webgl"===t[0]:e}},{}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasRenderingState=void 0;var r=t("../AffineTransformer");i.CanvasRenderingState=function(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer)}},{"../AffineTransformer":41}],46:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasSurfaceContext=void 0;var r=t("./CanvasRenderingState");function o(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;t=new r.CanvasRenderingState;this._contextFillStyle=t.fillStyle,this._contextGlobalAlpha=t.globalAlpha,this._contextGlobalCompositeOperation=t.globalCompositeOperation,this.pushState(t)}Object.defineProperty(o.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!1,configurable:!0}),o.prototype.getCanvasRenderingContext2D=function(){return this._context},o.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},o.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},o.prototype.restore=function(){this.popState()},o.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},o.prototype.drawImage=function(t,e,i,r,o,n,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,o,n,s,a,h)},o.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},o.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},o.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},o.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},o.prototype.transform=function(t,e,i,r,o,n){this.currentState().transformer.transform([t,e,i,r,o,n]),this._modifiedTransform=!0},o.prototype.setTransform=function(t,e,i,r,o,n){this.currentState().transformer.setTransform([t,e,i,r,o,n]),this._modifiedTransform=!0},o.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},o.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},o.prototype.putImageData=function(t,e,i,r,o,n,s){this._context.putImageData(t,e,i,r,o,n,s)},o.prototype.prerender=function(){var t=this.currentState();t.fillStyle!==this._contextFillStyle&&(this._context.fillStyle=t.fillStyle,this._contextFillStyle=t.fillStyle),t.globalAlpha!==this._contextGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._contextGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._contextGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._contextGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform&&(t=t.transformer,this._context.setTransform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this._modifiedTransform=!1)},o.prototype.pushState=function(t){this._stateStack.push(t)},o.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0,this._contextFillStyle=this._context.fillStyle,this._contextGlobalAlpha=this._context.globalAlpha,this._contextGlobalCompositeOperation=this._context.globalCompositeOperation)},o.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},i.CanvasSurfaceContext=o},{"./CanvasRenderingState":45}],47:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),g=(Object.defineProperty(i,"__esModule",{value:!0}),i.Context2DRenderer=void 0,t("@akashic/akashic-engine")),t=(o=g.Renderer,n(s,o),s.prototype.begin=function(){o.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},s.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),o.prototype.end.call(this)},s.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},s.prototype.drawImage=function(t,e,i,r,o,n,s){this.context.drawImage(t._drawable,e,i,r,o,n,s,r,o)},s.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},s.prototype.drawSystemText=function(t,e,i,r,o,n,s,a,h,c,u,l){var d,p,f,_=this.canvasRenderingContext2D;switch(this.context.prerender(),_.save(),h){case g.FontFamily.Monospace:d="monospace";break;case g.FontFamily.Serif:d="serif";break;default:d="sans-serif"}switch(_.font=o+"px "+d,n){case g.TextAlign.Right:p="right";break;case g.TextAlign.Center:p="center";break;default:p="left"}switch(_.textAlign=p,s){case g.TextBaseline.Top:f="top";break;case g.TextBaseline.Middle:f="middle";break;case g.TextBaseline.Bottom:f="bottom";break;default:f="alphabetic"}_.textBaseline=f,_.lineJoin="bevel",0<c&&(_.lineWidth=c,_.strokeStyle=u,void 0===r?_.strokeText(t,e,i):_.strokeText(t,e,i,r)),l||(_.fillStyle=a,_.fillText(t,e,i,r)),_.restore()},s.prototype.translate=function(t,e){this.context.translate(t,e)},s.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},s.prototype.opacity=function(t){this.context.globalAlpha*=t},s.prototype.save=function(){this.context.save()},s.prototype.restore=function(){this.context.restore()},s.prototype.fillRect=function(t,e,i,r,o){this.context.fillStyle=o,this.context.fillRect(t,e,i,r)},s.prototype.setCompositeOperation=function(t){var e;switch(t){case g.CompositeOperation.SourceAtop:e="source-atop";break;case g.CompositeOperation.Lighter:e="lighter";break;case g.CompositeOperation.Copy:e="copy";break;case g.CompositeOperation.ExperimentalSourceIn:e="source-in";break;case g.CompositeOperation.ExperimentalSourceOut:e="source-out";break;case g.CompositeOperation.ExperimentalDestinationAtop:e="destination-atop";break;case g.CompositeOperation.ExperimentalDestinationIn:e="destination-in";break;case g.CompositeOperation.DestinationOut:e="destination-out";break;case g.CompositeOperation.DestinationOver:e="destination-over";break;case g.CompositeOperation.Xor:e="xor";break;default:e="source-over"}this.context.globalCompositeOperation=e},s.prototype.setOpacity=function(t){this.context.globalAlpha=t},s.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},s.prototype.setShaderProgram=function(t){throw g.ExceptionFactory.createAssertionError("Context2DRenderer#setShaderProgram() is not implemented")},s.prototype.isSupportedShaderProgram=function(){return!1},s.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},s.prototype._putImageData=function(t,e,i,r,o,n,s){void 0===n&&(n=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r=void 0===r?0:r,o=void 0===o?0:o,n,s)},s);function s(t){var e=o.call(this)||this;return e.surface=t,e.context=t.context(),e.canvasRenderingContext2D=e.context.getCanvasRenderingContext2D(),e}i.Context2DRenderer=t},{"@akashic/akashic-engine":2}],48:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.Context2DSurface=void 0,t("./Context2DRenderer")),a=t("./CanvasSurfaceContext"),t=t("../CanvasSurface"),t=(o=t.CanvasSurface,n(h,o),h.prototype.context=function(){return this._context||(this._context=new a.CanvasSurfaceContext(this.canvas.getContext("2d"))),this._context},h.prototype.renderer=function(){return this._renderer||(this._renderer=new s.Context2DRenderer(this)),this._renderer},h.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},h.prototype.isPlaying=function(){return!1},h);function h(){return null!==o&&o.apply(this,arguments)||this}i.Context2DSurface=t},{"../CanvasSurface":42,"./CanvasSurfaceContext":46,"./Context2DRenderer":47}],49:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceFactory=void 0;var r=t("../RenderingHelper"),o=t("../context2d/Context2DSurface"),n=t("../webgl/WebGLSharedObject");function s(){}s.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new n.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new o.Context2DSurface(t,e)},s.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new o.Context2DSurface(t,e)},i.SurfaceFactory=s},{"../RenderingHelper":44,"../context2d/Context2DSurface":48,"../webgl/WebGLSharedObject":58}],50:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLBackSurface=void 0,t("./WebGLBackSurfaceRenderer")),t=t("./WebGLPrimarySurface"),t=(o=t.WebGLPrimarySurface,n(a,o),a.prototype.renderer=function(){return this._renderer||(this._renderer=new s.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},a.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,o.prototype.destroy.call(this)},a);function a(){return null!==o&&o.apply(this,arguments)||this}i.WebGLBackSurface=t},{"./WebGLBackSurfaceRenderer":51,"./WebGLPrimarySurface":53}],51:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLBackSurfaceRenderer=void 0,t("./WebGLRenderer")),a=t("./WebGLRenderingState"),t=(o=s.WebGLRenderer,n(h,o),h.prototype.begin=function(){o.prototype.begin.call(this),this.save();var t=new a.WebGLRenderingState(this.currentState()),e=t.transformer.matrix;e[1]*=-1,e[3]*=-1,e[5]=-e[5]+this._renderTarget.height,this.currentState().copyFrom(t),this._shared.pushRenderTarget(this._renderTarget)},h.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),o.prototype.end.call(this)},h);function h(t,e){e=o.call(this,e,e.createRenderTarget(t.width,t.height))||this;return t._drawable={texture:e._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:t.width,textureHeight:t.height},e}i.WebGLBackSurfaceRenderer=t},{"./WebGLRenderer":55,"./WebGLRenderingState":56}],52:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLColor=void 0;var r,o=t("../RenderingHelper");(r=i.WebGLColor||(i.WebGLColor={})).colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},r.get=function(t){return(t="string"==typeof t?r._toColor(t):[t[0],t[1],t[2],t[3]])[3]=o.RenderingHelper.clamp(t[3]),t[0]=o.RenderingHelper.clamp(t[0])*t[3],t[1]=o.RenderingHelper.clamp(t[1])*t[3],t[2]=o.RenderingHelper.clamp(t[2])*t[3],t},r._hsl2rgb=function(t){var e=t[0]%360,i=t[1],r=50<t[2]?100-t[2]:t[2],t=t[3],o=r+r*i,r=r-r*i;return e<60?[o,e/60*(o-r)+r,r,t]:e<120?[(120-e)/60*(o-r)+r,o,r,t]:e<180?[r,o,(e-120)/60*(o-r)+r,t]:e<240?[r,(240-e)/60*(o-r)+r,o,t]:e<300?[(e-240)/60*(o-r)+r,r,o,t]:[o,r,(360-e)/60*(o-r)+r,t]},r._toColor=function(t){var t=t.toUpperCase().replace(/\s+/g,""),e=r.colorMap[t];if(e)return e;if(t.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(t.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(t.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(t.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(t.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return r._hsl2rgb([parseInt(RegExp.$1,10),o.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),o.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(t.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return r._hsl2rgb([parseInt(RegExp.$1,10),o.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),o.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+t)}},{"../RenderingHelper":44}],53:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLPrimarySurface=void 0,t("../CanvasSurface")),a=t("./WebGLPrimarySurfaceRenderer"),t=(o=s.CanvasSurface,n(h,o),h.prototype.renderer=function(){return this._renderer||(this._renderer=new a.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},h.prototype.changePhysicalScale=function(t,e){t=Math.ceil(this.width*t),e=Math.ceil(this.height*e);this.canvas.width=t,this.canvas.height=e,this.renderer().changeViewportSize(t,e)},h.prototype.isPlaying=function(){return!1},h);function h(t,e,i){e=o.call(this,e,i)||this;return e.canvas.style.position="absolute",e._shared=t,e}i.WebGLPrimarySurface=t},{"../CanvasSurface":42,"./WebGLPrimarySurfaceRenderer":54}],54:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLPrimarySurfaceRenderer=void 0,t("./WebGLRenderer")),t=(o=t.WebGLRenderer,n(s,o),s.prototype.begin=function(){o.prototype.begin.call(this),this._shared.begin()},s);function s(t,e){t=o.call(this,t,e)||this;return t._shared.pushRenderTarget(t._renderTarget),t}i.WebGLPrimarySurfaceRenderer=t},{"./WebGLRenderer":55}],55:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRenderer=void 0,t("@akashic/akashic-engine")),s=t("./WebGLColor"),h=t("./WebGLRenderingState"),t=(o=a.Renderer,n(c,o),c.prototype.clear=function(){this._shared.clear()},c.prototype.end=function(){this._shared.end()},c.prototype.save=function(){this._pushState()},c.prototype.restore=function(){this._popState()},c.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},c.prototype.transform=function(t){this.currentState().transformer.transform(t)},c.prototype.opacity=function(t){this.currentState().globalAlpha*=t},c.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},c.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},c.prototype.fillRect=function(t,e,i,r,o){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,s.WebGLColor.get(o))},c.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},c.prototype.drawImage=function(t,e,i,r,o,n,s){if(!t._drawable)throw a.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw a.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,n,s,this._whiteColor)},c.prototype.drawSystemText=function(t,e,i,r,o,n,s,a,h,c,u,l){},c.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},c.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},c.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},c.prototype.isSupportedShaderProgram=function(){return!0},c.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},c.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},c.prototype._getImageData=function(){throw a.ExceptionFactory.createAssertionError("WebGLRenderer#_getImageData() is not implemented")},c.prototype._putImageData=function(t,e,i,r,o,n,s){throw a.ExceptionFactory.createAssertionError("WebGLRenderer#_putImageData() is not implemented")},c.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},c.prototype._popState=function(){if(!(0<this._stateStackPointer))throw a.ExceptionFactory.createAssertionError("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},c.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},c.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new h.WebGLRenderingState)}},c.DEFAULT_CAPACITY=16,c);function c(t,e){var i=o.call(this)||this;return i._stateStack=[],i._stateStackPointer=0,i._capacity=0,i._reallocation(c.DEFAULT_CAPACITY),i._whiteColor=[1,1,1,1],i._shared=t,i._renderTarget=e,i}i.WebGLRenderer=t},{"./WebGLColor":52,"./WebGLRenderingState":56,"@akashic/akashic-engine":2}],56:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRenderingState=void 0;var r=t("@akashic/akashic-engine"),o=t("../AffineTransformer");function n(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new o.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new o.AffineTransformer,this.shaderProgram=null)}n.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},i.WebGLRenderingState=n},{"../AffineTransformer":41,"@akashic/akashic-engine":2}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLShaderProgram=void 0;var a=t("@akashic/akashic-engine");function o(t,e,i){e=e||o._DEFAULT_FRAGMENT_SHADER,e=o._makeShaderProgram(t,o._DEFAULT_VERTEX_SHADER,e);this.program=e,this._context=t,this._aVertex=t.getAttribLocation(this.program,"aVertex"),this._uColor=t.getUniformLocation(this.program,"uColor"),this._uAlpha=t.getUniformLocation(this.program,"uAlpha"),this._uSampler=t.getUniformLocation(this.program,"uSampler"),this._uniforms=i,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}o._makeShader=function(t,e,i){e=t.createShader(e);if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw i=t.getShaderInfoLog(e),t.deleteShader(e),new Error(i)},o._makeShaderProgram=function(t,e,i){var r=t.createProgram(),e=o._makeShader(t,t.VERTEX_SHADER,e),e=(t.attachShader(r,e),t.deleteShader(e),o._makeShader(t,t.FRAGMENT_SHADER,i));if(t.attachShader(r,e),t.deleteShader(e),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS))return r;throw i=t.getProgramInfoLog(r),t.deleteProgram(r),new Error(i)},o.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},o.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},o.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},o.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},o.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;!e.isArray&&i===e.beforeValue||(e.update(e.loc,i),e.beforeValue=i)}},o.prototype.initializeUniforms=function(){var o=this,n=[],s=this._uniforms;null!=s&&Object.keys(s).forEach(function(t){var e=s[t].type,i=!("number"==typeof s[t].value),r=(!i||"int"!==e&&"float"!==e||(e+="_v"),o._uniformSetterTable[e]);if(!r)throw a.ExceptionFactory.createAssertionError("WebGLShaderProgram#initializeUniforms: Uniform type '"+e+"' is not supported.");n.push({name:t,update:r,beforeValue:null,isArray:i,loc:o._context.getUniformLocation(o.program,t)})}),this._uniformCaches=n},o.prototype.use=function(){this._context.useProgram(this.program)},o.prototype.unuse=function(){this._context.useProgram(null)},o.prototype.destroy=function(){this._context.deleteProgram(this.program)},o.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},o.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},o.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},o.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},o.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},o.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},o.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},o.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},o.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},o.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},o.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},o.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},o.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},o._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",o._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",i.WebGLShaderProgram=o},{"@akashic/akashic-engine":2}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLSharedObject=void 0;var o=t("@akashic/akashic-engine"),r=t("./WebGLShaderProgram"),n=t("./WebGLTextureAtlas"),s=t("./WebGLPrimarySurface"),a=t("./WebGLBackSurface");function h(t,e){t=new s.WebGLPrimarySurface(this,t,e),e=t.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!e)throw o.ExceptionFactory.createAssertionError("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=t,this._context=e,this._init()}h.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},h.prototype.getPrimarySurface=function(){return this._surface},h.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},h.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},h.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},h.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},h.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},h.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},h.prototype.draw=function(t,e,i,r,o,n,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit(),c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation&&(this._currentCompositeOperation=t.globalCompositeOperation,this._commit(),c=this._compositeOps[this._currentCompositeOperation],this._context.blendFunc(c[0],c[1]));var h=1/e.textureWidth,c=1/e.textureHeight,u=e.textureOffsetX,e=e.textureOffsetY,l=h*(u+i+o),d=c*(e+r+n),h=h*(u+i),u=c*(e+r);this._register(this._transformVertex(s,a,o,n,t.transformer),[h,u,l,u,l,d,h,u,l,d,h,d])},h.prototype.end=function(){if(this._commit(),0<this._deleteRequestedTargets.length){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},h.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},h.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},h.prototype.assignTexture=function(t,e,i,r){if(this._context.bindTexture(this._context.TEXTURE_2D,r),t instanceof HTMLVideoElement)throw o.ExceptionFactory.createAssertionError("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},h.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},h.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},h.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},h.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},h.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer(),o=(i.bindFramebuffer(i.FRAMEBUFFER,r),i.createTexture()),n=(i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,o,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture),this.getCurrentRenderTarget());return i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:o}},h.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},h.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},h.prototype.getContext=function(){return this._context},h.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},h.prototype.initializeShaderProgram=function(t){var e;return t&&!t._program&&((e=new r.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms)).initializeUniforms(),t._program=e),t},h.prototype._init=function(){var t=new r.WebGLShaderProgram(this._context);this._textureAtlas=new n.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=o.CompositeOperation.SourceOver,this._currentShaderProgram=t,this._defaultShaderProgram=t,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=((t={})[o.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[o.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[o.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[o.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[o.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[o.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[o.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[o.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[o.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[o.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[o.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);t=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(t[0],t[1])},h.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},h.prototype._transformVertex=function(t,e,i,r,o){var n=this.getCurrentRenderTarget(),s=2/n.width,n=-2/n.height,o=o.matrix,a=s*i*o[0],i=n*i*o[1],h=s*r*o[2],r=n*r*o[3],s=s*(t*o[0]+e*o[2]+o[4])-1,n=n*(t*o[1]+e*o[3]+o[5])+1;return[s,n,a+s,i+n,a+h+s,i+r+n,s,n,a+h+s,i+r+n,h+s,r+n]},h.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},h.prototype._commit=function(){0<this._numSprites&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},i.WebGLSharedObject=h},{"./WebGLBackSurface":50,"./WebGLPrimarySurface":53,"./WebGLShaderProgram":57,"./WebGLTextureAtlas":59,"@akashic/akashic-engine":2}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLTextureAtlas=void 0;var n=t("./WebGLTextureMap"),s=t("../RenderingHelper");function a(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(a.TEXTURE_SIZE*a.TEXTURE_SIZE*4)}a.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},a.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},a.prototype.makeTextureForSurface=function(t,e){var i,r,o,n=e._drawable;n&&!n.texture&&(i=n.width,r=n.height,a.TEXTURE_SIZE<=i||a.TEXTURE_SIZE<=r?(i=s.RenderingHelper.toPowerOfTwo(n.width),r=s.RenderingHelper.toPowerOfTwo(n.height),i===n.width&&r===n.height||((o=document.createElement("canvas")).width=i,o.height=r,(o=o.getContext("2d")).globalCompositeOperation="copy",o.drawImage(n,0,0),n=o.getImageData(0,0,i,r)),e._drawable.texture=t.makeTexture(n),e._drawable.textureOffsetX=0,e._drawable.textureOffsetY=0,e._drawable.textureWidth=i,e._drawable.textureHeight=r):this._assign(t,e,this._maps))},a.prototype._assign=function(t,e,i){for(var r,o=0;o<i.length;++o)if(r=i[(o+this._insertPos)%i.length].insert(e))return this._register(t,r,e._drawable),void(this._insertPos=o);r=null,i.length>=a.TEXTURE_COUNT&&(r=i.shift(),t.disposeTexture(r.texture),r.dispose(),t.clearTexture(this.emptyTexturePixels,a.TEXTURE_SIZE,a.TEXTURE_SIZE,r.texture)),r=r||new n.WebGLTextureMap(t.makeTextureRaw(a.TEXTURE_SIZE,a.TEXTURE_SIZE),0,0,a.TEXTURE_SIZE,a.TEXTURE_SIZE),i.push(r),r=r.insert(e),this._register(t,r,e._drawable)},a.prototype._register=function(t,e,i){i.texture=e.texture,i.textureOffsetX=e.offsetX,i.textureOffsetY=e.offsetY,i.textureWidth=a.TEXTURE_SIZE,i.textureHeight=a.TEXTURE_SIZE,t.assignTexture(i,e.offsetX,e.offsetY,e.texture)},a.TEXTURE_SIZE=1024,a.TEXTURE_COUNT=16,i.WebGLTextureAtlas=a},{"../RenderingHelper":44,"./WebGLTextureMap":60}],60:[function(t,e,i){"use strict";function n(t,e,i,r,o){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=o}Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLTextureMap=void 0,n.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},n.prototype.capacity=function(){return this._width*this._height},n.prototype.area=function(){var t;return this._surface?(t=(t=this._surface._drawable).width*t.height,this._left&&(t+=this._left.area()),this._right&&(t+=this._right.area()),t):0},n.prototype.occupancy=function(){return this.area()/this.capacity()},n.prototype.insert=function(t){var e,i=t._drawable,r=i.width+n.TEXTURE_MARGIN,i=i.height+n.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(t);if(o)return o}if(this._right){var o=this._right.insert(t);if(o)return o}return null}return this._width<r||this._height<i?null:((o=this._width-r)<=(e=this._height-i)?(this._left=new n(this.texture,this.offsetX+r,this.offsetY,o,i),this._right=new n(this.texture,this.offsetX,this.offsetY+i,this._width,e)):(this._left=new n(this.texture,this.offsetX,this.offsetY+i,r,e),this._right=new n(this.texture,this.offsetX+r,this.offsetY,o,this._height)),this._surface=t,this)},n.TEXTURE_MARGIN=1,i.WebGLTextureMap=n},{}],61:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputAbstractHandler=void 0;var r=t("@akashic/akashic-engine");t("@akashic/akashic-pdi");function o(t,e){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===o.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=t,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!e,this.pointTrigger=new r.Trigger}o.isSupported=function(){return!1},o.prototype.start=function(){throw new Error("This method is abstract")},o.prototype.stop=function(){throw new Error("This method is abstract")},o.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},o.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},o.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},o.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},o.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},o.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},o.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},i.InputAbstractHandler=o},{"@akashic/akashic-engine":2,"@akashic/akashic-pdi":4}],62:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.MouseHandler=void 0,t("./InputAbstractHandler")),t=(o=t.InputAbstractHandler,n(s,o),s.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1)},s.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1)},s);function s(t,e){var i=o.call(this,t,e)||this;return i.onMouseDown=function(t){0===t.button&&(i.pointDown(1,i.getOffsetPositionFromInputView(t)),window.addEventListener("mousemove",i.onMouseMove,!1),window.addEventListener("mouseup",i.onMouseUp,!1),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},i.onMouseMove=function(t){i.pointMove(1,i.getOffsetPositionFromInputView(t)),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},i.onMouseUp=function(t){i.pointUp(1,i.getOffsetPositionFromInputView(t)),window.removeEventListener("mousemove",i.onMouseMove,!1),window.removeEventListener("mouseup",i.onMouseUp,!1),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},i}i.MouseHandler=t},{"./InputAbstractHandler":61}],63:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.TouchHandler=void 0,t("./MouseHandler")),t=(o=t.MouseHandler,n(s,o),s.prototype.start=function(){o.prototype.start.call(this),this.inputView.addEventListener("touchstart",this.onTouchDown),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchUp)},s.prototype.stop=function(){o.prototype.stop.call(this),this.inputView.removeEventListener("touchstart",this.onTouchDown),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchUp)},s);function s(t,e){var n=o.call(this,t,e)||this;return n.onTouchDown=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointDown(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n.onTouchMove=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointMove(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n.onTouchUp=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointUp(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n}i.TouchHandler=t},{"./MouseHandler":62}],64:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlugin=i.PostMessageAudioPlugin=i.WebAudioPlugin=i.HTMLAudioPlugin=i.AudioPluginRegistry=i.g=i.ResourceFactory=i.Platform=void 0;var r=t("./Platform"),o=(Object.defineProperty(i,"Platform",{enumerable:!0,get:function(){return r.Platform}}),t("./ResourceFactory")),n=(Object.defineProperty(i,"ResourceFactory",{enumerable:!0,get:function(){return o.ResourceFactory}}),t("@akashic/akashic-engine")),s=(i.g=n,t("./plugin/AudioPluginRegistry")),a=(Object.defineProperty(i,"AudioPluginRegistry",{enumerable:!0,get:function(){return s.AudioPluginRegistry}}),t("./plugin/AudioPluginManager")),h=(Object.defineProperty(i,"AudioPluginManager",{enumerable:!0,get:function(){return a.AudioPluginManager}}),t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin")),c=(Object.defineProperty(i,"HTMLAudioPlugin",{enumerable:!0,get:function(){return h.HTMLAudioPlugin}}),t("./plugin/WebAudioPlugin/WebAudioPlugin")),u=(Object.defineProperty(i,"WebAudioPlugin",{enumerable:!0,get:function(){return c.WebAudioPlugin}}),t("./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin")),l=(Object.defineProperty(i,"PostMessageAudioPlugin",{enumerable:!0,get:function(){return u.PostMessageAudioPlugin}}),t("./plugin/ProxyAudioPlugin/ProxyAudioPlugin"));Object.defineProperty(i,"ProxyAudioPlugin",{enumerable:!0,get:function(){return l.ProxyAudioPlugin}})},{"./Platform":33,"./ResourceFactory":35,"./plugin/AudioPluginManager":65,"./plugin/AudioPluginRegistry":66,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":70,"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin":73,"./plugin/ProxyAudioPlugin/ProxyAudioPlugin":77,"./plugin/WebAudioPlugin/WebAudioPlugin":82,"@akashic/akashic-engine":2}],65:[function(t,e,i){"use strict";function r(){this._activePlugin=null}Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPluginManager=void 0,r.prototype.getActivePlugin=function(){return this._activePlugin},r.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;if(r.isSupported())return this._activePlugin=new r,!0}return!1},i.AudioPluginManager=r},{}],66:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPluginRegistry=void 0;var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],67:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioAsset=void 0,t("@akashic/akashic-engine")),t=(o=h.AudioAsset,n(c,o),c.prototype._load=function(t){var i,e,r,o,n,s,a=this;null==this.path?(this.data=null,setTimeout(function(){return t._onAssetLoad(a)},0)):(i=new Audio,e=function(t,e){i.autoplay=!1,i.preload="none",i.src=t,a._attachAll(i,e),i.preload="auto",o(i,e),i.load()},r={success:function(){a._detachAll(i,r),a.data=i,t._onAssetLoad(a),window.clearInterval(a._intervalId)},error:function(){a._detachAll(i,r),a.data=i,t._onAssetError(a,h.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(a._intervalId)}},o=function(t,e){a._intervalCount=0,a._intervalId=window.setInterval(function(){4===t.readyState?e.success():(++a._intervalCount,600===a._intervalCount&&e.error())},100)},".aac"===(0<=(n=this.path.indexOf("?"))?this.path.substring(0,n):this.path).slice(-4)&&-1!==c.supportedFormats.indexOf("mp4")?(s={success:r.success,error:function(){a._detachAll(i,s),window.clearInterval(a._intervalId),a.path=h.PathUtil.addExtname(a.originalPath,"mp4"),e(a.path,r)}},e(this.path,s)):e(this.path,r))},c.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},c.prototype._assetPathFilter=function(t){return-1!==c.supportedFormats.indexOf("ogg")?h.PathUtil.addExtname(t,"ogg"):-1!==c.supportedFormats.indexOf("aac")?h.PathUtil.addExtname(t,"aac"):null},c.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},c.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},c);function c(){return null!==o&&o.apply(this,arguments)||this}i.HTMLAudioAsset=t},{"@akashic/akashic-engine":2}],68:[function(t,e,i){"use strict";var r,o=0,n=[];function s(){a(),document.removeEventListener("keydown",s),document.removeEventListener("mousedown",s),document.removeEventListener("touchend",s)}function a(){o=2,n.forEach(function(t){return t.play()}),n=[]}(r||(r={})).setupChromeMEIWorkaround=function(t){function e(){switch(o){case 0:case 1:a()}o=2,clearTimeout(r)}function i(){switch(t.removeEventListener("play",e),o){case 0:n.push(t),o=1,document.addEventListener("keydown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("touchend",s,!0);break;case 1:n.push(t);break;case 2:t.play()}}switch(o){case 0:t.addEventListener("play",e,!0);var r=setTimeout(i,100);break;case 1:n.push(t)}},e.exports=r},{}],69:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioPlayer=void 0,t("@akashic/akashic-engine")),a=t("./HTMLAudioAutoplayHelper"),t=(o=s.AudioPlayer,n(h,o),h.prototype.play=function(t){this.currentAudio&&this.stop();var e=t.cloneElement();e?(a.setupChromeMEIWorkaround(e),e.volume=this._calculateVolume(),e.play().catch(function(t){}),e.loop=t.loop,e.addEventListener("ended",this._endedEventHandler,!1),e.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=e):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration),o.prototype.play.call(this,t)},h.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null))),o.prototype.stop.call(this)},h.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),o.prototype.stop.call(this)},h.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},h.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},h.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e){var i=o.call(this,t)||this;return i._manager=e,i._endedEventHandler=function(){i._onAudioEnded()},i._onPlayEventHandler=function(){i._onPlayEvent()},i._dummyDurationWaitTimer=null,i}i.HTMLAudioPlayer=t},{"./HTMLAudioAutoplayHelper":68,"@akashic/akashic-engine":2}],70:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioPlugin=void 0;var s=t("./HTMLAudioAsset"),r=t("./HTMLAudioPlayer");function o(){this._supportedFormats=this._detectSupportedFormats(),s.HTMLAudioAsset.supportedFormats=this.supportedFormats}o.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(o.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,s.HTMLAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),o.prototype.createAsset=function(t,e,i,r,o,n){return new s.HTMLAudioAsset(t,e,i,r,o,n)},o.prototype.createPlayer=function(t,e){return new r.HTMLAudioPlayer(t,e)},o.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},i.HTMLAudioPlugin=o},{"./HTMLAudioAsset":67,"./HTMLAudioPlayer":69}],71:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageAudioAsset=void 0,t("@akashic/akashic-engine")),a=t("./PostMessageAudioPlugin"),t=(o=s.AudioAsset,n(h,o),h.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};a.PostMessageAudioPlugin.send("akashic:AudioAsset#_load",i),setTimeout(function(){return t._onAssetLoad(e)})},h.prototype.destroy=function(){a.PostMessageAudioPlugin.send("akashic:AudioAsset#destroy",{id:this.id}),o.prototype.destroy.call(this)},h);function h(){return null!==o&&o.apply(this,arguments)||this}i.PostMessageAudioAsset=t},{"./PostMessageAudioPlugin":73,"@akashic/akashic-engine":2}],72:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageAudioPlayer=void 0,t("@akashic/akashic-engine")),a=t("./PostMessageAudioPlugin"),t=(o=s.AudioPlayer,n(h,o),h.prototype.play=function(t){a.PostMessageAudioPlugin.send("akashic:AudioPlayer#play",{id:this.id,assetId:t.id})},h.prototype.stop=function(){a.PostMessageAudioPlugin.send("akashic:AudioPlayer#stop",{id:this.id})},h.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},h.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},h.prototype._changePlaybackRate=function(t){o.prototype._changePlaybackRate.call(this,t),a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changePlaybackRate",{id:this.id,rate:t})},h.prototype.notifyMasterVolumeChanged=function(){a.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},h.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e,i){t=o.call(this,t)||this;return t._manager=e,t.id=i,a.PostMessageAudioPlugin.send("akashic:AudioPlayer#new",{id:i}),t}i.PostMessageAudioPlayer=t},{"./PostMessageAudioPlugin":73,"@akashic/akashic-engine":2}],73:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageAudioPlugin=void 0;var r,s=t("./PostMessageAudioAsset"),o=t("./PostMessageAudioPlayer"),n=t("./PostMessageHandler");function a(){this.supportedFormats=void 0,this._playerIdx=0}a.isSupported=function(){return"undefined"!=typeof window&&!!window.postMessage},a.initialize=function(t,e){return(r=new n.PostMessageHandler(t,e)).start(),r},a.send=function(t,e){r.send({type:t,parameters:e})},a.prototype.createAsset=function(t,e,i,r,o,n){return new s.PostMessageAudioAsset(t,e,i,r,o,n)},a.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,""+this._playerIdx++)},i.PostMessageAudioPlugin=a},{"./PostMessageAudioAsset":71,"./PostMessageAudioPlayer":72,"./PostMessageHandler":74}],74:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PostMessageHandler=void 0;var r=t("@akashic/akashic-engine");function o(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}o.prototype.start=function(){window.addEventListener("message",this.onMessage_bound)},o.prototype.stop=function(){window.removeEventListener("message",this.onMessage_bound)},o.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},o.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},i.PostMessageHandler=o},{"@akashic/akashic-engine":2}],75:[function(t,e,i){"use strict";var r,a,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=(Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioAsset=void 0,t("@akashic/akashic-engine")),t=(a=n.AudioAsset,o(s,a),s.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),a.prototype.destroy.call(this)},s.prototype._load=function(e){var i=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(t){t?e._onAssetError(i,n.ExceptionFactory.createAssetLoadError(t)):e._onAssetLoad(i)})},s.prototype._assetPathFilter=function(t){return t},s);function s(t,e,i,r,o,n,s){e=a.call(this,e,i,r,o,n,s)||this;return e._handlerSet=t,e}i.ProxyAudioAsset=t},{"@akashic/akashic-engine":2}],76:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlayer=void 0,t("@akashic/akashic-engine")),t=(o=t.AudioPlayer,n(s,o),s.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),this._notifyVolumeToHandler()},s.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),this._notifyVolumeToHandler()},s.prototype.play=function(t){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap"+s._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:t.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),o.prototype.play.call(this,t)},s.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),o.prototype.stop.call(this)},s.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},s.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},s.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},s._audioPlayerIdCounter=0,s);function s(t,e,i){e=o.call(this,e)||this;return e._audioPlayerId=null,e._handlerSet=t,e._manager=i,e}i.ProxyAudioPlayer=t},{"@akashic/akashic-engine":2}],77:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlugin=void 0;var s=t("./ProxyAudioAsset"),r=t("./ProxyAudioPlayer");function o(t){this.supportedFormats=[],this._handlerSet=t}o.isSupported=function(){return!0},o.prototype.createAsset=function(t,e,i,r,o,n){return new s.ProxyAudioAsset(this._handlerSet,t,e,i,r,o,n)},o.prototype.createPlayer=function(t,e){return new r.ProxyAudioPlayer(this._handlerSet,t,e)},i.ProxyAudioPlugin=o},{"./ProxyAudioAsset":75,"./ProxyAudioPlayer":76}],78:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioAsset=void 0,t("@akashic/akashic-engine")),c=t("../../utils/XHRLoader"),u=t("./WebAudioHelper"),t=(o=h.AudioAsset,n(s,o),s.prototype._load=function(e){var i,r,o,n,s,t,a=this;null==this.path?(this.data=null,setTimeout(function(){return e._onAssetLoad(a)},0)):(i=function(t){a.data=t,e._onAssetLoad(a)},r=function(){e._onAssetError(a,h.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},o=function(t){u.getAudioContext().decodeAudioData(t,i,r)},n=new c.XHRLoader,s=function(t,i,r){n.getArrayBuffer(t,function(t,e){t?r(t):i(e)})},".aac"===(0<=(t=this.path.indexOf("?"))?this.path.substring(0,t):this.path).slice(-4)?s(this.path,o,function(t){var e=h.PathUtil.addExtname(a.originalPath,"mp4");s(e,function(t){a.path=e,o(t)},r)}):s(this.path,o,r))},s.prototype._assetPathFilter=function(t){return-1!==s.supportedFormats.indexOf("ogg")?h.PathUtil.addExtname(t,"ogg"):-1!==s.supportedFormats.indexOf("aac")?h.PathUtil.addExtname(t,"aac"):null},s.supportedFormats=[],s);function s(){return null!==o&&o.apply(this,arguments)||this}i.WebAudioAsset=t},{"../../utils/XHRLoader":83,"./WebAudioHelper":80,"@akashic/akashic-engine":2}],79:[function(t,e,i){"use strict";var r,o=t("./WebAudioHelper");function n(){o.getAudioContext().resume(),document.removeEventListener("keydown",n),document.removeEventListener("mousedown",n),document.removeEventListener("touchend",n)}(r||(r={})).setupChromeMEIWorkaround=function(){var t,e,i=o.getAudioContext();i&&"function"!=typeof i.resume||(e=o.createGainNode(i),(t=i.createOscillator()).type="sawtooth",t.frequency.value=440,t.connect(e),t.start(0),e=i.state,t.disconnect(),"running"!==e&&(document.addEventListener("keydown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchend",n,!0)))},e.exports=r},{"./WebAudioHelper":80}],80:[function(t,e,i){"use strict";var r,o,n=window.AudioContext||window.webkitAudioContext;(o=r=r||{}).getAudioContext=function(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var t=window.__akashic__.audioContext;return t instanceof n||(t=window.__akashic__.audioContext=new n,o._workAroundSafari()),t},o.createGainNode=function(t){return t.createGain?t.createGain():t.createGainNode()},o.createBufferNode=function(t){return(t=t.createBufferSource()).start||(t.start=t.noteOn,t.stop=t.noteOff),t},o._workAroundSafari=function(){document.addEventListener("touchstart",function t(){document.removeEventListener("touchstart",t),o.getAudioContext().createBufferSource().start(0)},!0)},e.exports=r},{}],81:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioPlayer=void 0,t("@akashic/akashic-engine")),a=t("./WebAudioHelper"),t=(o=s.AudioPlayer,n(h,o),h.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),this._gainNode.gain.value=this._calculateVolume()},h.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),this._gainNode.gain.value=this._calculateVolume()},h.prototype.play=function(t){var e;this.currentAudio&&this.stop(),t.data?((e=a.createBufferNode(this._audioContext)).loop=t.loop,e.buffer=t.data,this._gainNode.gain.value=this._calculateVolume(),e.connect(this._gainNode),this._sourceNode=e,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration),o.prototype.play.call(this,t)},h.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0)),o.prototype.stop.call(this)},h.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},h.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),o.prototype.stop.call(this)},h.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},h.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e){var i=o.call(this,t)||this;return i._audioContext=a.getAudioContext(),i._manager=e,i._gainNode=a.createGainNode(i._audioContext),i._gainNode.connect(i._audioContext.destination),i._sourceNode=void 0,i._dummyDurationWaitTimer=null,i._endedEventHandler=function(){i._onAudioEnded()},i}i.WebAudioPlayer=t},{"./WebAudioHelper":80,"@akashic/akashic-engine":2}],82:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioPlugin=void 0;var s=t("./WebAudioAsset"),r=t("./WebAudioPlayer"),o=t("./WebAudioAutoplayHelper");function n(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}n.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(n.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,s.WebAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),n.prototype.createAsset=function(t,e,i,r,o,n){return new s.WebAudioAsset(t,e,i,r,o,n)},n.prototype.createPlayer=function(t,e){return new r.WebAudioPlayer(t,e)},n.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},i.WebAudioPlugin=n},{"./WebAudioAsset":78,"./WebAudioAutoplayHelper":79,"./WebAudioPlayer":81}],83:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.XHRLoader=void 0;var o=t("@akashic/akashic-engine");function r(t){this.timeout=(t=void 0===t?{}:t).timeout||15e3}r.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},r.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},r.prototype._getRequestObject=function(e,i){var r=new XMLHttpRequest;r.open("GET",e.url,!0),r.responseType=e.responseType,r.timeout=this.timeout,r.addEventListener("timeout",function(){i(o.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),r.addEventListener("load",function(){var t;200<=r.status&&r.status<300?(t="text"===e.responseType?r.responseText:r.response,i(null,t)):i(o.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.addEventListener("error",function(){i(o.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.send()},i.XHRLoader=r},{"@akashic/akashic-engine":2}],84:[function(B,i,r){!function(W,N){!function(){var t,e;t=this,e=function(){"use strict";function h(t){return"function"==typeof t}var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,e=void 0,o=void 0,s=function(t,e){l[r]=t,l[r+1]=e,2===(r+=2)&&(o?o(d):D())};var t="undefined"!=typeof window?window:void 0,n=t||{},n=n.MutationObserver||n.WebKitMutationObserver,a="undefined"==typeof self&&void 0!==W&&"[object process]"==={}.toString.call(W),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function u(){var t=setTimeout;return function(){return t(d,1)}}var l=new Array(1e3);function d(){for(var t=0;t<r;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;r=0}function p(){try{var t=Function("return this")().require("vertx");return void 0!==(e=t.runOnLoop||t.runOnContext)?function(){e(d)}:u()}catch(t){return u()}}var f,_,g,D=void 0;function y(t,e){var i,r=this,o=new this.constructor(T),n=(void 0===o[v]&&O(o),r._state);return n?(i=arguments[n-1],s(function(){return L(n,o,i,r._result)})):k(r,o,t,e),o}function m(t){var e;return t&&"object"==typeof t&&t.constructor===this?t:(E(e=new this(T),t),e)}var D=a?function(){return W.nextTick(d)}:n?(_=0,a=new n(d),g=document.createTextNode(""),a.observe(g,{characterData:!0}),function(){g.data=_=++_%2}):c?((f=new MessageChannel).port1.onmessage=d,function(){return f.port2.postMessage(0)}):(void 0===t&&"function"==typeof B?p:u)(),v=Math.random().toString(36).substring(2);function T(){}var A=void 0,x=1,w=2;function G(t,r,o){s(function(e){var i=!1,t=function(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}(o,r,function(t){i||(i=!0,(r!==t?E:b)(e,t))},function(t){i||(i=!0,P(e,t))},e._label);!i&&t&&(i=!0,P(e,t))},t)}function S(t,e,i){var r,o;e.constructor===t.constructor&&i===y&&e.constructor.resolve===m?(r=t,(o=e)._state===x?b(r,o._result):o._state===w?P(r,o._result):k(o,void 0,function(t){return E(r,t)},function(t){return P(r,t)})):void 0!==i&&h(i)?G(t,e,i):b(t,e)}function E(e,t){if(e===t)P(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof t,null===t||"object"!=i&&"function"!=i)b(e,t);else{i=void 0;try{i=t.then}catch(t){return void P(e,t)}S(e,t,i)}var i}function H(t){t._onerror&&t._onerror(t._result),R(t)}function b(t,e){t._state===A&&(t._result=e,t._state=x,0!==t._subscribers.length&&s(R,t))}function P(t,e){t._state===A&&(t._state=w,t._result=e,s(H,t))}function k(t,e,i,r){var o=t._subscribers,n=o.length;t._onerror=null,o[n]=e,o[n+x]=i,o[n+w]=r,0===n&&t._state&&s(R,t)}function R(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r,o=void 0,n=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+i],r?L(i,r,o,n):o(n);t._subscribers.length=0}}function L(t,e,i,r){var o=h(i),n=void 0,s=void 0,a=!0;if(o){try{n=i(r)}catch(t){a=!1,s=t}if(e===n)return void P(e,new TypeError("A promises callback cannot return that same promise."))}else n=r;e._state===A&&(o&&a?E(e,n):!1===a?P(e,s):t===x?b(e,n):t===w&&P(e,n))}var M=0;function O(t){t[v]=M++,t._state=void 0,t._result=void 0,t._subscribers=[]}C.prototype._enumerate=function(t){for(var e=0;this._state===A&&e<t.length;e++)this._eachEntry(t[e],e)},C.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===m){var o,n=void 0,s=void 0,a=!1;try{n=e.then}catch(t){a=!0,s=t}n===y&&e._state!==A?this._settledAt(e._state,t,e._result):"function"!=typeof n?(this._remaining--,this._result[t]=e):i===F?(o=new i(T),a?P(o,s):S(o,e,n),this._willSettleAt(o,t)):this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},C.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===A&&(this._remaining--,t===w?P(r,i):this._result[e]=i),0===this._remaining&&b(r,this._result)},C.prototype._willSettleAt=function(t,e){var i=this;k(t,void 0,function(t){return i._settledAt(x,e,t)},function(t){return i._settledAt(w,e,t)})};var U=C;function C(t,e){this._instanceConstructor=t,this.promise=new t(T),this.promise[v]||O(this.promise),i(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0!==this.length&&(this.length=this.length||0,this._enumerate(e),0!==this._remaining)||b(this.promise,this._result)):P(this.promise,new Error("Array Methods must be provided an Array"))}I.prototype.catch=function(t){return this.then(null,t)},I.prototype.finally=function(e){var i=this.constructor;return h(e)?this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):this.then(e,e)};var F=I;function I(t){if(this[v]=M++,this._result=this._state=void 0,this._subscribers=[],T!==t){if("function"!=typeof t)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof I))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var e=this;try{t(function(t){E(e,t)},function(t){P(e,t)})}catch(t){P(e,t)}}}return F.prototype.then=y,F.all=function(t){return new U(this,t).promise},F.race=function(o){var n=this;return i(o)?new n(function(t,e){for(var i=o.length,r=0;r<i;r++)n.resolve(o[r]).then(t,e)}):new n(function(t,e){return e(new TypeError("You must pass an array to race."))})},F.resolve=m,F.reject=function(t){var e=new this(T);return P(e,t),e},F._setScheduler=function(t){o=t},F._setAsap=function(t){s=t},F._asap=s,F.polyfill=function(){var t=void 0;if(void 0!==N)t=N;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=F},F.Promise=F},"object"==typeof r&&void 0!==i?i.exports=e():t.ES6Promise=e()}.call(this)}.call(this,B("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}],85:[function(t,e,i){e.exports={gameDriver:t("@akashic/game-driver"),akashicEngine:t("@akashic/akashic-engine"),pdiBrowser:"undefined"!=typeof window?t("@akashic/pdi-browser"):null}},{"@akashic/akashic-engine":2,"@akashic/game-driver":5,"@akashic/pdi-browser":29}]},{},[85])(85)});

	window.engineFiles=engineFilesV2_4_0,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){return"@akashic/akashic-engine"!==i?this.call(this,i):engineFiles.akashicEngine}}();

</script>

<script>
if (! ("optionProps" in window)) {
	window.optionProps = {};
}
window.optionProps.magnify = true

window.g = require("@akashic/akashic-engine");
</script>
<script>
if (! ("gLocalAssetContainer" in window)) {
	window.gLocalAssetContainer = {};
}

if (! ("__akashic__" in window)) {
	window.__akashic__ = {};
}


	
		window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 640,%0A%09%22height%22: 360,%0A%09%22fps%22: 30,%0A%09%22main%22: %22./script/_bootstrap.js%22,%0A%09%22assets%22: {%0A%09%09%22player%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 32,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22files/2f2f2684fcf72b481d95.png%22,%0A%09%09%09%22virtualPath%22: %22image/player.png%22%0A%09%09},%0A%09%09%22shot%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 16,%0A%09%09%09%22height%22: 16,%0A%09%09%09%22path%22: %22files/509c2bdd6ceeb49065ac.png%22,%0A%09%09%09%22virtualPath%22: %22image/shot.png%22%0A%09%09},%0A%09%09%22se%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/aea88cd01152840e6725%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 250,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22extensions%22: [%0A%09%09%09%09%09%22.aac%22,%0A%09%09%09%09%09%22.ogg%22%0A%09%09%09%09]%0A%09%09%09},%0A%09%09%09%22virtualPath%22: %22audio/se%22%0A%09%09},%0A%09%09%22main%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/0d75bfc2cf044a49e7a9.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/main.js%22%0A%09%09},%0A%09%09%22parameterObject%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/f69efd9b51d31d911da0.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/parameterObject.js%22%0A%09%09},%0A%09%09%22_bootstrap%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/1b69b90133980bf57115.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/_bootstrap.js%22%0A%09%09},%0A%09%09%22TT%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/03d3d2a1dee2c12cb6de.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/TT.js%22%0A%09%09},%0A%09%09%22BaseEnttity%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/fd641ed446b67dddf501.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/BaseEnttity.js%22%0A%09%09},%0A%09%09%22BG%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/44af051e9331183934e7.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/BG.js%22%0A%09%09},%0A%09%09%22End%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/1fa47a4cf23d51e92e15.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/End.js%22%0A%09%09},%0A%09%09%22info%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/f9adf55860a051d7d7bb.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/info.js%22%0A%09%09},%0A%09%09%22Mogura%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/01f37a51f259c5409b65.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/Mogura.js%22%0A%09%09},%0A%09%09%22Score%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/6c75d56f93ec3b8efad4.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/Score.js%22%0A%09%09},%0A%09%09%22Timer%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/de14ff0ff2c4a6dd22ad.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/Timer.js%22%0A%09%09},%0A%09%09%22Title%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/d50cb3ac3133e99a6d5b.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Entity/Title.js%22%0A%09%09},%0A%09%09%22Mograkanri%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/4b273c2da13b0fcb61d3.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Kanri/Mograkanri.js%22%0A%09%09},%0A%09%09%22MGScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/08a2f5ad630d76df3417.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Scene/MGScene.js%22%0A%09%09},%0A%09%09%22SceneBase%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/ee320eb73e07a4079abf.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Scene/SceneBase.js%22%0A%09%09},%0A%09%09%22SceneBaseFact%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/7c0a854240ef1a970726.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Scene/SceneBaseFact.js%22%0A%09%09},%0A%09%09%22StateMogura%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/bf28b9cf7a8afb63a1c5.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/State/StateMogura.js%22%0A%09%09},%0A%09%09%22hit%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/3e3abd58e8bd29f7493d%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1123,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22extensions%22: [%0A%09%09%09%09%09%22.ogg%22%0A%09%09%09%09]%0A%09%09%09},%0A%09%09%09%22virtualPath%22: %22audio/hit%22%0A%09%09},%0A%09%09%22miss%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/67db637a193974f48e81%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 1243,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22extensions%22: [%0A%09%09%09%09%09%22.ogg%22%0A%09%09%09%09]%0A%09%09%09},%0A%09%09%09%22virtualPath%22: %22audio/miss%22%0A%09%09},%0A%09%09%22bgm%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/6e6ed82de3ca7cdfa409%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22duration%22: 94668,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22extensions%22: [%0A%09%09%09%09%09%22.ogg%22%0A%09%09%09%09]%0A%09%09%09},%0A%09%09%09%22virtualPath%22: %22audio/bgm%22%0A%09%09},%0A%09%09%22ana%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 112,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22path%22: %22files/c9cc249781f0d312b566.png%22,%0A%09%09%09%22virtualPath%22: %22image/ana.png%22%0A%09%09},%0A%09%09%22bg%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 640,%0A%09%09%09%22height%22: 340,%0A%09%09%09%22path%22: %22files/de3cd472a1a62597df66.png%22,%0A%09%09%09%22virtualPath%22: %22image/bg.png%22%0A%09%09},%0A%09%09%22bg1%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 640,%0A%09%09%09%22height%22: 340,%0A%09%09%09%22path%22: %22files/7b1dfa48105667cd27c1.png%22,%0A%09%09%09%22virtualPath%22: %22image/bg1.png%22%0A%09%09},%0A%09%09%22font%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 1024,%0A%09%09%09%22height%22: 836,%0A%09%09%09%22path%22: %22files/92a16d7da675ebcfa7d3.png%22,%0A%09%09%09%22virtualPath%22: %22image/font.png%22%0A%09%09},%0A%09%09%22gameend%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 640,%0A%09%09%09%22height%22: 340,%0A%09%09%09%22path%22: %22files/396296e171bc1dd13abd.png%22,%0A%09%09%09%22virtualPath%22: %22image/gameend.png%22%0A%09%09},%0A%09%09%22moguraall%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 224,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22path%22: %22files/1a312b2db538513e0bfe.png%22,%0A%09%09%09%22virtualPath%22: %22image/moguraall.png%22%0A%09%09},%0A%09%09%22moguraallb%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 224,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22path%22: %22files/0eb089819c63fe1620e6.png%22,%0A%09%09%09%22virtualPath%22: %22image/moguraallb.png%22%0A%09%09},%0A%09%09%22moguraallr%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 216,%0A%09%09%09%22height%22: 86,%0A%09%09%09%22path%22: %22files/77f0401ea9db0dc1737c.png%22,%0A%09%09%09%22virtualPath%22: %22image/moguraallr.png%22%0A%09%09},%0A%09%09%22titile%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 640,%0A%09%09%09%22height%22: 340,%0A%09%09%09%22path%22: %22files/22197e4d356a88dfe743.png%22,%0A%09%09%09%22virtualPath%22: %22image/titile.png%22%0A%09%09},%0A%09%09%22JScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/7a7b15553d7d538d82f3.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/Scene/JScene.js%22%0A%09%09},%0A%09%09%22font_glyphs%22: {%0A%09%09%09%22type%22: %22text%22,%0A%09%09%09%22path%22: %22files/12bc36e7826e5e4f40b7.json%22,%0A%09%09%09%22virtualPath%22: %22text/font_glyphs.json%22%0A%09%09},%0A%09%09%22moguraSetumei%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 640,%0A%09%09%09%22height%22: 340,%0A%09%09%09%22path%22: %22files/57c611f2c67ae23bdc5b.png%22,%0A%09%09%09%22virtualPath%22: %22image/moguraSetumei.png%22%0A%09%09},%0A%09%09%22hajime%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 640,%0A%09%09%09%22height%22: 360,%0A%09%09%09%22path%22: %22files/173f3a97f45e96fa46c5.png%22,%0A%09%09%09%22virtualPath%22: %22image/hajime.png%22%0A%09%09},%0A%09%09%22a_e_z_0%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-timeline/lib/ActionType.js%22,%0A%09%09%09%22path%22: %22files/de8ad5c8151654efac08.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_1%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-timeline/lib/Easing.js%22,%0A%09%09%09%22path%22: %22files/d5482d461250ecf959ce.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_2%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-timeline/lib/Timeline.js%22,%0A%09%09%09%22path%22: %22files/ae5c3c77e7867c76a98a.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_3%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-timeline/lib/Tween.js%22,%0A%09%09%09%22path%22: %22files/d91579f8774c365656b0.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_4%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-timeline/lib/index.js%22,%0A%09%09%09%22path%22: %22files/71be84f828c4e87c8c02.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_5%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/DefaultRubyParser.js%22,%0A%09%09%09%22path%22: %22files/5ca3e0f76f4c8d5a4c2d.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_6%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/FragmentDrawInfo.js%22,%0A%09%09%09%22path%22: %22files/b3d7e16f3880a06f8cba.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_7%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/Label.js%22,%0A%09%09%09%22path%22: %22files/a9e42080a473e9994132.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_8%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/RubyParser.js%22,%0A%09%09%09%22path%22: %22files/ef280c38139b1cd8ade0.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_9%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-label/lib/index.js%22,%0A%09%09%09%22path%22: %22files/62b1bd9a4502ffc92903.js%22,%0A%09%09%09%22global%22: true%0A%09%09}%0A%09},%0A%09%22moduleMainScripts%22: {%0A%09%09%22@akashic-extension/akashic-timeline%22: %22node_modules/@akashic-extension/akashic-timeline/lib/index.js%22,%0A%09%09%22@akashic-extension/akashic-label%22: %22node_modules/@akashic-extension/akashic-label/lib/index.js%22%0A%09},%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %222%22,%0A%09%09%22niconico%22: {%0A%09%09%09%22supportedModes%22: [%0A%09%09%09%09%22ranking%22%0A%09%09%09],%0A%09%09%09%22preferredSessionParameters%22: {%0A%09%09%09%09%22totalTimeLimit%22: 110%0A%09%09%09}%0A%09%09}%0A%09},%0A%09%22globalScripts%22: []%0A}";
	

	
		window.gLocalAssetContainer["main"] = function(g) {
			!function(e,a){Object.defineProperty(e,"__esModule",{value:!0});var m=a("./Scene/MGScene");e.main=function(e){var a=new m.Yyy3(e),i=a.scene;a.time=100,e.sessionParameter.totalTimeLimit&&e.sessionParameter.totalTimeLimit,g.game.vars.gameState={score:0},g.game.pushScene(i)}}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["parameterObject"] = function(g) {
			!function(e){Object.defineProperty(e,"__esModule",{value:!0})}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["_bootstrap"] = function(g) {
			!function(e,a){var r=e("./main");a.exports=function(a){var n={},d=(Object.keys(a).forEach(function(e){n[e]=a[e]}),n.sessionParameter={},n.isAtsumaru="undefined"!=typeof window&&void 0!==window.RPGAtsumaru,n.random=g.game.random,new g.Scene({game:g.game}));d.message.add(function(e){e.data&&"start"===e.data.type&&e.data.parameters&&(n.sessionParameter=e.data.parameters,null!=e.data.parameters.randomSeed&&(n.random=new g.XorshiftRandomGenerator(e.data.parameters.randomSeed)),g.game.popScene(),r.main(n))}),d.loaded.add(function(){var e=0;d.update.add(function(){3<++e&&(g.game.popScene(),r.main(n))})}),g.game.pushScene(d)}}((g.module.exports,g.module.require),g.module,(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["TT"] = function(g) {
			!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Test1=function(){this.makeScene=function(){return new g.Scene({game:g.game,assetIds:["player","shot","se"]})}}}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["BaseEnttity"] = function(g) {
			!function(e){function t(e){this._scene=e,this._BaseEsp=new g.E(e)}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(t.prototype,"BaseEsp",{get:function(){return this._BaseEsp},enumerable:!0,configurable:!0}),t.prototype.addSP2Scene=function(e){e.append(this.BaseEsp)},t.prototype.init=function(){this._BaseEsp=this.makeEnt(),this.spInit()},e.BaseEntity=t}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["BG"] = function(g) {
			!function(t,e){var n,i,s=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=(Object.defineProperty(t,"__esModule",{value:!0}),e("./BaseEnttity")),p=e("@akashic-extension/akashic-timeline"),e=(i=o.BaseEntity,s(c,i),c.prototype.init=function(){this.bGsp=this.makeEnt(),this.BaseEsp.append(this.bGsp)},c.prototype.spInit=function(){},c.prototype.makeEnt=function(){this._scene.scene;return this.bGsp=this._scene.makeSprite("bg"),this.bGsp1=this._scene.makeSprite("bg1"),this.bGsp1.opacity=0,this.bGsp.append(this.bGsp1),this.bGsp},c.prototype.update=function(){},c.prototype.gameInit=function(){this.bGsp1.opacity=0,this.bGsp1.modified()},c.prototype.cngBg=function(){this._scene.scene;this.tmineline=new p.Timeline(this._scene.scene),this.tmineline.create(this.bGsp1).to({opacity:1},1e3)},c.prototype.takeSceneFromMess=function(){},c);function c(t){var e=i.call(this,t)||this;return e._scene=t,e.init(),e}t.Bg=e}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["End"] = function(g) {
			!function(t,e){var o,n,i=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),e=(Object.defineProperty(t,"__esModule",{value:!0}),e("./BaseEnttity")),e=(n=e.BaseEntity,i(r,n),r.prototype.update=function(){},r.prototype.spInit=function(){},r.prototype.makeEnt=function(){this._scene.scene;return this.endSp=this._scene.makeSprite("gameend"),this.BaseEsp.append(this.endSp),this.BaseEsp},r.prototype.takeSceneFromMess=function(t){},r);function r(t){var e=n.call(this,t)||this;return e._scene=t,e.init(),e}t.End=e}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["info"] = function(g) {
			!function(t,e){var o,n,i=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),e=(Object.defineProperty(t,"__esModule",{value:!0}),e("./BaseEnttity")),e=(n=e.BaseEntity,i(a,n),a.prototype.update=function(){this._labal.text=this.infotext,this._labal.invalidate()},a.prototype.makeEnt=function(){return this._labal=this._scene.makelabel2(),this._labal.text="",this._labal.fontSize=36,this._labal.textColor="yellow",this._labal.x=300,this._labal.y=3,this._labal.invalidate(),this._labal},a.prototype.spInit=function(){},a.prototype.takeSceneFromMess=function(t){},a);function a(t){var e=n.call(this,t)||this;return e._scene=t,e.infotext="",e.getscHand=function(t){return e.setInfoText(t)},e.setInfoText=function(t){e.infotext=t},e.gameInit=function(){e._labal.text=""},e._labal=e.makeEnt(),e.init(),e}t.Info=e}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["Mogura"] = function(g) {
			!function(i,t){var n,o,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=(Object.defineProperty(i,"__esModule",{value:!0}),t("./BaseEnttity")),m=t("@akashic-extension/akashic-timeline"),s=!0,t=(i._mogState={waiting:"steteWaiting",living:"stateLiveing",dead:"stateDead"},i._Now_or_Next={Now:"now",Next:"next"},o=r.BaseEntity,e(a,o),a.prototype.getMogState=function(t){return t||t!==i._Now_or_Next.Now?this._nextStateStr:this._nowStateStr},Object.defineProperty(a.prototype,"prm",{get:function(){return this._prm},set:function(t){this._prm=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isHit",{get:function(){return this._isHit},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isColChkOk",{get:function(){return this._isColChkOk},enumerable:!0,configurable:!0}),a.prototype.getNxetFnc=function(t){return this.state[t]},a.prototype.hit=function(){this._scene.scene.assets.hit.play(),this.mogSp.frameNumber=1,this.mogSp.modified()},a.prototype.makeEnt=function(){var t=this._scene.scene;return this.mogSpArr[0]=new g.FrameSprite({scene:t,src:t.assets.moguraall,width:112,height:96,srcWidth:112,srcHeight:96,frames:[0,1],frameNumber:0}),this.mogSpArr[1]=this.mogSpArr[0],this.mogSpArr[2]=new g.FrameSprite({scene:t,src:t.assets.moguraallb,width:112,height:96,srcWidth:112,srcHeight:96,frames:[0,1],frameNumber:0}),this.mogSpArr[3]=new g.FrameSprite({scene:t,src:t.assets.moguraallr,width:112,height:96,srcWidth:112,srcHeight:96,frames:[0,1],frameNumber:0}),this.mogSp=this.mogSpArr[0],this.paneSp=new g.Pane({scene:t,width:112,height:90}),this.paneSp.append(this.mogSp),this.anaSp=new g.Sprite({scene:t,src:t.assets.ana,width:112,height:96}),this.mogSp.hide(),this.paneSp.append(this.anaSp),this.paneSp},a.prototype.spInit=function(){var t=this.BaseEsp;t.x=this._holePoint[this._holeNum].x,t.y=this._holePoint[this._holeNum].y},a.prototype.spShow=function(){this.mogSp.show()},a.prototype.spHide=function(){this.mogSp.hide()},a.prototype.update=function(){this._nextStateStr!==this._nowStateStr&&(this._nowStateStr=this._nextStateStr,this.updateK=this.state[this._nowStateStr]()),this.updateK()},a.prototype.gameInit=function(){this.mogSp.frameNumber=1,this._nextStateStr=i._mogState.waiting,this.isTachiE=!1},a.prototype.takeSceneFromMess=function(t){this._nowStateStr=t.str},a.prototype.setHolnumber=function(t){this._holeNum=t,this.spInit()},a.prototype.setOuttingKyoka=function(t){this.isHoleoutOk=t},a.prototype.getisHoloutOk=function(){return this.isHoleoutOk},a);function a(t,e){var a=o.call(this,t)||this;return a._scene=t,a.myentMakeOder={assetName:"ana",useCount:1,assetSP:null},a.mogSpArr=[],a._nowStateStr=i._mogState.waiting,a._nextStateStr=null,a._holeNum=0,a._holePoint=[{x:50,y:25},{x:300,y:20},{x:420,y:40},{x:80,y:130},{x:210,y:155},{x:500,y:150},{x:110,y:230},{x:310,y:220},{x:450,y:240}],a.isNowHoleIn=s,a.isTachiE=!1,a.isHoleOutting=!1,a.isTimeoutMachi=!1,a.isHoleoutOk=!1,a.holeouttime=100,a.wtime=30,a.state={steteWaiting:function(){return a.stateWaiting()},stateLiveing:function(){return a.stateLiveing()},stateDead:function(){return a.stateDead()}},a._myev=null,a._setSc=null,a._setSCnoHit=null,a._isColChkOk=!1,a._isSurvivor={isArrow:!1},a._prm={HoleOutKakuritu:90,OuttingTime:3e3,wait:400,id:0},a._isHit=!1,a._hitSendPrm=null,a._isSurvivFnc=null,a.suvAdd=function(t){a._isSurvivFnc=t},a.stateWaiting=function(){return a.mogSp.x=0,a.mogSp.y=0,a.mogSp.angle=0,a.isTachiE=!1,a.isHoleoutOk=!1,a.mogSp.frameNumber=0,a.mogSp.hide(),a.mogSp.modified(),a._nextStateStr=i._mogState.waiting,function(){a._isColChkOk=!1;var t=100*g.game.random.generate()>a.prm.HoleOutKakuritu;a.isHoleoutOk&&t&&(a._nextStateStr=i._mogState.living)}},a.stateLiveing=function(){a._nextStateStr=i._mogState.living;var e=a.move1();return a.isTachiE=!1,a._isColChkOk=!1,a.mogSpInit(),function(){if(e(),a.isTachiE&&a._isColChkOk){var t={holeNum:a._holeNum,tpid:a._prm.id,isSurviv:void 0};if(a._isHit=a.coli(),a._isHit){switch(a.isTachiE=!1,a.prm.id){case 0:a.sendTokuten(1e5);break;case 1:a.sendTokuten(10);break;case 2:a.sendTokuten(20);break;case 3:a.sendTokuten(50)}t.isSurviv=!1,a._isSurvivFnc&&a._isSurvivFnc.survivorHandl(t),a._setSCnoHit&&a._setSCnoHit(!0,a._holeNum),a._nextStateStr=i._mogState.dead}else a._setSCnoHit&&a._setSCnoHit(!1,a._holeNum),a.isTachiE=!1}else a.isTachiE=!1}},a.move1=function(){function o(){var t={holeNum:a._holeNum,tpid:a._prm.id,isSurviv:!0};a._isSurvivFnc&&a._isSurvivFnc.survivorHandl(t),a._isColChkOk=!1,a.mogSp.frameNumber=0,a.mogSp.hide(),a.mogSp.modified(),a._nextStateStr=i._mogState.waiting}var e=function(){var t=a._scene.scene,t=(a.timeline=new m.Timeline(t),a.mogSp.height),e=2*Math.floor(a.prm.OuttingTime/3),i=a.prm.OuttingTime-e,n=15<Math.floor(100*g.game.random.generate())?0:Math.floor(t/2-10);a.mogSp.y=t-30,a.timeline.create(a.mogSp).moveTo(0,n,e,m.Easing.easeInOutExpo).moveTo(0,t,i,m.Easing.easeInExpo),a._isColChkOk=!0,a.mogSp.frameNumber=0,a.mogSp.show(),a.mogSp.modified(),a._scene.scene.setTimeout(a.prm.OuttingTime,function(){s=o}),s=r},r=function(){},s=function(){a._isColChkOk=!1,a.mogSp.frameNumber=0,a.mogSp.hide(),a.mogSp.modified();var t=a._scene.scene;a.anaTimeline=new m.Timeline(t),a.anaTimeline.create(a.anaSp,{loop:!0}).rotateBy(8,50).rotateBy(-8,50),a._scene.scene.setTimeout(function(){a.anaTimeline.destroy(),a.anaSp.angle=0,s=e},a.prm.wait),s=r};return function(){s()}},a.stateDead=function(){var t=0;a._nextStateStr=i._mogState.dead,a._scene.scene;return a.timeline.cancelAll(),a.timeline.create(a.mogSp,{loop:!0}).rotateBy(8,50).rotateBy(-8,50),function(){switch(t){case 0:a.hit(),t=2,a._scene.scene.setTimeout(180,function(){a.timeline.cancelAll(),t=1});break;case 1:a._nextStateStr=i._mogState.waiting}}},a.mogSpInit=function(){a.paneSp.remove(a.mogSp),a.mogSp=a.mogSpArr[a.prm.id],a.paneSp.insertBefore(a.mogSp,a.anaSp),a.mogSp.x=0,a.mogSp.y=0,a.mogSp.angle=0,a.mogSp.frameNumber=0,a.mogSp.hide(),a.mogSp.modified()},a.coli=function(){var t=a._myev;return a.iscoli(t)},a.tochiE=function(t){a._myev=t,a.isTachiE=!0},a.iscoli=function(t){var e=a.mogSp.width,i=a.anaSp.height,n=a.BaseEsp.x,o=a.BaseEsp.y;return n<t.point.x&&n+e>t.point.x&&o+a.mogSp.y<t.point.y&&o+i-20>t.point.y?!(a.isTachiE=!1):a.isTachiE=!1},a.sendTokuten=function(t){},a.setScFnc=function(t,e){e?a._setSCnoHit=t:a._setSc=t},a.getColiAria=function(){var t=a.paneSp.y,e=t+a.paneSp.height;a.mogSp.y;return{leftX:a.mogSp.x,wight:a.mogSp.x+a.mogSp.width,topY:t+a.mogSp.y,hight:e}},a.imogkanri=e,a.suvAdd(e),a.init(),a.updateK=a.stateWaiting(),a}i.Mogura=t}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["Score"] = function(g) {
			!function(t,e){var o,a,s=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},function(t,e){function a(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}),e=(Object.defineProperty(t,"__esModule",{value:!0}),e("./BaseEnttity")),e=(a=e.BaseEntity,s(i,a),i.prototype.update=function(){this._labal.text="SCORE: "+this._score,this._labal.invalidate(),this._labal2.text="SCORE: "+this._score,this._labal2.invalidate()},i.prototype.spInit=function(){},i.prototype.makeEnt=function(){return this._labal=this._scene.makelabel2(),this._labal.text="SCORE: "+this._score,this._labal.fontSize=36,this._labal.textColor="white",this._labal.x=-2,this._labal.y=-2,this._labal2=this._scene.makelabel2(),this._labal2.text="SCORE: "+this._score,this._labal2.fontSize=36,this._labal2.textColor="darkslategray",this._labal2.append(this._labal),this._labal2.invalidate(),this._labal.invalidate(),this._labal2},i.prototype.takeSceneFromMess=function(t){},i.prototype.setXY=function(t){this._labal2.x=t.x,this._labal2.y=t.y},i.prototype.gameInit=function(){this._score=0,g.game.vars.gameState.score=this._score,this.update()},i);function i(t){var e=a.call(this,t)||this;return e._scene=t,e._score=0,e.getscHand=function(t){return e.setTokuten(t)},e.setTokuten=function(t){e._score+=t,e._score=Math.max(e._score,0),g.game.vars.gameState.score=e._score},e.init(),e._score=0,e._scoreTxt=String(e._score),e._scHand=e.setTokuten,e}t.Score=e}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["Timer"] = function(g) {
			!function(t,e){var i,n,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),e=(Object.defineProperty(t,"__esModule",{value:!0}),e("./BaseEnttity")),e=(n=e.BaseEntity,o(r,n),Object.defineProperty(r.prototype,"timeUp",{get:function(){return this._istimeUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"timeclearid",{get:function(){return this.timeClearid},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tcont",{set:function(t){this._tcont=90},enumerable:!0,configurable:!0}),r.prototype.gameInit=function(){this._istimeUp=!1,this._tcont=90,this._labal.text=String(this._tcont),this._labal.textColor="blue",this._labal.invalidate()},r.prototype.update=function(){this._tcont--,this._tcont<0?(this._tcont=0,this._istimeUp=!0,null!=this.timeClearid&&this._scene.scene.clearInterval(this.timeClearid)):(this._labal.text=String(this._tcont),this._labal.invalidate())},r.prototype.spInit=function(){},r.prototype.makeEnt=function(){return this._labal=this._scene.makelabel2(),this._labal.text=String(this._tcont),this._labal.invalidate(),this._labal},r.prototype.timeoutadd=function(t,e){this.timeoutFnc[e]=t},r.prototype.setXY=function(t){this._labal.x=t.x,this._labal.y=t.y},r.prototype.takeSceneFromMess=function(){},r.prototype.colorCh=function(t){this._labal.textColor=t},r.prototype.setTimerInterval=function(){var t=this,e=this._scene.scene.setInterval(1e3,function(){t.update()});return this._scene.scene.setTimeout(function(){t.colorCh("Yellow")},6e4),this._scene.scene.setTimeout(function(){t.colorCh("Red")},8e4),e},r);function r(t){var e=n.call(this,t)||this;return e._scene=t,e._istimeUp=!1,e._tcont=90,e.timeoutFnc=[],e.start=function(){e._tcont=90,e._labal.invalidate(),e.timeClearid=e._scene.scene.setInterval(1e3,function(){e.update()}),e._scene.scene.setTimeout(function(){e.colorCh("Yellow")},6e4),e._scene.scene.setTimeout(function(){e.colorCh("Red")},8e4)},e.timerInit=function(){},e.timeup2add=function(t){e.finish=t},e.init(),e}t.Timer=e}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["Title"] = function(g) {
			!function(e,t){var s,i,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=(Object.defineProperty(e,"__esModule",{value:!0}),t("./BaseEnttity")),a=t("@akashic-extension/akashic-timeline"),p=t("@akashic-extension/akashic-timeline/lib/Easing"),t=(i=o.BaseEntity,n(c,i),c.prototype.start=function(){this.timeline=new a.Timeline(this.sc),this.BaseEsp.scale(0);this.BaseEsp.width,this.BaseEsp.height;this.BaseEsp.moveTo(320,120),this.BaseEsp.anchor(.5,.5),this.BaseEsp.modified(),this.timeline.create(this.BaseEsp).scaleTo(1,1,500,p.easeOutSine).con().moveTo(0,0,500,p.easeOutSine).every(function(){},300).call(this.chSp).fadeIn(4500)},c.prototype.gameinit=function(){},c.prototype.update=function(){},c.prototype.spInit=function(){},c.prototype.makeEnt=function(){var e=this._scene.scene;return this.damyE=new g.E({scene:e}),this.rectS=new g.FilledRect({scene:e,cssColor:"brack",width:640,height:340}),this.rectS.opacity=.6,this.damyE.append(this.rectS),this.setumeiSp=this._scene.makeSprite("moguraSetumei"),this.titileSp=this._scene.makeSprite("titile"),this.damyE.append(this.setumeiSp),this.BaseEsp.append(this.titileSp),this.BaseEsp},c.prototype.takeSceneFromMess=function(e){},c);function c(e){var t=i.call(this,e)||this;return t._scene=e,t.chSp=function(){t.BaseEsp.remove(t.titileSp),t.BaseEsp.append(t.damyE)},t.sc=e.scene,t.init(),t}e.Title=t}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["Mograkanri"] = function(g) {
			!function(t,e){Object.defineProperty(t,"__esModule",{value:!0});var s=e("../Entity/Mogura"),i=e("../Entity/info");function o(t){var n=this;this._scene=t,this.stLevel_adv=[{maxAct:1,arrImogLvRate:[{type:0,ratePar:100}]},{maxAct:2,arrImogLvRate:[{type:0,ratePar:100}]},{maxAct:4,arrImogLvRate:[{type:0,ratePar:95},{type:1,ratePar:5}]},{maxAct:2,arrImogLvRate:[{type:0,ratePar:30},{type:1,ratePar:70}]},{maxAct:3,arrImogLvRate:[{type:0,ratePar:45},{type:1,ratePar:40},{type:2,ratePar:15}]},{maxAct:3,arrImogLvRate:[{type:0,ratePar:10},{type:1,ratePar:35},{type:2,ratePar:55}]}],this._mogLevel=[{HoleOutKakuritu:60,OuttingTime:3300,wait:150,id:1},{HoleOutKakuritu:80,OuttingTime:2100,wait:60,id:2},{HoleOutKakuritu:90,OuttingTime:1100,wait:10,id:3}],this._maxMoguraActer=9,this._mogClssArr=[],this._mogOutStanbyState=[],this._mogOutNoState=[],this._mogIsTochOkArr=[],this.timeScheduleList=[],this._isTchEv=!1,this._tcEv=null,this._comb=0,this._tekitoArr=[],this._allNohit=!1,this._scFncTest=null,this._scFncTest2=null,this._suvTokei={total:0,miss:0},this._nowTimeLv=0,this.tmScheduleList=[],this.sc=0,this.totalSuvArr=[],this.sendTokuten=function(t){n.setSc(t)},this.isMogHitArrFnc=function(t,e){n._tekitoArr[e]=t},this.start=function(){n.tmScheduleList=[{setTime:5e3,fncLevel:1},{setTime:8e3,fncLevel:2},{setTime:1e4,fncLevel:4},{setTime:2e4,fncLevel:3},{setTime:35e3,fncLevel:2},{setTime:4e4,fncLevel:4},{setTime:5e4,fncLevel:3},{setTime:65e3,fncLevel:4},{setTime:78e3,fncLevel:5}];for(var t=0;t<n.tmScheduleList.length;t++)!function(t){n._scene.scene.setTimeout(function(){n.nowTimeLv=n.tmScheduleList[t].fncLevel,n._maxMoguraOutting=n.stLevel_adv[n.nowTimeLv].maxAct},n.tmScheduleList[t].setTime)}(t);n._isTchEv=!1},this.strartTset=function(){},this.getMOgState=function(t){for(var e=0;e<n._mogClssArr.length;e++)n._mogClssArr[e].getMogState(),s._mogState.living},this.getMogIsTochOkArr=function(){n._mogIsTochOkArr=[];for(var t=0;n._mogClssArr.length;t++)n._mogClssArr[t].isColChkOk&&n._mogIsTochOkArr.push(n._mogClssArr[t])},this.getOkMogura2=function(){var t=n._mogClssArr.slice(),e=[];e[0]=[],e[1]=[];for(var s=0;s<n._mogClssArr.length;s++)(n._mogClssArr[s].getisHoloutOk()?e[0]:e[1]).push(t[s]);n._mogOutNoState=e[0],n._mogOutStanbyState=e[1]},this.tc=function(t){n._tcEv=t,n._isTchEv=!0;for(var e=0;e<n._mogClssArr.length;e++)n._mogClssArr[e].tochiE(t)},this.createNowMogLevel=function(t){for(var e,s=n.stLevel_adv[n.nowTimeLv].arrImogLvRate,i=n.stLevel_adv[n.nowTimeLv].maxAct,o=(n._maxMoguraOutting=i,Math.floor(100*g.game.random.generate())),a=(s[0].type,0),r=0;;){if(o<(a+=s[r].ratePar))return e=s[r].type,n._mogLevel[e];r++}},this.orgScene=t.scene,this._maxMoguraActer=9,this._maxMoguraOutting=1,this.init()}o.prototype.survivorHandl=function(t){this.totalSuvArr.push(t);var e=t.isSurviv,t=t.tpid;this._suvTokei.total+=1,e?(this._comb=0,this._suvTokei.miss+=1):(this.sc+=0<this._comb?2*[0,10,20,50][t]:[0,10,20,50][t],this.sendTokuten(0<this._comb?2*[0,10,20,50][t]:[0,10,20,50][t]),this._comb+=1,e=Math.floor(this._comb/5),t=50*Math.pow(e,2),this.sc+=t,this.sendTokuten(t))},o.prototype.setScFnc=function(t){this.setSc=t},Object.defineProperty(o.prototype,"nowTimeLv",{get:function(){return this._nowTimeLv},set:function(t){this._nowTimeLv=t,this._maxMoguraOutting=this.stLevel_adv[this._nowTimeLv].maxAct},enumerable:!0,configurable:!0}),o.prototype.init=function(){this.info=new i.Info(this._scene),this.info.addSP2Scene(this._scene.bgly);for(var t=0;t<this._maxMoguraActer;t++)this._mogClssArr[t]=new s.Mogura(this._scene,this),this._mogClssArr[t].setHolnumber(t),this._mogClssArr[t].prm=this._mogLevel[0],this._mogClssArr[t].addSP2Scene(this._scene.chly),this._mogClssArr[t].setScFnc(this.isMogHitArrFnc,"ishit");this._mogOutStanbyState=this._mogClssArr.slice(),this._mogOutNoState=[],this._label=this.makeEnt(),this._scene.scene.append(this._lbInfo),this.gameInit()},o.prototype.gameInit=function(){this.totalSuvArr=[],this.nowTimeLv=0,this.sc=0,this._mogOutStanbyState=this._mogClssArr.slice(),this._mogOutNoState=[],this.getOkMogura2(),this.setHoleOutKyoka2();for(var t=0;t<this._maxMoguraActer;t++)this._mogClssArr[t].gameInit();this.info.gameInit(),this._suvTokei.miss=0,this._suvTokei.total=0},o.prototype.getMogSp=function(){return this._mogClssArr},o.prototype.update=function(){this.getOkMogura2(),this.setHoleOutKyoka2();for(var t,e=0;e<this._maxMoguraActer;e++)this._mogClssArr[e].update();0===this._comb&&this._scFncTest2(""),0!==Object.keys(this._tekitoArr).length?(t=this._tekitoArr.filter(function(t){return!0===t}),0===Object.keys(t).length?(this._scFncTest(-10),this._scFncTest2("Miss!!"),this._comb=0,this.sc=this.sc-10,this._scene.scene.assets.miss.play()):this._scFncTest2("")):this._isTchEv&&(this._scFncTest(-10),this._scFncTest2("Miss!!"),this._comb=0,this.sc=this.sc-10,this.sendTokuten(-10),this._scene.scene.assets.miss.play()),4<this._comb&&this._scFncTest2("COMBO "+this._comb),this._tekitoArr=[],this._isTchEv=!1,this.info.setInfoText(""+this.sc),this.info.update(),this._labalInfo.text=this._suvTokei.total-this._suvTokei.miss+"/"+this._suvTokei.total,this._labalInfo2.text=this._suvTokei.total?Math.round((this._suvTokei.total-this._suvTokei.miss)/this._suvTokei.total*1e3)/10+"%":"",this._labalInfo.invalidate(),this._labalInfo2.invalidate()},o.prototype.setHoleOutKyoka2=function(){for(var t=this._mogOutStanbyState.length-(this._maxMoguraActer-this._maxMoguraOutting),e=this.sortMogArr(this._mogOutStanbyState.slice()),s=[];0<t;)t--,s.push(e.pop()),s[0].setOuttingKyoka(!0),s[0].prm=this.createNowMogLevel(this.nowTimeLv),this._mogOutNoState.push(s.pop());this._mogOutStanbyState=e},o.prototype.sortMogArr=function(t){t.filter(function(t){return t});for(var e=t.length;e;){var s=Math.floor(g.game.random.generate()*e--),i=[t[s],t[e]];t[e]=i[0],t[s]=i[1]}return t},o.prototype.setEvtHit=function(t){var e="live"+String(this._mogOutNoState.length)+":  ",s=this._mogOutNoState.pop();e+=String(this._mogOutNoState.length),this.show(e),s.setOuttingKyoka(!1),this._mogOutStanbyState.push(s)},o.prototype.show=function(t){},o.prototype.makeEnt=function(){return this._label=this._scene.makelabel2(),this._labalInfo=this._scene.makelabel2(),this._labalInfo.text="",this._labalInfo.fontSize=24,this._labalInfo.textColor="white",this._labalInfo.x=0,this._labalInfo.y=0,this._labalInfo.invalidate(),this._labalInfo2=this._scene.makelabel2(),this._labalInfo2.text="",this._labalInfo2.fontSize=24,this._labalInfo2.textColor="white",this._labalInfo2.x=0,this._labalInfo2.y=20,this._labalInfo2.invalidate(),this._lbInfo=new g.E(this._scene),this._lbInfo.x=0,this._lbInfo.y=300,this._lbInfo.append(this._labalInfo),this._lbInfo.append(this._labalInfo2),this._label},t.Mogurakanri=o}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["MGScene"] = function(g) {
			!function(e,t){var a,n,o=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=(Object.defineProperty(e,"__esModule",{value:!0}),t("./SceneBase")),p=t("../Entity/Timer"),d=t("../Kanri/Mograkanri"),y=t("../Entity/BG"),f=t("../Entity/Score"),_=t("../Entity/Title"),b=t("../Entity/End"),S=t("../Entity/info"),t=(n=i.BaseScene,o(r,n),Object.defineProperty(r.prototype,"bgly",{get:function(){return this._bgly},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"chly",{get:function(){return this._chly},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mainly",{get:function(){return this._mainly},enumerable:!0,configurable:!0}),r);function r(e){var l=n.call(this,e)||this;return l.assetIds=["player","shot","se","ana","moguraall","moguraallr","moguraallb","titile","moguraSetumei","hajime","gameend","font","font_glyphs","bg","bg1","hit","miss","bgm"],l.nowMaxMog=3,l.tit=function(){},l.gameloop=function(){},l.end=function(){},l.fsla=function(e){l._mainly=new g.E({scene:l.scene}),l._bgly=new g.E({scene:l.scene}),l._chly=new g.E({scene:l.scene}),l._mainly.append(l._bgly),l._mainly.append(l._chly),l.scene.append(l.mainly);var t,n=l.makeSprite("hajime"),a=new y.Bg(l),o=e,i=new d.Mogurakanri(l),r=new p.Timer(l),c=new S.Info(l),s=new f.Score(l),u=(a.addSP2Scene(l._bgly),r.addSP2Scene(l._bgly),r.setXY({x:570,y:3}),s.addSP2Scene(l._bgly),s.setXY({x:5,y:3}),c.addSP2Scene(l._bgly),i._scFncTest=s.getscHand,i._scFncTest2=c.getscHand,i.setScFnc(s.getscHand),o.pointDownCapture.add(function(e){i.tc(e)}),new _.Title(l)),m=(o.append(u.BaseEsp),new b.End(l));l._gameState.tit=function(){return a.gameInit(),c.gameInit(),u.start(),l.scene.setTimeout(function(){o.remove(u.BaseEsp),l.scene.append(n),l.scene.setTimeout(function(){t=l._gameState.gameloop(),l.scene.remove(n)},300)},6e3),function(){}},l._gameState.gameloop=function(){return r.gameInit(),s.gameInit(),a.gameInit(),r.start(),i.gameInit(),i.start(),l.scene.assets.bgm.play().changeVolume(.3),o.setTimeout(function(){a.cngBg()},8e4),function(){null==r.timeclearid&&r.start(),c.update(),i.update(),s.update(),r.timeUp&&(o.append(m.BaseEsp),t=l._gameState.end())}},l._gameState.end=function(){return l.scene.setTimeout(function(){l.param.isAtsumaru&&window.RPGAtsumaru.experimental.scoreboards.setRecord(1,g.game.vars.gameState.score).then(function(){window.RPGAtsumaru.experimental.scoreboards.display(1)})},800),function(){}},t=l._gameState.tit(),l.scene.update.add(function(){t()})},l.init(),l._gameState={tit:l.tit,gameloop:l.gameloop,end:l.end},l}e.Yyy3=t}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["SceneBase"] = function(g) {
			!function(e,t){Object.defineProperty(e,"__esModule",{value:!0});var n=t("@akashic-extension/akashic-label");function s(e){var n=this;this.param=e,this._game=g.game,this.makelabel2=function(){var e=g.game.scene().assets.font,t=g.game.scene().assets.font_glyphs,t=JSON.parse(t.data),e=new g.BitmapFont({src:e,map:t.map,defaultGlyphWidth:t.width,defaultGlyphHeight:t.height,missingGlyph:t.missingGlyph});return new g.Label({scene:n.scene,font:e,text:String(""),fontSize:64,textColor:"blue",width:180,x:0,y:0})}}Object.defineProperty(s.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),s.prototype.init=function(){this._gameSnario=this.fsla,this.makescene()},s.prototype.makeEntAssetsIdSp=function(){},s.prototype.makeEntSP=function(e){this._scene;return this.makeSprite(e)},s.prototype.makeSprite=function(e){return new g.Sprite({scene:this._scene,src:this._scene.assets[e],width:this._scene.assets[e].width,height:this.scene.assets[e].height})},s.prototype.makeFremSprite=function(){},s.prototype.makeRect=function(){},s.prototype.makeLabel=function(e){var t=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.Serif,size:e||15});return new n.Label({scene:this.scene,font:t,text:String("tttttttttttttttttttttt"),fontSize:e,textColor:"blue",width:180,x:0,y:0})},s.prototype.getSinario=function(){return this.fsla(this._scene)},s.prototype.makescene=function(){return this._scene=new g.Scene({game:this._game,assetIds:this.assetIds}),this.sceneLoadAfter(),this._scene},s.prototype.sceneLoadAfter=function(){var e=this;this._scene.loaded.add(function(){return e.fsla(e._scene)})},e.BaseScene=s}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["SceneBaseFact"] = function(g) {
			!function(e){function t(e,t){var n=this;this._assetIds=e,this._gameSinario=t,this._game=g.game,this.getScene=function(){return n._scene},this.fsla=function(e){},this.makescene()}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},set:function(e){this._scene=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assetIds",{get:function(){return this._assetIds},set:function(e){this._assetIds=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameSinario",{get:function(){return this._gameSinario},set:function(e){this._gameSinario=e},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.makescene()},t.prototype.makescene=function(){var e=this;return this._scene=new g.Scene({game:this._game,assetIds:this._assetIds}),this._scene.loaded.add(function(){return e.fsla(e._scene)}),this._scene},e.SceneFact=t}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["StateMogura"] = function(g) {
			g.module.exports,g.module.require,g.module,g.filename,g.dirname;
		};
	

	
		window.gLocalAssetContainer["JScene"] = function(g) {
			!function(e,t){var o,a,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},function(e,t){function a(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),t=(Object.defineProperty(e,"__esModule",{value:!0}),t("./SceneBase")),t=(a=t.BaseScene,n(i,a),i.prototype.fsla=function(t){var a=this,o=this.makeSprite("player"),e=(o.x=(g.game.width-o.width)/2,o.y=(g.game.height-o.height)/2,o.update.add(function(){o.y=(g.game.height-o.height)/2+10*Math.sin(g.game.age%(10*g.game.fps)/4),o.modified()}),t.append(o),new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.Serif,size:48})),n=new g.Label({scene:t,text:"SCORE: 0",font:e,fontSize:e.size/2,textColor:"black"}),e=(t.append(n),new g.Label({scene:t,text:"TIME: 0",font:e,fontSize:e.size/2,textColor:"black",x:.7*g.game.width})),i=(t.append(e),t.pointDownCapture.add(function(){0<a.time&&(g.game.vars.gameState.score++,n.text="SCORE: "+g.game.vars.gameState.score,n.invalidate()),t.assets.se.play();var e=new g.Sprite({scene:t,src:t.assets.shot,width:t.assets.shot.width,height:t.assets.shot.height});e.x=o.x+o.width,e.y=o.y,e.update.add(function(){e.x>g.game.width&&e.destroy(),e.x+=10,e.modified()}),t.append(e)}),function(){a.time<=0&&(a.param.isAtsumaru&&window.RPGAtsumaru.experimental.scoreboards.setRecord(1,g.game.vars.gameState.score).then(function(){window.RPGAtsumaru.experimental.scoreboards.display(1)}),t.update.remove(i))});t.update.add(i)},i);function i(e){e=a.call(this,e)||this;return e.assetIds=["player","shot","se","ana","moguraall","moguraallr","moguraallb","titile","gameend","font","font_glyphs","bg","bg1","hit","miss","bgm"],e.init(),e}e.JScene=t}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_0"] = function(g) {
			!function(e){"use strict";var l,n;(n=l=l||{})[n.Wait=0]="Wait",n[n.Call=1]="Call",n[n.TweenTo=2]="TweenTo",n[n.TweenBy=3]="TweenBy",n[n.TweenByMult=4]="TweenByMult",n[n.Cue=5]="Cue",n[n.Every=6]="Every",e.exports=l}((g.module.exports,g.module.require,g.module),(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_1"] = function(g) {
			!function(n){"use strict";var t,e;function u(n,t,e,u){return e*(n/=u)*n*n+t}function r(n,t,e,u){return n/=u,e*(--n*n*n+1)+t}function a(n,t,e,u){return(n/=u/2)<1?e/2*n*n*n+t:e/2*((n-=2)*n*n+2)+t}(e=t=t||{}).linear=function(n,t,e,u){return e*n/u+t},e.easeInQuad=function(n,t,e,u){return e*(n/=u)*n+t},e.easeOutQuad=function(n,t,e,u){return-e*(n/=u)*(n-2)+t},e.easeInOutQuad=function(n,t,e,u){return(n/=u/2)<1?e/2*n*n+t:-e/2*(--n*(n-2)-1)+t},e.easeInCubic=u,e.easeInQubic=u,e.easeOutCubic=r,e.easeOutQubic=r,e.easeInOutCubic=a,e.easeInOutQubic=a,e.easeInQuart=function(n,t,e,u){return e*(n/=u)*n*n*n+t},e.easeOutQuart=function(n,t,e,u){return n/=u,-e*(--n*n*n*n-1)+t},e.easeInQuint=function(n,t,e,u){return e*(n/=u)*n*n*n*n+t},e.easeOutQuint=function(n,t,e,u){return n/=u,e*(--n*n*n*n*n+1)+t},e.easeInOutQuint=function(n,t,e,u){return(n/=u/2)<1?e/2*n*n*n*n*n+t:e/2*((n-=2)*n*n*n*n+2)+t},e.easeInSine=function(n,t,e,u){return-e*Math.cos(n/u*(Math.PI/2))+e+t},e.easeOutSine=function(n,t,e,u){return e*Math.sin(n/u*(Math.PI/2))+t},e.easeInOutSine=function(n,t,e,u){return-e/2*(Math.cos(Math.PI*n/u)-1)+t},e.easeInExpo=function(n,t,e,u){return e*Math.pow(2,10*(n/u-1))+t},e.easeInOutExpo=function(n,t,e,u){return(n/=u/2)<1?e/2*Math.pow(2,10*(n-1))+t:(--n,e/2*(2-Math.pow(2,-10*n))+t)},e.easeInCirc=function(n,t,e,u){return n/=u,-e*(Math.sqrt(1-n*n)-1)+t},e.easeOutCirc=function(n,t,e,u){return n/=u,--n,e*Math.sqrt(1-n*n)+t},e.easeInOutCirc=function(n,t,e,u){return(n/=u/2)<1?-e/2*(Math.sqrt(1-n*n)-1)+t:(n-=2,e/2*(Math.sqrt(1-n*n)+1)+t)},n.exports=t}((g.module.exports,g.module.require,g.module),(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_2"] = function(g) {
			!function(e,t){"use strict";var s=e("./Tween");function i(e){this._scene=e,this._tweens=[],this._fps=this._scene.game.fps,this.paused=!1,e.update.add(this._handler,this)}i.prototype.create=function(e,t){e=new s(e,t);return this._tweens.push(e),e},i.prototype.remove=function(e){e=this._tweens.indexOf(e);e<0||this._tweens.splice(e,1)},i.prototype.completeAll=function(){for(var e=0;e<this._tweens.length;++e){var t=this._tweens[e];t.isFinished()||t.complete()}this.clear()},i.prototype.cancelAll=function(e){if(e=void 0!==e&&e)for(var t=0;t<this._tweens.length;++t){var s=this._tweens[t];s.isFinished()||s.cancel(!0)}this.clear()},i.prototype.clear=function(){this._tweens.length=0},i.prototype.destroy=function(){this._tweens.length=0,this._scene.destroyed()||this._scene.update.remove(this._handler,this),this._scene=void 0},i.prototype.destroyed=function(){return void 0===this._scene},i.prototype._handler=function(){if(0!==this._tweens.length&&!this.paused){for(var e=[],t=0;t<this._tweens.length;++t){var s=this._tweens[t];s.isFinished()||(s._fire(1e3/this._fps),e.push(s))}this._tweens=e}},t.exports=i}((g.module.exports,g.module.require),g.module,(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_3"] = function(g) {
			!function(t,e){"use strict";var n=t("./Easing"),l=t("./ActionType");function i(t,e){this._target=t,this._stepIndex=0,this._loop=!!e&&!!e.loop,this._modifiedHandler=void 0,e&&e.modified?this._modifiedHandler=e.modified:t&&t.modified&&(this._modifiedHandler=t.modified),this._destroyedHandler=void 0,e&&e.destroyed?this._destroyedHandler=e.destroyed:t&&t.destroyed&&(this._destroyedHandler=t.destroyed),this._steps=[],this._lastStep=void 0,this._pararel=!1,this._initialProp={},this.paused=!1}i.prototype.to=function(t,e,i){t={input:t,duration:e,easing:i=void 0===i?n.linear:i,type:l.TweenTo,initialized:!1};return this._push(t),this},i.prototype.by=function(t,e,i,s){void 0===i&&(i=n.linear);s=(s=void 0===s?!1:s)?l.TweenByMult:l.TweenBy;return this._push({input:t,duration:e,easing:i,type:s,initialized:!1}),this},i.prototype.con=function(){return this._pararel=!0,this},i.prototype.wait=function(t){t={duration:t,type:l.Wait,initialized:!1};return this._push(t),this},i.prototype.call=function(t){t={func:t,type:l.Call,duration:0,initialized:!1};return this._push(t),this},i.prototype.pause=function(){var t=this;return this.call(function(){t.paused=!0})},i.prototype.cue=function(t){for(var e=Object.keys(t),i=(e.sort(function(t,e){return Number(t)>Number(e)?1:-1}),[]),s=0;s<e.length;++s)i.push({time:Number(e[s]),func:t[e[s]]});var n={type:l.Cue,duration:Number(e[e.length-1]),cue:i,initialized:!1};return this._push(n),this},i.prototype.every=function(t,e,i){void 0===i&&(i=n.linear);t={func:t,type:l.Every,easing:i,duration:e,initialized:!1};return this._push(t),this},i.prototype.fadeIn=function(t,e){return void 0===e&&(e=n.linear),this.to({opacity:1},t,e)},i.prototype.fadeOut=function(t,e){return void 0===e&&(e=n.linear),this.to({opacity:0},t,e)},i.prototype.moveTo=function(t,e,i,s){return void 0===s&&(s=n.linear),this.to({x:t,y:e},i,s)},i.prototype.moveBy=function(t,e,i,s){return void 0===s&&(s=n.linear),this.by({x:t,y:e},i,s)},i.prototype.moveX=function(t,e,i){return void 0===i&&(i=n.linear),this.to({x:t},e,i)},i.prototype.moveY=function(t,e,i){return void 0===i&&(i=n.linear),this.to({y:t},e,i)},i.prototype.rotateTo=function(t,e,i){return void 0===i&&(i=n.linear),this.to({angle:t},e,i)},i.prototype.rotateBy=function(t,e,i){return void 0===i&&(i=n.linear),this.by({angle:t},e,i)},i.prototype.scaleTo=function(t,e,i,s){return void 0===s&&(s=n.linear),this.to({scaleX:t,scaleY:e},i,s)},i.prototype.scaleBy=function(t,e,i,s){return void 0===s&&(s=n.linear),this.by({scaleX:t,scaleY:e},i,s,!0)},i.prototype.complete=function(){for(var t=this._stepIndex;t<this._steps.length;++t)for(var e=0;e<this._steps[t].length;++e){for(var i=this._steps[t][e],s=(i.initialized||this._initAction(i),Object.keys(i.goal)),n=0;n<s.length;++n){var r=s[n];this._target[r]=i.goal[r]}if(i.type===l.Call&&"function"==typeof i.func)i.func.call(this._target);else if(i.type===l.Cue&&i.cue)for(n=0;n<i.cue.length;++n)i.cue[n].func.call(this._target);else i.type===l.Every&&"function"==typeof i.func&&i.func.call(this._target,i.duration,1)}this._stepIndex=this._steps.length,this._loop=!1,this._lastStep=void 0,this._pararel=!1,this.paused=!1,this._modifiedHandler&&this._modifiedHandler.call(this._target)},i.prototype.cancel=function(t){if(t=void 0===t?!1:t)for(var e=Object.keys(this._initialProp),i=0;i<e.length;++i){var s=e[i];this._target[s]=this._initialProp[s]}this._stepIndex=this._steps.length,this._loop=!1,this._lastStep=void 0,this._pararel=!1,this.paused=!1,this._modifiedHandler&&this._modifiedHandler.call(this._target)},i.prototype.isFinished=function(){var t=!1;return t=(t=this._destroyedHandler?this._destroyedHandler.call(this._target):t)||0!==this._stepIndex&&this._stepIndex>=this._steps.length&&!this._loop},i.prototype._fire=function(t){if(0!==this._steps.length&&!this.isFinished()&&!this.paused){if(this._stepIndex>=this._steps.length){if(!this._loop)return;this._stepIndex=0}for(var e=this._steps[this._stepIndex],i=!1,s=0;s<e.length;++s){var n=e[s];if(n.initialized||this._initAction(n),!n.finished){switch(n.elapsed+=t,n.type){case l.Call:n.func.call(this._target);break;case l.Every:var r=n.easing(n.elapsed,0,1,n.duration);1<r&&(r=1),n.func.call(this._target,n.elapsed,r);break;case l.TweenTo:case l.TweenBy:case l.TweenByMult:for(var o=Object.keys(n.goal),a=0;a<o.length;++a){var p=o[a];this._initialProp.hasOwnProperty(p)||(this._initialProp[p]=this._target[p]),n.elapsed>=n.duration?this._target[p]=n.goal[p]:this._target[p]=n.easing(n.elapsed,n.start[p],n.goal[p]-n.start[p],n.duration)}break;case l.Cue:r=n.cue[n.cueIndex];void 0!==r&&n.elapsed>=r.time&&(r.func.call(this._target),++n.cueIndex)}this._modifiedHandler&&this._modifiedHandler.call(this._target),n.elapsed>=n.duration?n.finished=!0:i=!0}}if(!i){for(var h=0;h<e.length;++h)e[h].initialized=!1;++this._stepIndex}}},i.prototype.serializeState=function(){for(var t={_stepIndex:this._stepIndex,_initialProp:this._initialProp,_steps:[]},e=0;e<this._steps.length;++e){t._steps[e]=[];for(var i=0;i<this._steps[e].length;++i)t._steps[e][i]={input:this._steps[e][i].input,start:this._steps[e][i].start,goal:this._steps[e][i].goal,duration:this._steps[e][i].duration,elapsed:this._steps[e][i].elapsed,type:this._steps[e][i].type,cueIndex:this._steps[e][i].cueIndex,initialized:this._steps[e][i].initialized,finished:this._steps[e][i].finished}}return t},i.prototype.deserializeState=function(t){this._stepIndex=t._stepIndex,this._initialProp=t._initialProp;for(var e=0;e<t._steps.length;++e)for(var i=0;i<t._steps[e].length;++i)t._steps[e][i]&&this._steps[e][i]&&(this._steps[e][i].input=t._steps[e][i].input,this._steps[e][i].start=t._steps[e][i].start,this._steps[e][i].goal=t._steps[e][i].goal,this._steps[e][i].duration=t._steps[e][i].duration,this._steps[e][i].elapsed=t._steps[e][i].elapsed,this._steps[e][i].type=t._steps[e][i].type,this._steps[e][i].cueIndex=t._steps[e][i].cueIndex,this._steps[e][i].initialized=t._steps[e][i].initialized,this._steps[e][i].finished=t._steps[e][i].finished)},i.prototype._push=function(t){this._pararel?this._lastStep.push(t):(t=this._steps.push([t])-1,this._lastStep=this._steps[t]),this._pararel=!1},i.prototype._initAction=function(t){if(t.elapsed=0,t.start={},t.goal={},t.cueIndex=0,t.finished=!1,t.initialized=!0,t.type===l.TweenTo||t.type===l.TweenBy||t.type===l.TweenByMult)for(var e=Object.keys(t.input),i=0;i<e.length;++i){var s=e[i];void 0!==this._target[s]&&(t.start[s]=this._target[s],t.type===l.TweenTo?t.goal[s]=t.input[s]:t.type===l.TweenBy?t.goal[s]=t.start[s]+t.input[s]:t.type===l.TweenByMult&&(t.goal[s]=t.start[s]*t.input[s]))}},e.exports=i}((g.module.exports,g.module.require),g.module,(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_4"] = function(g) {
			!function(e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Timeline=i("./Timeline"),e.Tween=i("./Tween"),e.Easing=i("./Easing")}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_5"] = function(g) {
			!function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse=function(e){for(var r=/^((?:[^\\{]|\\+.)*?)({(?:[^\\}]|\\+.)*?})([\s\S]*)/,a=[];0<e.length;){var t=e.match(r);if(null===t){a.push(e.replace(/\\{/g,"{").replace(/\\}/g,"}"));break}var p=t[1],l=t[2],t=(e=t[3],0<p.length&&a.push(p.replace(/\\{/g,"{").replace(/\\}/g,"}")),JSON.parse(l.replace(/\\/g,"\\\\")));if(!t.hasOwnProperty("rt")||!t.hasOwnProperty("rb"))throw g.ExceptionFactory.createTypeMismatchError("parse","RubyFragment");t.rt=t.rt.replace(/\\{/g,"{").replace(/\\}/g,"}"),t.rb=t.rb.replace(/\\{/g,"{").replace(/\\}/g,"}"),t.text=l,a.push(t)}return a}}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_6"] = function(g) {
			!function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(t,i,e,h,s,r){this.text=t.text,this.fragment=t,this.width=i,this.rbWidth=e,this.rtWidth=h,this.glyphs=s,this.rubyGlyphs=r}t.StringDrawInfo=function(t,i,e){this.text=t,this.width=i,this.glyphs=e};t.RubyFragmentDrawInfo=i}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_7"] = function(g) {
			!function(t,e){"use strict";var r,i,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=t("./RubyParser"),l=t("./FragmentDrawInfo"),o=t("./DefaultRubyParser"),t=(i=g.CacheableE,n(s,i),s.prototype.invalidate=function(){this._invalidateSelf(),i.prototype.invalidate.call(this)},s.prototype.renderCache=function(t){if(this.rubyEnabled||0!==this.fontSize){t.save();for(var e=0,i=0;i<this._lines.length;++i)0<this._lines[i].width&&0<this._lines[i].height&&t.drawImage(this._lines[i].surface,0,0,this._lines[i].width,this._lines[i].height,this._offsetX(this._lines[i].width),e),e+=this._lines[i].height+this.lineGap;this.textColor&&(t.setCompositeOperation(g.CompositeOperation.SourceAtop),t.fillRect(0,0,this._lineBreakWidth,this.height,this.textColor)),t.restore()}},s.prototype.destroy=function(){this._destroyLines(),i.prototype.destroy.call(this)},s.prototype.calculateCacheSize=function(){return{width:Math.ceil(this._lines.reduce(function(t,e){return Math.max(t,e.width)},this.width)),height:this.height}},Object.defineProperty(s.prototype,"lineCount",{get:function(){return this._lines.length},enumerable:!0,configurable:!0}),s.prototype._offsetX=function(t){switch(this.textAlign){case g.TextAlign.Left:return 0;case g.TextAlign.Right:return this._lineBreakWidth-t;case g.TextAlign.Center:return(this._lineBreakWidth-t)/2;default:return 0}},s.prototype._destroyLines=function(){for(var t=0;t<this._lines.length;t++)this._lines[t].surface&&!this._lines[t].surface.destroyed()&&this._lines[t].surface.destroy();this._lines=void 0},s.prototype._invalidateSelf=function(){if(this.fontSize<0)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: fontSize must not be negative.");if(this.lineGap<-1*this.fontSize)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: lineGap must be greater than -1 * fontSize.");this._beforeWidth!==this.width&&(this._lineBreakWidth=this.width),(this._beforeText!==this.text||this._beforeFontSize!==this.fontSize||this._beforeFont!==this.font||this._beforeLineBreak!==this.lineBreak||this._beforeWidth!==this.width&&!0===this._beforeLineBreak||this._beforeTextAlign!==this.textAlign||this._beforeRubyEnabled!==this.rubyEnabled||this._beforeFixLineGap!==this.fixLineGap||this._beforeTrimMarginTop!==this.trimMarginTop||this._beforeWidthAutoAdjust!==this.widthAutoAdjust||this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions))&&this._updateLines(),this.widthAutoAdjust&&(this.width=Math.ceil(this._lines.reduce(function(t,e){return Math.max(t,e.width)},0)));for(var t=this.lineGap*(this._lines.length-1),e=0;e<this._lines.length;e++)t+=this._lines[e].height;this.height=t,this._beforeText=this.text,this._beforeTextAlign=this.textAlign,this._beforeFontSize=this.fontSize,this._beforeLineBreak=this.lineBreak,this._beforeFont=this.font,this._beforeWidth=this.width,this._beforeRubyEnabled=this.rubyEnabled,this._beforeFixLineGap=this.fixLineGap,this._beforeTrimMarginTop=this.trimMarginTop,this._beforeWidthAutoAdjust=this.widthAutoAdjust,this._beforeRubyOptions.rubyFontSize=this.rubyOptions.rubyFontSize,this._beforeRubyOptions.rubyFont=this.rubyOptions.rubyFont,this._beforeRubyOptions.rubyGap=this.rubyOptions.rubyGap,this._beforeRubyOptions.rubyAlign=this.rubyOptions.rubyAlign},s.prototype._updateLines=function(){for(var t=this.rubyEnabled?this.rubyParser(this.text.replace(/\r\n|\n/g,"\r")):[this.text],t=c.flatmap(t,function(t){return"string"!=typeof t?t:t.replace(/\r\n|\n/g,"\r").match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[]}),e=this._divideToLines(t),i=[],r=this._beforeFontSize===this.fontSize&&this._beforeFont===this.font&&!this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions),n=0;n<e.length;n++){var o=e[n],s=this._lines[n];r&&void 0!==s&&o.sourceText===s.sourceText&&o.width===s.width&&o.height===s.height?i.push(s):(s&&s.surface&&!s.surface.destroyed()&&s.surface.destroy(),this._drawLineInfoSurface(o),i.push(o))}for(n=i.length;n<this._lines.length;n++)(s=this._lines[n]).surface&&!s.surface.destroyed()&&s.surface.destroy();this._lines=i},s.prototype._drawLineInfoSurface=function(t){for(var e=t.fragmentDrawInfoArray,i=this._calcRubyHeightInfo(e),r=this.scene.game.resourceFactory.createSurface(Math.ceil(t.width),Math.ceil(t.height)),n=r.renderer(),o=(n.begin(),n.save(),i.hasRubyFragmentDrawInfo||this.fixLineGap?this.rubyOptions.rubyGap+i.maxRubyGlyphHeightWithOffsetY:0),s=t.minMinusOffsetY,h=0;h<e.length;h++){var a=e[h];a instanceof l.RubyFragmentDrawInfo?this._drawRubyFragmentDrawInfo(n,a,o-s,-i.minRubyMinusOffsetY):a instanceof l.StringDrawInfo&&this._drawStringGlyphs(n,this.font,a.glyphs,this.fontSize,0,o-s,0),n.translate(a.width,0)}n.restore(),n.end(),t.surface=r},s.prototype._drawStringGlyphs=function(t,e,i,r,n,o,s){void 0===s&&(s=0),t.save(),t.translate(n,o);for(var h=0;h<i.length;h++){var a=i[h],u=r/e.size,f=a.advanceWidth*u;(a.isSurfaceValid||(a=this._createGlyph(a.code,e)))&&(t.save(),t.transform([u,0,0,u,0,0]),0<a.width&&0<a.height&&t.drawImage(a.surface,a.x,a.y,a.width,a.height,a.offsetX,a.offsetY),t.restore(),t.translate(f+s,0))}t.restore()},s.prototype._drawRubyFragmentDrawInfo=function(t,e,i,r){var n,o,s,h,a=e.fragment,u=("rubyFontSize"in a?a:this.rubyOptions).rubyFontSize,f=("rubyAlign"in a?a:this.rubyOptions).rubyAlign,a=("rubyFont"in a?a:this.rubyOptions).rubyFont,y=e.rtWidth>e.rbWidth,l=e.width,b=e.rtWidth,p=e.rbWidth;switch(f){case c.RubyAlign.Center:h=s=0,n=y?0:(l-b)/2,o=y?(l-p)/2:0;break;case c.RubyAlign.SpaceAround:s=0<e.rubyGlyphs.length?(l-b)/e.rubyGlyphs.length:0,h=0,n=y?0:s/2,o=y?(l-p)/2:0;break;default:throw g.ExceptionFactory.createAssertionError("Label#_drawRubyFragmentDrawInfo: unknown rubyAlign.")}this._drawStringGlyphs(t,this.font,e.glyphs,this.fontSize,o,i,h),this._drawStringGlyphs(t,a,e.rubyGlyphs,u,n,r,s)},s.prototype._calcRubyHeightInfo=function(t){for(var e,i=this.rubyOptions.rubyFontSize,r=0,n=this.rubyOptions.rubyGap,o=!1,s=0,h=0;h<t.length;h++){var a,u,f,y=t[h];y instanceof l.RubyFragmentDrawInfo&&((u=y.fragment).rubyFontSize>i&&(i=u.rubyFontSize),u.rubyGap>n&&(n=u.rubyGap),a=(u.rubyFontSize||this.rubyOptions.rubyFontSize)/(u.rubyFont?u:this.rubyOptions).rubyFont.size,f=Math.max.apply(Math,y.rubyGlyphs.map(function(t){return 0<t.offsetY?t.height+t.offsetY:t.height})),y=Math.min.apply(Math,y.rubyGlyphs.map(function(t){return 0<t.offsetY?t.offsetY:0})),r<f*a&&(r=f*a),u=u.rubyFont||this.rubyOptions.rubyFont,u=this._calcStandardOffsetY(u),s<(f=(f-Math.min(y,u))*a)&&(s=f,e=Math.min(y,u)*a),o=!0)}return{maxRubyFontSize:i,maxRubyGlyphHeightWithOffsetY:r=0===r?this.rubyOptions.rubyFontSize:r,minRubyMinusOffsetY:this.trimMarginTop?e:0,maxRubyGap:n,hasRubyFragmentDrawInfo:o}},s.prototype._divideToLines=function(t){for(var e={resultLines:[],currentStringDrawInfo:new l.StringDrawInfo("",0,[]),currentLineInfo:{sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0},reservedLineBreakPosition:null},i=0;i<t.length;i++)this._addFragmentToState(e,t,i);return this._flushCurrentStringDrawInfo(e),this._feedLine(e),e.resultLines},s.prototype._addFragmentToState=function(t,e,i){var r,n,o=e[i];null!==t.reservedLineBreakPosition&&t.reservedLineBreakPosition--,0===t.reservedLineBreakPosition&&(this._flushCurrentStringDrawInfo(t),this._feedLine(t),t.reservedLineBreakPosition=null),"string"==typeof o&&"\r"===o?(this._flushCurrentStringDrawInfo(t),this._feedLine(t)):"string"==typeof o?(r=g.Util.charCodeAt(o,0))&&(r=this._createGlyph(r,this.font))&&(n=this.fontSize/this.font.size,n=r.advanceWidth*n,this._needBreakLine(t,n)&&this._breakLine(t,e,i),t.currentStringDrawInfo.width+=n,t.currentStringDrawInfo.glyphs.push(r),t.currentStringDrawInfo.text+=o):(n=this._createRubyFragmentDrawInfo(o)).width<=0||(this._flushCurrentStringDrawInfo(t),this._needBreakLine(t,n.width)&&this._breakLine(t,e,i),t.currentLineInfo.width+=n.width,t.currentLineInfo.fragmentDrawInfoArray.push(n),t.currentLineInfo.sourceText+=o.text)},s.prototype._createStringGlyph=function(t,e){for(var i=[],r=0;r<t.length;r++){var n=g.Util.charCodeAt(t,r);n&&((n=this._createGlyph(n,e))&&i.push(n))}return i},s.prototype._createGlyph=function(t,e){e=e.glyphForCharacter(t);return e||(t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),this.game().logger.warn("Label#_invalidateSelf(): failed to get a glyph for '"+t+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")),e},s.prototype._createRubyFragmentDrawInfo=function(t){var e=this._createStringGlyph(t.rb,this.font),i=this._createStringGlyph(t.rt,this.rubyOptions.rubyFont),r=("rubyFont"in t?t:this.rubyOptions).rubyFont,n=("rubyFontSize"in t?t:this.rubyOptions).rubyFontSize,o=this.fontSize/this.font.size,n=n/r.size,r=0<e.length?e.map(function(t){return t.advanceWidth}).reduce(function(t,e){return t+e})*o:0,o=0<i.length?i.map(function(t){return t.advanceWidth}).reduce(function(t,e){return t+e})*n:0;return new l.RubyFragmentDrawInfo(t,o<r?r:o,r,o,e,i)},s.prototype._flushCurrentStringDrawInfo=function(t){0<t.currentStringDrawInfo.width&&(t.currentLineInfo.fragmentDrawInfoArray.push(t.currentStringDrawInfo),t.currentLineInfo.width+=t.currentStringDrawInfo.width,t.currentLineInfo.sourceText+=t.currentStringDrawInfo.text),t.currentStringDrawInfo=new l.StringDrawInfo("",0,[])},s.prototype._feedLine=function(t){var e=this.fontSize/this.font.size,i=1/0,r=0,n=0,o=(t.currentLineInfo.fragmentDrawInfoArray.forEach(function(t){t.glyphs.forEach(function(t){r>t.offsetY&&(r=t.offsetY),i>t.offsetY&&(i=t.offsetY);t=0<t.offsetY?t.height+t.offsetY:t.height;n<t&&(n=t)})}),r*=e,n=0<t.currentLineInfo.fragmentDrawInfoArray.length?n*e-r:this.fontSize,n=Math.ceil(n),this._calcRubyHeightInfo(t.currentLineInfo.fragmentDrawInfoArray));t.currentLineInfo.height=o.hasRubyFragmentDrawInfo||this.fixLineGap?n+o.maxRubyGlyphHeightWithOffsetY+o.maxRubyGap:n,t.currentLineInfo.minMinusOffsetY=r,this.trimMarginTop&&(o=Math.min(i,this._calcStandardOffsetY(this.font))*e,t.currentLineInfo.height-=o,t.currentLineInfo.minMinusOffsetY+=o),t.resultLines.push(t.currentLineInfo),t.currentLineInfo={sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0}},s.prototype._needBreakLine=function(t,e){return this.lineBreak&&0<e&&null===t.reservedLineBreakPosition&&t.currentLineInfo.width+t.currentStringDrawInfo.width+e>this._lineBreakWidth&&0<t.currentLineInfo.width+t.currentStringDrawInfo.width},s.prototype._isDifferentRubyOptions=function(t,e){return t.rubyFontSize!==e.rubyFontSize||t.rubyFont!==e.rubyFont||t.rubyGap!==e.rubyGap||t.rubyAlign!==e.rubyAlign},s.prototype._calcStandardOffsetY=function(t){return t.glyphForCharacter("M".charCodeAt(0)).offsetY},s.prototype._breakLine=function(t,e,i){if(this.lineBreakRule){var r=this.lineBreakRule(e,i)-i;if(0===r)this._flushCurrentStringDrawInfo(t),this._feedLine(t);else if(0<r)t.reservedLineBreakPosition=r;else{this._flushCurrentStringDrawInfo(t);for(var n=[];r<0;){var o,s,h,a=t.currentLineInfo.fragmentDrawInfoArray,u=a[a.length-1];u instanceof l.RubyFragmentDrawInfo?(r++,n.push(u),a.pop()):-r>=u.text.length?(r+=u.text.length,n.push(u),a.pop()):(a=u.glyphs.splice(r),o=this.fontSize/this.font.size,s=a.reduce(function(t,e){return e.advanceWidth*o+t},0),u.width-=s,h=u.text.substring(u.text.length+r),u.text=u.text.substring(0,u.text.length+r),n.push(new l.StringDrawInfo(h,s,a)),r=0)}var f=0,y="",e=(n.forEach(function(t){f+=t.width,y+=t.text}),t.currentLineInfo.width-=f,t.currentLineInfo.sourceText);t.currentLineInfo.sourceText=e.substr(0,e.length-y.length),this._feedLine(t),t.currentLineInfo.fragmentDrawInfoArray=n,t.currentLineInfo.width=f,t.currentLineInfo.sourceText=y}}else this._flushCurrentStringDrawInfo(t),this._feedLine(t)},s);function s(t){var e=i.call(this,t)||this;return e.text=t.text,e.font=t.font,e.fontSize=t.fontSize,e._lineBreakWidth=t.width,e.lineBreak=!("lineBreak"in t)||t.lineBreak,e.lineGap=t.lineGap||0,e.textAlign="textAlign"in t?t.textAlign:g.TextAlign.Left,e.textColor=t.textColor,e.trimMarginTop="trimMarginTop"in t&&t.trimMarginTop,e.widthAutoAdjust="widthAutoAdjust"in t&&t.widthAutoAdjust,e.rubyEnabled=!("rubyEnabled"in t)||t.rubyEnabled,e.fixLineGap="fixLineGap"in t&&t.fixLineGap,e.rubyParser="rubyParser"in t?t.rubyParser:o.parse,e.lineBreakRule="lineBreakRule"in t?t.lineBreakRule:void 0,t.rubyOptions||(t.rubyOptions={}),e.rubyOptions=t.rubyOptions,e.rubyOptions.rubyFontSize="rubyFontSize"in t.rubyOptions?t.rubyOptions.rubyFontSize:t.fontSize/2,e.rubyOptions.rubyFont="rubyFont"in t.rubyOptions?t.rubyOptions.rubyFont:e.font,e.rubyOptions.rubyGap="rubyGap"in t.rubyOptions?t.rubyOptions.rubyGap:0,e.rubyOptions.rubyAlign="rubyAlign"in t.rubyOptions?t.rubyOptions.rubyAlign:c.RubyAlign.SpaceAround,e._lines=[],e._beforeText=void 0,e._beforeTextAlign=void 0,e._beforeFontSize=void 0,e._beforeLineBreak=void 0,e._beforeFont=void 0,e._beforeWidth=void 0,e._beforeRubyEnabled=void 0,e._beforeFixLineGap=void 0,e._beforeTrimMarginTop=void 0,e._beforeWidthAutoAdjust=void 0,e._beforeRubyOptions={},e._invalidateSelf(),e}e.exports=t}((g.module.exports,g.module.require),g.module,(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_8"] = function(g) {
			!function(e){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),(r=e.RubyAlign||(e.RubyAlign={}))[r.Center=0]="Center",r[r.SpaceAround=1]="SpaceAround",e.flatmap=function(e,r){return Array.prototype.concat.apply([],e.map(r))}}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_9"] = function(g) {
			!function(e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Label=r("./Label"),e.FragmentDrawInfo=r("./FragmentDrawInfo"),e.RubyParser=r("./RubyParser"),e.RubyAlign=e.RubyParser.RubyAlign;r=r("./DefaultRubyParser");e.defaultRubyParser=r.parse}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["font_glyphs"] = "{%22map%22:{%2232%22:{%22x%22:1,%22y%22:1,%22width%22:25,%22height%22:63},%2233%22:{%22x%22:561,%22y%22:705,%22width%22:25,%22height%22:63},%2234%22:{%22x%22:587,%22y%22:705,%22width%22:25,%22height%22:63},%2235%22:{%22x%22:613,%22y%22:705,%22width%22:25,%22height%22:63},%2236%22:{%22x%22:639,%22y%22:705,%22width%22:25,%22height%22:63},%2237%22:{%22x%22:665,%22y%22:705,%22width%22:25,%22height%22:63},%2238%22:{%22x%22:691,%22y%22:705,%22width%22:25,%22height%22:63},%2239%22:{%22x%22:717,%22y%22:705,%22width%22:25,%22height%22:63},%2240%22:{%22x%22:743,%22y%22:705,%22width%22:25,%22height%22:63},%2241%22:{%22x%22:769,%22y%22:705,%22width%22:25,%22height%22:63},%2242%22:{%22x%22:235,%22y%22:769,%22width%22:25,%22height%22:63},%2243%22:{%22x%22:79,%22y%22:769,%22width%22:25,%22height%22:63},%2244%22:{%22x%22:209,%22y%22:769,%22width%22:25,%22height%22:63},%2245%22:{%22x%22:157,%22y%22:769,%22width%22:25,%22height%22:63},%2246%22:{%22x%22:183,%22y%22:769,%22width%22:25,%22height%22:63},%2247%22:{%22x%22:131,%22y%22:769,%22width%22:25,%22height%22:63},%2248%22:{%22x%22:535,%22y%22:705,%22width%22:25,%22height%22:63},%2249%22:{%22x%22:301,%22y%22:705,%22width%22:25,%22height%22:63},%2250%22:{%22x%22:327,%22y%22:705,%22width%22:25,%22height%22:63},%2251%22:{%22x%22:353,%22y%22:705,%22width%22:25,%22height%22:63},%2252%22:{%22x%22:379,%22y%22:705,%22width%22:25,%22height%22:63},%2253%22:{%22x%22:405,%22y%22:705,%22width%22:25,%22height%22:63},%2254%22:{%22x%22:431,%22y%22:705,%22width%22:25,%22height%22:63},%2255%22:{%22x%22:457,%22y%22:705,%22width%22:25,%22height%22:63},%2256%22:{%22x%22:483,%22y%22:705,%22width%22:25,%22height%22:63},%2257%22:{%22x%22:509,%22y%22:705,%22width%22:25,%22height%22:63},%2258%22:{%22x%22:53,%22y%22:769,%22width%22:25,%22height%22:63},%2259%22:{%22x%22:105,%22y%22:769,%22width%22:25,%22height%22:63},%2260%22:{%22x%22:821,%22y%22:705,%22width%22:25,%22height%22:63},%2262%22:{%22x%22:847,%22y%22:705,%22width%22:25,%22height%22:63},%2263%22:{%22x%22:795,%22y%22:705,%22width%22:25,%22height%22:63},%2264%22:{%22x%22:925,%22y%22:705,%22width%22:25,%22height%22:63},%2265%22:{%22x%22:77,%22y%22:1,%22width%22:25,%22height%22:63},%2266%22:{%22x%22:103,%22y%22:1,%22width%22:25,%22height%22:63},%2267%22:{%22x%22:129,%22y%22:1,%22width%22:25,%22height%22:63},%2268%22:{%22x%22:155,%22y%22:1,%22width%22:25,%22height%22:63},%2269%22:{%22x%22:181,%22y%22:1,%22width%22:25,%22height%22:63},%2270%22:{%22x%22:207,%22y%22:1,%22width%22:25,%22height%22:63},%2271%22:{%22x%22:233,%22y%22:1,%22width%22:25,%22height%22:63},%2272%22:{%22x%22:259,%22y%22:1,%22width%22:25,%22height%22:63},%2273%22:{%22x%22:285,%22y%22:1,%22width%22:25,%22height%22:63},%2274%22:{%22x%22:311,%22y%22:1,%22width%22:25,%22height%22:63},%2275%22:{%22x%22:337,%22y%22:1,%22width%22:25,%22height%22:63},%2276%22:{%22x%22:363,%22y%22:1,%22width%22:25,%22height%22:63},%2277%22:{%22x%22:389,%22y%22:1,%22width%22:25,%22height%22:63},%2278%22:{%22x%22:415,%22y%22:1,%22width%22:25,%22height%22:63},%2279%22:{%22x%22:441,%22y%22:1,%22width%22:25,%22height%22:63},%2280%22:{%22x%22:467,%22y%22:1,%22width%22:25,%22height%22:63},%2281%22:{%22x%22:493,%22y%22:1,%22width%22:25,%22height%22:63},%2282%22:{%22x%22:519,%22y%22:1,%22width%22:25,%22height%22:63},%2283%22:{%22x%22:545,%22y%22:1,%22width%22:25,%22height%22:63},%2284%22:{%22x%22:571,%22y%22:1,%22width%22:25,%22height%22:63},%2285%22:{%22x%22:597,%22y%22:1,%22width%22:25,%22height%22:63},%2286%22:{%22x%22:623,%22y%22:1,%22width%22:25,%22height%22:63},%2287%22:{%22x%22:649,%22y%22:1,%22width%22:25,%22height%22:63},%2288%22:{%22x%22:675,%22y%22:1,%22width%22:25,%22height%22:63},%2289%22:{%22x%22:701,%22y%22:1,%22width%22:25,%22height%22:63},%2290%22:{%22x%22:727,%22y%22:1,%22width%22:25,%22height%22:63},%2291%22:{%22x%22:951,%22y%22:705,%22width%22:25,%22height%22:63},%2293%22:{%22x%22:977,%22y%22:705,%22width%22:25,%22height%22:63},%2296%22:{%22x%22:899,%22y%22:705,%22width%22:25,%22height%22:63},%2297%22:{%22x%22:753,%22y%22:1,%22width%22:25,%22height%22:63},%2298%22:{%22x%22:779,%22y%22:1,%22width%22:25,%22height%22:63},%2299%22:{%22x%22:805,%22y%22:1,%22width%22:25,%22height%22:63},%22100%22:{%22x%22:831,%22y%22:1,%22width%22:25,%22height%22:63},%22101%22:{%22x%22:857,%22y%22:1,%22width%22:25,%22height%22:63},%22102%22:{%22x%22:883,%22y%22:1,%22width%22:25,%22height%22:63},%22103%22:{%22x%22:909,%22y%22:1,%22width%22:25,%22height%22:63},%22104%22:{%22x%22:935,%22y%22:1,%22width%22:25,%22height%22:63},%22105%22:{%22x%22:961,%22y%22:1,%22width%22:25,%22height%22:63},%22106%22:{%22x%22:987,%22y%22:1,%22width%22:25,%22height%22:63},%22107%22:{%22x%22:1,%22y%22:65,%22width%22:25,%22height%22:63},%22108%22:{%22x%22:27,%22y%22:65,%22width%22:25,%22height%22:63},%22109%22:{%22x%22:53,%22y%22:65,%22width%22:25,%22height%22:63},%22110%22:{%22x%22:79,%22y%22:65,%22width%22:25,%22height%22:63},%22111%22:{%22x%22:105,%22y%22:65,%22width%22:25,%22height%22:63},%22112%22:{%22x%22:131,%22y%22:65,%22width%22:25,%22height%22:63},%22113%22:{%22x%22:157,%22y%22:65,%22width%22:25,%22height%22:63},%22114%22:{%22x%22:183,%22y%22:65,%22width%22:25,%22height%22:63},%22115%22:{%22x%22:209,%22y%22:65,%22width%22:25,%22height%22:63},%22116%22:{%22x%22:235,%22y%22:65,%22width%22:25,%22height%22:63},%22117%22:{%22x%22:261,%22y%22:65,%22width%22:25,%22height%22:63},%22118%22:{%22x%22:287,%22y%22:65,%22width%22:25,%22height%22:63},%22119%22:{%22x%22:313,%22y%22:65,%22width%22:25,%22height%22:63},%22120%22:{%22x%22:339,%22y%22:65,%22width%22:25,%22height%22:63},%22121%22:{%22x%22:365,%22y%22:65,%22width%22:25,%22height%22:63},%22122%22:{%22x%22:391,%22y%22:65,%22width%22:25,%22height%22:63},%22123%22:{%22x%22:1,%22y%22:769,%22width%22:25,%22height%22:63},%22124%22:{%22x%22:873,%22y%22:705,%22width%22:25,%22height%22:63},%22125%22:{%22x%22:27,%22y%22:769,%22width%22:25,%22height%22:63},%228213%22:{%22x%22:101,%22y%22:641,%22width%22:49,%22height%22:63},%228217%22:{%22x%22:51,%22y%22:641,%22width%22:49,%22height%22:63},%228221%22:{%22x%22:801,%22y%22:577,%22width%22:49,%22height%22:63},%2212288%22:{%22x%22:27,%22y%22:1,%22width%22:49,%22height%22:63},%2212289%22:{%22x%22:851,%22y%22:641,%22width%22:49,%22height%22:63},%2212290%22:{%22x%22:901,%22y%22:641,%22width%22:49,%22height%22:63},%2212300%22:{%22x%22:401,%22y%22:641,%22width%22:49,%22height%22:63},%2212301%22:{%22x%22:451,%22y%22:641,%22width%22:49,%22height%22:63},%2212302%22:{%22x%22:501,%22y%22:641,%22width%22:49,%22height%22:63},%2212303%22:{%22x%22:551,%22y%22:641,%22width%22:49,%22height%22:63},%2212353%22:{%22x%22:701,%22y%22:257,%22width%22:49,%22height%22:63},%2212354%22:{%22x%22:417,%22y%22:65,%22width%22:49,%22height%22:63},%2212355%22:{%22x%22:751,%22y%22:257,%22width%22:49,%22height%22:63},%2212356%22:{%22x%22:467,%22y%22:65,%22width%22:49,%22height%22:63},%2212357%22:{%22x%22:801,%22y%22:257,%22width%22:49,%22height%22:63},%2212358%22:{%22x%22:517,%22y%22:65,%22width%22:49,%22height%22:63},%2212359%22:{%22x%22:851,%22y%22:257,%22width%22:49,%22height%22:63},%2212360%22:{%22x%22:567,%22y%22:65,%22width%22:49,%22height%22:63},%2212361%22:{%22x%22:901,%22y%22:257,%22width%22:49,%22height%22:63},%2212362%22:{%22x%22:617,%22y%22:65,%22width%22:49,%22height%22:63},%2212363%22:{%22x%22:667,%22y%22:65,%22width%22:49,%22height%22:63},%2212364%22:{%22x%22:451,%22y%22:193,%22width%22:49,%22height%22:63},%2212365%22:{%22x%22:717,%22y%22:65,%22width%22:49,%22height%22:63},%2212366%22:{%22x%22:501,%22y%22:193,%22width%22:49,%22height%22:63},%2212367%22:{%22x%22:767,%22y%22:65,%22width%22:49,%22height%22:63},%2212368%22:{%22x%22:551,%22y%22:193,%22width%22:49,%22height%22:63},%2212369%22:{%22x%22:817,%22y%22:65,%22width%22:49,%22height%22:63},%2212370%22:{%22x%22:601,%22y%22:193,%22width%22:49,%22height%22:63},%2212371%22:{%22x%22:867,%22y%22:65,%22width%22:49,%22height%22:63},%2212372%22:{%22x%22:651,%22y%22:193,%22width%22:49,%22height%22:63},%2212373%22:{%22x%22:917,%22y%22:65,%22width%22:49,%22height%22:63},%2212374%22:{%22x%22:701,%22y%22:193,%22width%22:49,%22height%22:63},%2212375%22:{%22x%22:967,%22y%22:65,%22width%22:49,%22height%22:63},%2212376%22:{%22x%22:751,%22y%22:193,%22width%22:49,%22height%22:63},%2212377%22:{%22x%22:1,%22y%22:129,%22width%22:49,%22height%22:63},%2212378%22:{%22x%22:801,%22y%22:193,%22width%22:49,%22height%22:63},%2212379%22:{%22x%22:51,%22y%22:129,%22width%22:49,%22height%22:63},%2212380%22:{%22x%22:851,%22y%22:193,%22width%22:49,%22height%22:63},%2212381%22:{%22x%22:101,%22y%22:129,%22width%22:49,%22height%22:63},%2212382%22:{%22x%22:901,%22y%22:193,%22width%22:49,%22height%22:63},%2212383%22:{%22x%22:151,%22y%22:129,%22width%22:49,%22height%22:63},%2212384%22:{%22x%22:951,%22y%22:193,%22width%22:49,%22height%22:63},%2212385%22:{%22x%22:201,%22y%22:129,%22width%22:49,%22height%22:63},%2212386%22:{%22x%22:1,%22y%22:257,%22width%22:49,%22height%22:63},%2212387%22:{%22x%22:101,%22y%22:321,%22width%22:49,%22height%22:63},%2212388%22:{%22x%22:251,%22y%22:129,%22width%22:49,%22height%22:63},%2212389%22:{%22x%22:51,%22y%22:257,%22width%22:49,%22height%22:63},%2212390%22:{%22x%22:301,%22y%22:129,%22width%22:49,%22height%22:63},%2212391%22:{%22x%22:101,%22y%22:257,%22width%22:49,%22height%22:63},%2212392%22:{%22x%22:351,%22y%22:129,%22width%22:49,%22height%22:63},%2212393%22:{%22x%22:151,%22y%22:257,%22width%22:49,%22height%22:63},%2212394%22:{%22x%22:401,%22y%22:129,%22width%22:49,%22height%22:63},%2212395%22:{%22x%22:451,%22y%22:129,%22width%22:49,%22height%22:63},%2212396%22:{%22x%22:501,%22y%22:129,%22width%22:49,%22height%22:63},%2212397%22:{%22x%22:551,%22y%22:129,%22width%22:49,%22height%22:63},%2212398%22:{%22x%22:601,%22y%22:129,%22width%22:49,%22height%22:63},%2212399%22:{%22x%22:651,%22y%22:129,%22width%22:49,%22height%22:63},%2212400%22:{%22x%22:201,%22y%22:257,%22width%22:49,%22height%22:63},%2212401%22:{%22x%22:451,%22y%22:257,%22width%22:49,%22height%22:63},%2212402%22:{%22x%22:701,%22y%22:129,%22width%22:49,%22height%22:63},%2212403%22:{%22x%22:251,%22y%22:257,%22width%22:49,%22height%22:63},%2212404%22:{%22x%22:501,%22y%22:257,%22width%22:49,%22height%22:63},%2212405%22:{%22x%22:751,%22y%22:129,%22width%22:49,%22height%22:63},%2212406%22:{%22x%22:301,%22y%22:257,%22width%22:49,%22height%22:63},%2212407%22:{%22x%22:551,%22y%22:257,%22width%22:49,%22height%22:63},%2212408%22:{%22x%22:801,%22y%22:129,%22width%22:49,%22height%22:63},%2212409%22:{%22x%22:351,%22y%22:257,%22width%22:49,%22height%22:63},%2212410%22:{%22x%22:601,%22y%22:257,%22width%22:49,%22height%22:63},%2212411%22:{%22x%22:851,%22y%22:129,%22width%22:49,%22height%22:63},%2212412%22:{%22x%22:401,%22y%22:257,%22width%22:49,%22height%22:63},%2212413%22:{%22x%22:651,%22y%22:257,%22width%22:49,%22height%22:63},%2212414%22:{%22x%22:901,%22y%22:129,%22width%22:49,%22height%22:63},%2212415%22:{%22x%22:951,%22y%22:129,%22width%22:49,%22height%22:63},%2212416%22:{%22x%22:1,%22y%22:193,%22width%22:49,%22height%22:63},%2212417%22:{%22x%22:51,%22y%22:193,%22width%22:49,%22height%22:63},%2212418%22:{%22x%22:101,%22y%22:193,%22width%22:49,%22height%22:63},%2212419%22:{%22x%22:951,%22y%22:257,%22width%22:49,%22height%22:63},%2212420%22:{%22x%22:151,%22y%22:193,%22width%22:49,%22height%22:63},%2212421%22:{%22x%22:1,%22y%22:321,%22width%22:49,%22height%22:63},%2212422%22:{%22x%22:201,%22y%22:193,%22width%22:49,%22height%22:63},%2212423%22:{%22x%22:51,%22y%22:321,%22width%22:49,%22height%22:63},%2212424%22:{%22x%22:251,%22y%22:193,%22width%22:49,%22height%22:63},%2212431%22:{%22x%22:301,%22y%22:193,%22width%22:49,%22height%22:63},%2212434%22:{%22x%22:351,%22y%22:193,%22width%22:49,%22height%22:63},%2212435%22:{%22x%22:401,%22y%22:193,%22width%22:49,%22height%22:63},%2212449%22:{%22x%22:751,%22y%22:513,%22width%22:49,%22height%22:63},%2212450%22:{%22x%22:201,%22y%22:321,%22width%22:49,%22height%22:63},%2212451%22:{%22x%22:801,%22y%22:513,%22width%22:49,%22height%22:63},%2212452%22:{%22x%22:251,%22y%22:321,%22width%22:49,%22height%22:63},%2212453%22:{%22x%22:851,%22y%22:513,%22width%22:49,%22height%22:63},%2212454%22:{%22x%22:301,%22y%22:321,%22width%22:49,%22height%22:63},%2212455%22:{%22x%22:901,%22y%22:513,%22width%22:49,%22height%22:63},%2212456%22:{%22x%22:351,%22y%22:321,%22width%22:49,%22height%22:63},%2212457%22:{%22x%22:951,%22y%22:513,%22width%22:49,%22height%22:63},%2212458%22:{%22x%22:401,%22y%22:321,%22width%22:49,%22height%22:63},%2212459%22:{%22x%22:451,%22y%22:321,%22width%22:49,%22height%22:63},%2212460%22:{%22x%22:501,%22y%22:449,%22width%22:49,%22height%22:63},%2212461%22:{%22x%22:501,%22y%22:321,%22width%22:49,%22height%22:63},%2212462%22:{%22x%22:551,%22y%22:449,%22width%22:49,%22height%22:63},%2212463%22:{%22x%22:551,%22y%22:321,%22width%22:49,%22height%22:63},%2212464%22:{%22x%22:601,%22y%22:449,%22width%22:49,%22height%22:63},%2212465%22:{%22x%22:601,%22y%22:321,%22width%22:49,%22height%22:63},%2212466%22:{%22x%22:651,%22y%22:449,%22width%22:49,%22height%22:63},%2212467%22:{%22x%22:651,%22y%22:321,%22width%22:49,%22height%22:63},%2212468%22:{%22x%22:701,%22y%22:449,%22width%22:49,%22height%22:63},%2212469%22:{%22x%22:701,%22y%22:321,%22width%22:49,%22height%22:63},%2212470%22:{%22x%22:751,%22y%22:449,%22width%22:49,%22height%22:63},%2212471%22:{%22x%22:751,%22y%22:321,%22width%22:49,%22height%22:63},%2212472%22:{%22x%22:801,%22y%22:449,%22width%22:49,%22height%22:63},%2212473%22:{%22x%22:801,%22y%22:321,%22width%22:49,%22height%22:63},%2212474%22:{%22x%22:851,%22y%22:449,%22width%22:49,%22height%22:63},%2212475%22:{%22x%22:851,%22y%22:321,%22width%22:49,%22height%22:63},%2212476%22:{%22x%22:901,%22y%22:449,%22width%22:49,%22height%22:63},%2212477%22:{%22x%22:901,%22y%22:321,%22width%22:49,%22height%22:63},%2212478%22:{%22x%22:951,%22y%22:449,%22width%22:49,%22height%22:63},%2212479%22:{%22x%22:951,%22y%22:321,%22width%22:49,%22height%22:63},%2212480%22:{%22x%22:1,%22y%22:513,%22width%22:49,%22height%22:63},%2212481%22:{%22x%22:1,%22y%22:385,%22width%22:49,%22height%22:63},%2212482%22:{%22x%22:51,%22y%22:513,%22width%22:49,%22height%22:63},%2212483%22:{%22x%22:151,%22y%22:577,%22width%22:49,%22height%22:63},%2212484%22:{%22x%22:51,%22y%22:385,%22width%22:49,%22height%22:63},%2212485%22:{%22x%22:101,%22y%22:513,%22width%22:49,%22height%22:63},%2212486%22:{%22x%22:101,%22y%22:385,%22width%22:49,%22height%22:63},%2212487%22:{%22x%22:151,%22y%22:513,%22width%22:49,%22height%22:63},%2212488%22:{%22x%22:151,%22y%22:385,%22width%22:49,%22height%22:63},%2212489%22:{%22x%22:201,%22y%22:513,%22width%22:49,%22height%22:63},%2212490%22:{%22x%22:201,%22y%22:385,%22width%22:49,%22height%22:63},%2212491%22:{%22x%22:251,%22y%22:385,%22width%22:49,%22height%22:63},%2212492%22:{%22x%22:301,%22y%22:385,%22width%22:49,%22height%22:63},%2212493%22:{%22x%22:351,%22y%22:385,%22width%22:49,%22height%22:63},%2212494%22:{%22x%22:401,%22y%22:385,%22width%22:49,%22height%22:63},%2212495%22:{%22x%22:451,%22y%22:385,%22width%22:49,%22height%22:63},%2212496%22:{%22x%22:251,%22y%22:513,%22width%22:49,%22height%22:63},%2212497%22:{%22x%22:501,%22y%22:513,%22width%22:49,%22height%22:63},%2212498%22:{%22x%22:501,%22y%22:385,%22width%22:49,%22height%22:63},%2212499%22:{%22x%22:301,%22y%22:513,%22width%22:49,%22height%22:63},%2212500%22:{%22x%22:551,%22y%22:513,%22width%22:49,%22height%22:63},%2212501%22:{%22x%22:551,%22y%22:385,%22width%22:49,%22height%22:63},%2212502%22:{%22x%22:351,%22y%22:513,%22width%22:49,%22height%22:63},%2212503%22:{%22x%22:601,%22y%22:513,%22width%22:49,%22height%22:63},%2212504%22:{%22x%22:601,%22y%22:385,%22width%22:49,%22height%22:63},%2212505%22:{%22x%22:401,%22y%22:513,%22width%22:49,%22height%22:63},%2212506%22:{%22x%22:651,%22y%22:513,%22width%22:49,%22height%22:63},%2212507%22:{%22x%22:651,%22y%22:385,%22width%22:49,%22height%22:63},%2212508%22:{%22x%22:451,%22y%22:513,%22width%22:49,%22height%22:63},%2212509%22:{%22x%22:701,%22y%22:513,%22width%22:49,%22height%22:63},%2212510%22:{%22x%22:701,%22y%22:385,%22width%22:49,%22height%22:63},%2212511%22:{%22x%22:751,%22y%22:385,%22width%22:49,%22height%22:63},%2212512%22:{%22x%22:801,%22y%22:385,%22width%22:49,%22height%22:63},%2212513%22:{%22x%22:851,%22y%22:385,%22width%22:49,%22height%22:63},%2212514%22:{%22x%22:901,%22y%22:385,%22width%22:49,%22height%22:63},%2212515%22:{%22x%22:1,%22y%22:577,%22width%22:49,%22height%22:63},%2212516%22:{%22x%22:951,%22y%22:385,%22width%22:49,%22height%22:63},%2212517%22:{%22x%22:51,%22y%22:577,%22width%22:49,%22height%22:63},%2212518%22:{%22x%22:1,%22y%22:449,%22width%22:49,%22height%22:63},%2212519%22:{%22x%22:101,%22y%22:577,%22width%22:49,%22height%22:63},%2212520%22:{%22x%22:51,%22y%22:449,%22width%22:49,%22height%22:63},%2212521%22:{%22x%22:101,%22y%22:449,%22width%22:49,%22height%22:63},%2212522%22:{%22x%22:151,%22y%22:449,%22width%22:49,%22height%22:63},%2212523%22:{%22x%22:201,%22y%22:449,%22width%22:49,%22height%22:63},%2212524%22:{%22x%22:251,%22y%22:449,%22width%22:49,%22height%22:63},%2212525%22:{%22x%22:301,%22y%22:449,%22width%22:49,%22height%22:63},%2212527%22:{%22x%22:351,%22y%22:449,%22width%22:49,%22height%22:63},%2212530%22:{%22x%22:401,%22y%22:449,%22width%22:49,%22height%22:63},%2212531%22:{%22x%22:451,%22y%22:449,%22width%22:49,%22height%22:63},%2212539%22:{%22x%22:151,%22y%22:705,%22width%22:49,%22height%22:63},%2212540%22:{%22x%22:201,%22y%22:577,%22width%22:49,%22height%22:63},%2265281%22:{%22x%22:751,%22y%22:577,%22width%22:49,%22height%22:63},%2265283%22:{%22x%22:851,%22y%22:577,%22width%22:49,%22height%22:63},%2265284%22:{%22x%22:901,%22y%22:577,%22width%22:49,%22height%22:63},%2265285%22:{%22x%22:951,%22y%22:577,%22width%22:49,%22height%22:63},%2265286%22:{%22x%22:1,%22y%22:641,%22width%22:49,%22height%22:63},%2265288%22:{%22x%22:151,%22y%22:641,%22width%22:49,%22height%22:63},%2265289%22:{%22x%22:201,%22y%22:641,%22width%22:49,%22height%22:63},%2265290%22:{%22x%22:701,%22y%22:641,%22width%22:49,%22height%22:63},%2265291%22:{%22x%22:651,%22y%22:641,%22width%22:49,%22height%22:63},%2265292%22:{%22x%22:951,%22y%22:641,%22width%22:49,%22height%22:63},%2265294%22:{%22x%22:1,%22y%22:705,%22width%22:49,%22height%22:63},%2265296%22:{%22x%22:701,%22y%22:577,%22width%22:49,%22height%22:63},%2265297%22:{%22x%22:251,%22y%22:577,%22width%22:49,%22height%22:63},%2265298%22:{%22x%22:301,%22y%22:577,%22width%22:49,%22height%22:63},%2265299%22:{%22x%22:351,%22y%22:577,%22width%22:49,%22height%22:63},%2265300%22:{%22x%22:401,%22y%22:577,%22width%22:49,%22height%22:63},%2265301%22:{%22x%22:451,%22y%22:577,%22width%22:49,%22height%22:63},%2265302%22:{%22x%22:501,%22y%22:577,%22width%22:49,%22height%22:63},%2265303%22:{%22x%22:551,%22y%22:577,%22width%22:49,%22height%22:63},%2265304%22:{%22x%22:601,%22y%22:577,%22width%22:49,%22height%22:63},%2265305%22:{%22x%22:651,%22y%22:577,%22width%22:49,%22height%22:63},%2265306%22:{%22x%22:801,%22y%22:641,%22width%22:49,%22height%22:63},%2265307%22:{%22x%22:751,%22y%22:641,%22width%22:49,%22height%22:63},%2265308%22:{%22x%22:51,%22y%22:705,%22width%22:49,%22height%22:63},%2265309%22:{%22x%22:251,%22y%22:641,%22width%22:49,%22height%22:63},%2265310%22:{%22x%22:101,%22y%22:705,%22width%22:49,%22height%22:63},%2265311%22:{%22x%22:201,%22y%22:705,%22width%22:49,%22height%22:63},%2265312%22:{%22x%22:351,%22y%22:641,%22width%22:49,%22height%22:63},%2265343%22:{%22x%22:251,%22y%22:705,%22width%22:49,%22height%22:63},%2265344%22:{%22x%22:601,%22y%22:641,%22width%22:49,%22height%22:63},%2265372%22:{%22x%22:301,%22y%22:641,%22width%22:49,%22height%22:63}},%22missingGlyph%22:{%22x%22:261,%22y%22:769,%22width%22:25,%22height%22:63},%22height%22:63}";
	



</script>

<script>

	window.addEventListener("load",function(){var e,n="sandboxDummyPlayId",o=engineFiles.pdiBrowser,t=engineFiles.gameDriver,i=new t.MemoryAmflowClient({playId:n}),a=(!0!==window.__akashic__.autoSendEventName&&"string"!=typeof window.__akashic__.autoSendEventName||(e=window.__akashic__.sandboxConfigFunc(),!0===(a=window.__akashic__.autoSendEventName)&&(a=e.autoSendEventName||e.autoSendEvents),e&&a&&e.events&&e.events[a]&&e.events[a].forEach(function(e){i.sendEvent(e)})),e="file:"!==location.protocol?[o.WebAudioPlugin,o.HTMLAudioPlugin]:[o.HTMLAudioPlugin],document.getElementById("container")),r=new o.Platform({amflow:i,containerView:a,audioPlugins:e,disablePreventDefault:!0});function d(e){var n,o,t,i;r.containerController&&(n=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight,i=Math.min(n/e.width,o/e.height),t=Math.floor(e.width*i),e=Math.floor(e.height*i),r.containerController.changeScale(i,i),i={x:Math.floor((n-t)/2),y:Math.floor((o-e)/2)},r.containerController.inputHandlerLayer.setOffset(i))}a.addEventListener("touchstart",function(e){e.preventDefault()}),r.loadGameConfiguration=function(e,n){try{var o=window.gLocalAssetContainer["game.json"],o=decodeURIComponent(o);n(null,JSON.parse(o))}catch(e){n(e,null)}},r._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)},"undefined"!=typeof LocalTextAsset&&(r._resourceFactory.createTextAsset=function(e,n){return new LocalTextAsset(e,n)}),(driver=new t.GameDriver({platform:r,player:{id:"9999",name:"sandbox-player"},errorHandler:function(e){console.log("ERRORHANDLER:",e)}})).gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(d(e),window.addEventListener("resize",function(){d(e)}))}),driver.initialize({configurationUrl:"game.json",assetBase:"./",driverConfiguration:{playId:n,playToken:"dummyToken",executionMode:t.ExecutionMode.Active},loopConfiguration:{loopMode:t.LoopMode.Realtime}},function(e){if(e)throw e;try{var n;"undefined"!=typeof window&&window.RPGAtsumaru&&(n=window.RPGAtsumaru.volume.getCurrentValue(),r.setMasterVolume(n),window.RPGAtsumaru.volume.changed.subscribe(function(e){r.setMasterVolume(e)}),window.RPGAtsumaru.screenshot.setScreenshotHandler(function(){var e=r.getPrimarySurface().canvas.toDataURL("image/png");return Promise.resolve(e)}))}catch(e){console.error(e)}driver.startGame()})});

	window.g=require("@akashic/akashic-engine"),"gLocalAssetContainer"in window||(window.gLocalAssetContainer={}),"__akashic__"in window||(window.__akashic__={});

	var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),LocalScriptAsset=function(n){function t(t,o){o=n.call(this,t,o)||this;return o.func=window.gLocalAssetContainer[t],o}return __extends(t,n),t.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load script asset"))},0)},t.prototype.execute=function(t){return this.func(t),t.module.exports},t}(g.ScriptAsset);

	var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),LocalTextAsset=function(n){function t(t,o){o=n.call(this,t,o)||this;return o.data=decodeURIComponent(window.gLocalAssetContainer[t]),o}return __extends(t,n),t.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load text asset"))},0)},t}(g.TextAsset);

</script>

<style type="text/css">
* {
	margin: 0;
	border: 0;
	padding: 0;
}

html {
	width: 100%;
	height: 100%;
}

body {
	overflow: hidden;
	width: 100%;
	height: 100%;
}

#container {
	margin: 0px;
	padding: 0px;
	overflow: hidden;
	touch-action: none;
	width: 100%;
	height: 100%;

	/* iOS: body */
	position: absolute;
}

#container canvas {
	background-size: contain;
}

</style>



</head>
<body>
<div id="container">
</div>
</body>
</html>
